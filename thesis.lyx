#LyX 1.6.7 created this file. For more info see http://www.lyx.org/
\lyxformat 345
\begin_document
\begin_header
\textclass article
\use_default_options true
\begin_modules
eqs-within-sections
figs-within-sections
tabs-within-sections
\end_modules
\language english
\inputencoding auto
\font_roman palatino
\font_sans default
\font_typewriter default
\font_default_family rmdefault
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\paperfontsize 12
\spacing onehalf
\use_hyperref false
\papersize default
\use_geometry false
\use_amsmath 1
\use_esint 1
\cite_engine basic
\use_bibtopic false
\paperorientation portrait
\secnumdepth 3
\tocdepth 3
\paragraph_separation skip
\defskip medskip
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\author "Eleftherios Garyfallidis,,," 
\author "Eleftherios Garyfallidis,,,," 
\author "Ian Nimmo-Smith,,," 
\author "" 
\end_header

\begin_body

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
thispagestyle{empty}
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
definecolor{magenta}{RGB}{185, 23, 62}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center

\size largest
\color magenta
TOWARDS AN ACCURATE BRAIN
\color inherit
 
\size large

\begin_inset VSpace medskip
\end_inset


\end_layout

\begin_layout Standard
\align center

\size largest
\color magenta
TRACTOGRAPHY
\end_layout

\begin_layout Standard
\align center
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
definecolor{magenta}{RGB}{255, 0, 255}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center

\size large
\begin_inset Graphics
	filename figures/Cambridge_University_Crest.png
	scale 13

\end_inset

 
\end_layout

\begin_layout Standard
\align center

\size large
\begin_inset VSpace vfill
\end_inset


\end_layout

\begin_layout Standard
\align center

\shape smallcaps
\size larger
\color black
ELEFTHERIOS GARYFALLIDIS
\shape default
\size large
\color inherit

\begin_inset VSpace vfill
\end_inset


\end_layout

\begin_layout Standard
\align center

\size larger
\color black
Wolfson College
\end_layout

\begin_layout Standard
\align center

\size larger
\color black
University of Cambridge
\begin_inset Newline newline
\end_inset

UK
\end_layout

\begin_layout Standard
\align center

\size large
\begin_inset VSpace vfill
\end_inset


\end_layout

\begin_layout Standard
\align center

\size larger
\color black
April 2011
\end_layout

\begin_layout Standard
\align center

\size large
\begin_inset VSpace vfill
\end_inset


\end_layout

\begin_layout Standard
\align center
A dissertation submitted to the University of Cambridge for the degree of
 Doctor of Philosophy 
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard

\size huge
\color black
Supervisors
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Standard

\size larger
\noun on
Dr.
 Ian Nimmo-Smith
\size default

\begin_inset Newline newline
\end_inset


\noun default
Medical Research Council 
\begin_inset Newline newline
\end_inset

Cognition and Brain Sciences Unit
\begin_inset Newline newline
\end_inset

Cambridge,UK
\noun on

\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Standard

\size large
\noun on
Dr.
 Guy B.
 Williams
\size default

\begin_inset Newline newline
\end_inset


\noun default
Wolfson Brain Imaging Centre 
\begin_inset Newline newline
\end_inset

Department of Clinical Neurosciences
\begin_inset Newline newline
\end_inset

University of Cambridge
\begin_inset Newline newline
\end_inset

Cambridge, UK
\begin_inset Newline newline
\end_inset

 
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard

\size huge
\color black
Dedication
\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Standard
\align center

\size larger
To 
\begin_inset Newline newline
\end_inset


\emph on
Stavros & Amalia
\end_layout

\begin_layout Standard
\align center

\size large
\begin_inset VSpace medskip
\end_inset


\end_layout

\begin_layout Standard
\align center

\size larger
To 
\begin_inset Newline newline
\end_inset


\emph on
The Free & Open Source Developers
\size default
\emph default

\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard

\size huge
\color black
Acknowledgements
\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Standard
Ian
\end_layout

\begin_layout Standard
Matthew
\end_layout

\begin_layout Standard
Guy
\end_layout

\begin_layout Standard
Marta
\end_layout

\begin_layout Standard
John
\end_layout

\begin_layout Standard
Tim
\end_layout

\begin_layout Standard
John
\end_layout

\begin_layout Standard
Stephan
\end_layout

\begin_layout Standard
Frank
\end_layout

\begin_layout Standard
++ Daniel, Mina, Periklis, Andreas, Magda, 
\end_layout

\begin_layout Standard
Rik, Director of Maths, College tutors new and old, 
\end_layout

\begin_layout Standard
Vassilis, Dimitris, Alexandros
\end_layout

\begin_layout Standard
Tsiaras
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard

\size huge
\color black
Disclaimer
\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Standard
This dissertation is the result of my own work and contains nothing which
 is the outcome of work done in collaboration with others, except where
 stated explicitly.
 
\end_layout

\begin_layout Standard
No part of this dissertation has previously been submitted for any degree
 or diploma at any institution.
 
\end_layout

\begin_layout Standard
This dissertation does not exceed 60,000 words in length (including tables,
 footnotes, bibliography and appendices).
 
\end_layout

\begin_layout Standard
Throughout this dissertation the plural pronoun ‘we’ is used for stylistic
 reasons and should be taken to refer to either the singular author, the
 reader and the author or, when stated explicity, the author and collaborators.
 The form assumed should be apparent from the context.
 
\end_layout

\begin_layout Standard
\noindent
\align right
Eleftherios Garyfallidis
\begin_inset Newline newline
\end_inset

November 2011
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard

\size huge
\color black
List of publications
\begin_inset Newline newline
\end_inset


\series bold
\size default
\color inherit

\begin_inset Newline newline
\end_inset

CONFERENCES
\end_layout

\begin_layout Standard

\series bold
Garyfallidis E
\series default
, Brett M, Nimmo-Smith I (2010), 
\begin_inset Quotes eld
\end_inset


\emph on
Fast Dimensionality Reduction for Brain Tractography Clustering
\emph default
”, 16th Annual Meeting of the Organization for Human Brain Mapping.
\end_layout

\begin_layout Standard

\series bold
Garyfallidis E
\series default
, Brett M, Tsiaras V, Vogiatzis G, Nimmo-Smith I (2010), “
\emph on
Identification of corresponding tracks in diffusion MRI tractographies
\emph default
” Proc.
 Intl.
 Soc.
 Mag.
 Reson.
 Med.
 18
\end_layout

\begin_layout Standard
Correia M.M, Williams G.B, Yeh F-C, Nimmo-Smith I, 
\series bold
Garyfallidis E
\series default
 (2011), 
\begin_inset Quotes eld
\end_inset


\emph on
Robustness of diffusion scalar metrics when estimated with Generalized Q-Samplin
g Imaging acquisition schemes
\emph default

\begin_inset Quotes erd
\end_inset

, Proc.
 Intl.
 Soc.
 Mag.
 Reson.
 Med.
 19 
\end_layout

\begin_layout Standard

\series bold
Garyfallidis E
\series default
, Brett M, Amirbekian B., Nguyen C., Yeh F-C, Olivetti E., Halchenko Y., Nimmo-Smith
 I (2011), 
\begin_inset Quotes eld
\end_inset


\emph on
Dipy - a novel software library for diffusion MR and tractography
\emph default
”, 17th Annual Meeting of the Organization for Human Brain Mapping.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\series bold
JOURNALS
\end_layout

\begin_layout Standard
Chamberlain SR, Hampshire A, Menzies LA, 
\series bold
Garyfallidis E
\series default
, Grant JE, Odlaug BL, Craig K, Fineberg N, Sahakian BJ (2010), “
\emph on
Reduced brain white matter integrity in trichotillomania: a diffusion tensor
 imaging study.
\emph default
” Arch Gen Psychiatry 67(9):965-71
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\series bold
OUTREACH
\begin_inset Newline newline
\end_inset

Garyfallidis E
\series default
, Nimmo-Smith I (2010), 
\begin_inset Quotes eld
\end_inset


\emph on
Surfing your brain superhighways
\emph default

\begin_inset Quotes erd
\end_inset

.
 Presented at the 350th celebration of the Royal Society, London, UK.
 In the presence of Her Majesty Queen Elizabeth II and His Royal Highness
 the Duke of Edinburgh.
\series bold

\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

SOFTWARE
\begin_inset Newline newline
\end_inset


\series default
Diffusion Imaging in Python http://dipy.org 
\begin_inset Newline newline
\end_inset

FOS scientific visualization platform http://fos.me
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard

\size huge
\color black
Abstract
\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Standard
This thesis contains original contributions to many different aspects of
 diffusion weighted MR imaging (dMRI), from the signal reconstruction, via
 propagation of tracks, clustering of tracks, detection of bundles of tracks,
 and creation of atlases of white matter, to visualization tools with high
 interactivity with data, and for several brains simultaneously.
\end_layout

\begin_layout Standard
Our most important new achievements are a powerful way of reconstructing
 the diffusion signal and a method for simplifying tractographies using
 a new super-efficient clustering algorithm.
 
\end_layout

\begin_layout Standard
In more detail we give novel and robust solutions for all the following
 problems
\end_layout

\begin_layout Standard
• 
\series bold
How to reconstruct and interpret the directional information in the diffusion
 signal
\series default
: 
\end_layout

\begin_layout Standard
We compare and evaluate different Cartesian-grid q-space dMRI acquisition
 schemes, using methods based on the inverse Fourier transform of the diffusion
 signal, with reconstructions by diffusion spectrum imaging or generalized
 q-ball imaging methods.
 These are applied to both software phantom and human data.
 We propose a new reconstruction method 
\change_inserted 2 1312884084
called 
\change_unchanged
diffusion nabla imaging (DNI) which works with the same grid type of acquisition
 schemes, using an algorithm that directly approximates the orientation
 distribution function using the Laplacian of the signal in q-space.
\end_layout

\begin_layout Standard
• 
\series bold
How to integrate tracks from voxel to voxel
\series default
: 
\end_layout

\begin_layout Standard
Most previously published reconstruction methods are closely linked to their
 own specific track integration method.
 We have formulated a general, free-standing, data-representative, non-inferenti
al, fast, deterministic tractography algorithm (EuDX) which is based on
 Euler integration and trilinear interpolation, which works with voxel level
 information about fibre orientations including multiple crossings, and
 employs a range of stopping criteria.
 The purpose of this algorithm is to be faithful to the reconstruction results
 rather than try to correct or enhance them by introducing regional or global
 considerations.
\end_layout

\begin_layout Standard
• 
\series bold
How to cluster tracks together into meaningful bundles
\series default
: 
\end_layout

\begin_layout Standard
We have developed an entirely new, fully automatic, linear time, clustering
 method (QuickBundles) which reduces massive tractographies into just a
 few bundles.
 These bundles are characterised by representative tracks which are multi-purpos
e and can be used for interaction with the data or as the basis for applying
 higher-complexity clustering methods which would have been impossible or
 too slow with the full data set.
 QuickBundles is currently the fastest known tractography clustering algorithm.
\end_layout

\begin_layout Standard
• 
\series bold
How to directly register tractographies
\series default
: 
\end_layout

\begin_layout Standard
After applying QuickBundles to tractographies from different subjects, we
 show how to use the representative tracks to identify robust landmarks
 within each subject which, with similarity metrics which we have introduced,
 we use to directly register the different tractographies together in a
 highly efficient way.
 We believe the resulting correspondences provide important evidence for
 the anatomical plausibility of the derived bundles.
 We demonstrate how these methods can be used for group analysis, and for
 atlas creation.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout Section
Background
\end_layout

\begin_layout Subsection

\lang british
Introduction 
\end_layout

\begin_layout Standard

\emph on
\lang british
Diffusion MRI
\emph default
 (dMRI) is the principal non-invasive method that provides information about
 the directional structure of neural tracts found in white matter and the
 cortex
\lang english

\begin_inset Note Note
status open

\begin_layout Plain Layout
are you sure about the cortex? what exactly do you mean?
\end_layout

\end_inset


\lang british
.
 dMRI acquires one or more 
\begin_inset Formula $T_{2}$
\end_inset

-weighted reference images, and a collection of diffusion-weighted images
 (see Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:three_slices"

\end_inset

) that attenuate the 
\begin_inset Formula $T_{2}$
\end_inset

 signal according to the amount of diffusion along prescribed gradient direction
s 
\begin_inset CommandInset citation
LatexCommand cite
key "DiffMRIBook"

\end_inset

.
 The information is not complete and the tracts cannot be reconstructed
 in full detail 
\begin_inset CommandInset citation
LatexCommand cite
key "denislebihan2006aap"

\end_inset

.
 However, some spatial structures and patterns can be visualised.
 These are usually represented as trajectories 
\begin_inset CommandInset citation
LatexCommand cite
key "WWS+08,MCC+99"

\end_inset

 or connectivity maps 
\begin_inset CommandInset citation
LatexCommand cite
key "Behrens2003NatureNeuroscience"

\end_inset

.
 The unique new area of study that aims to reconstruct the neural tracts
 from diffusion data is called diffusion tractography.
 Other types of tractography are based in staining using for example luxol-fast
 blue 
\begin_inset CommandInset citation
LatexCommand cite
key "margolis5nal"

\end_inset

 but these can only be used with 
\emph on
in vitro
\emph default
 brains and they lack ease of repeatability.
 For non-human brains as for example in macaque there are even 
\emph on
in vivo
\emph default
 methods for tracing down to single axons 
\begin_inset CommandInset citation
LatexCommand cite
key "Tuch2005"

\end_inset

 however these are not available or recommended for human studies because
 they are highly invasive.
\change_inserted 1 1313958220

\end_layout

\begin_layout Standard

\change_inserted 1 1313958201

\lang british
\begin_inset Note Note
status open

\begin_layout Plain Layout

\change_inserted 1 1313959328
Diffusion was introduced in the mid-1980s (Le Bihan and Breton 1985
\begin_inset CommandInset citation
LatexCommand cite
key "le1985imagerie"

\end_inset

; Merboldt et al.
 1985
\begin_inset CommandInset citation
LatexCommand cite
key "merboldt1985self"

\end_inset

; Taylor and Bushell, 1985
\begin_inset CommandInset citation
LatexCommand cite
key "taylor1985spatial"

\end_inset

)
\change_unchanged

\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset CommandInset label
LatexCommand label
name "Flo:three_slices"

\end_inset


\begin_inset Graphics
	filename last_figures/three_slices_0_20_100.png
	scale 40

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset Caption

\begin_layout Plain Layout
Three slices from diffusion data sets gathered with zero gradient strength
 on the left, medium gradient strength on the middle and high gradient strength
 on the right.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection

\lang british
Molecular diffusion
\end_layout

\begin_layout Standard

\lang british
Molecular diffusion is a process that is taking place all the time in biological
 materials, fluids in particular, 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\lang british
Should we say everywhere rather than fluids?
\end_layout

\end_inset

 and accounts for a number of interesting phenomena; the dMRI signal measures
 the history of the random (Brownian) displacements of spin-labelled hydrogen
 protons (spins) resolved in the direction of a magnetic field gradient.
 Though the actual probability displacement function of the protons is unaffecte
d by the presence or variation in the magnetic field, the cumulative phase
 change in the spins reflects the changes in the position-dependent spin
 frequency induced by the field gradient.
 Components of the diffusion motion along the direction of the gradient
 induce such changes.
 The signal change due to cumulative dephasing is greatest when this coincides
 with a direction that allows greater random displacements, e.g.
 because of the orientation of a microstructure within which the proton
 is moving.
 It is this link between the anisotropy or directional dependence of the
 dMRI signal and the orientations of the supposed underlying brain fibres
 that provides the unique insights of diffusion tractography.
\end_layout

\begin_layout Standard

\lang british
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\lang british
This just repeats the previous text.
\end_layout

\end_inset

 In dMRI the protons will move more along the directions of the axons and
 less perpendicular to that direction.
 For a biological interpretation of the signal measured with dMRI see 
\begin_inset CommandInset citation
LatexCommand citep
key "Bea02"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "ZLW+03"

\end_inset

 and 
\begin_inset CommandInset citation
LatexCommand cite
key "DiffMRIBook"

\end_inset

.
 
\end_layout

\begin_layout Standard

\lang british
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\lang british
Diffusion Weighted Imaging (DWI) is MRI imaging designed to be sensitive
 to diffusion.
 With this imaging technique we attempt to delineate the axonal organisation
 of the brain.
 A diffusion weighted image is a volume of voxel data gathered by applying
 only one gradient direction using a diffusion sequence.
 We expect that the signal in every voxel should be low if there is greater
 mobility of water molecules along the specified gradient direction and
 it should be high if there is less movement in that direction.
 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\lang british
I've introduced the term 
\emph on
mobility 
\emph default
as a short hand for 
\emph on
root-mean-square RMS displacement
\emph default
.
\end_layout

\end_inset

In that said, if inside a voxel there is an underlying fibre that is parallel
 to the applied gradient direction we should expect a lower value otherwise
 if the fibre is not parallel or near parallel or if there is no underlying
 fibre we should expect a higher value.
 
\end_layout

\begin_layout Plain Layout

\lang british
The directional dependence of the DWI signal is the cornerstone of diffusion
 based tractography.
 Signal from a specific voxel will be higher in directions where diffusivity
 is high, e.g.
 along the direction of a putative bundle of fibres, and lower into the
 walls of the constituent fibres.
 Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig: directional"

\end_inset

 show how signal for an anisotropic Gaussian diffusion would change with
 gradient direction.
 
\end_layout

\end_inset


\end_layout

\begin_layout Subsection

\lang british
Acquisition sequences
\begin_inset CommandInset label
LatexCommand label
name "sub:Acquisition-sequences-in-use"

\end_inset


\end_layout

\begin_layout Standard

\lang british
The best known method for generating diffusion-weighted images is called
 Pulsed Gradient Spin Echo method (PGSE), also known as the Stejskal and
 Tanner method 
\begin_inset CommandInset citation
LatexCommand citep
key "Stejskal1965JChemPhys"

\end_inset

.
 This has 90°-180° spin echo pair of RF pulses with one gradient before
 the second pulse and one equal gradient after the second pulse (see 
\begin_inset CommandInset citation
LatexCommand cite
key "mcrobbie2006mpp"

\end_inset

, p329), see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:pgse"

\end_inset

.
 The refocusing is perfect only when the spins do not move between the two
 pulses.
 The diffusion weighted contrast acts as an inverse 
\begin_inset Formula $T_{2}$
\end_inset

 weighting i.e.
 tissues with mobile water molecules give lower signal than more solid tissues
 with smaller mobility.
 
\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center

\lang british
\begin_inset Graphics
	filename figures/stejskal-tanner2.eps
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset Caption

\begin_layout Plain Layout

\lang british
PGSE
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset CommandInset label
LatexCommand label
name "Fig:pgse"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
Eddy currents caused by the onset and offset of the gradients are a problem
 with PGSE and most systems (including Siemens scanners) use twice-refocused
 spin echo (TRSE) sequences 
\begin_inset CommandInset citation
LatexCommand cite
key "Reese2003MRM"

\end_inset

 to reduce these artefacts.
 Every time the magnetic field gradients switch they generate currents that
 produce other smaller magnetic fields which disturb the spins.
 The TRSE sequence is an improvement on the PGSE.
 The improvement is made using another refocusing pulse surrounded by the
 inverse mirror of the previous diffusion gradients (see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:trse"

\end_inset

).
 By adjusting the timing of the diffusion gradients, eddy currents can be
 nulled or greatly reduced.
 This sequence improves the image quality without loss of scanning efficiency
 i.e.
 TR duration and it is the standard in most modern MRI scanners.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/Reese-TRSE2.eps
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
TRSE
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Fig:trse"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
In our later experiments we used a recent (2010) Work In Progress (WIP)
 protocol from Siemens which uses the STEAM (STimulated Echo Acquisition
 Mode) sequence 
\begin_inset CommandInset citation
LatexCommand cite
key "MAB04"

\end_inset

.
 STEAM, shown in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:steam"

\end_inset

, works in the following way.
 Three 
\begin_inset Formula $90^{\circ}$
\end_inset

 pulses are used to produce a stimulated echo.
 The first two pulses are separated by a time delay 
\begin_inset Formula $\tau$
\end_inset

.
 After the same delay 
\begin_inset Formula $\tau$
\end_inset

 following the same pulse, a stimulated echo is produced.
 In order to introduce diffusion weighting into the stimulated echo, two
 identical diffusion gradient lobes are applied, one during the first and
 one during the second 
\begin_inset Formula $\tau$
\end_inset

 interval.
 Because the magnetization of the stimulated echo is stored along the longitudin
al axis between the second and the third RF pulses, it does not experience
 any 
\begin_inset Formula $T_{2}$
\end_inset

 or 
\begin_inset Formula $T_{2}^{*}$
\end_inset

 dephasing during the time interval 
\begin_inset Formula $TM$
\end_inset

.
 
\begin_inset Formula $TM$
\end_inset

, however, does contribute to the diffusion gradient separation time, 
\begin_inset Formula $\Delta$
\end_inset

.
 Thus, a high b-value can be obtained without incurring the 
\begin_inset Formula $TE$
\end_inset

-induced signal loss, as compared to the standard spin echo sequence.
 The signal amplitude of the stimulated echo is, however, less than that
 of the corresponding spin-echo sequence with the same 
\begin_inset Formula $TE$
\end_inset

, because the maximum amplitude of the stimulated echo is one-half of a
 spin echo.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/STEAM2.eps
	scale 70

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
STEAM
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Fig:steam"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Using STEAM we were able to generate high quality datasets in nearly half
 the time per direction required with the standard DTI sequence.
 For example we were able to acquire 102 grid directions with maximum b-value
 4000 at about 14 minutes, compared with 9 minutes for 64 directions with
 
\change_inserted 2 1312906098

\begin_inset Formula $b_{\mathrm{max}}=1200$
\end_inset


\change_unchanged
.
 
\end_layout

\begin_layout Subsection

\lang british
\begin_inset CommandInset label
LatexCommand label
name "sub:Diffusion-Maths"

\end_inset

Single gradient signal models
\end_layout

\begin_layout Standard

\lang british
Under the Brownian motion assumption the diffusion signal strength is described
 by the following model known as the Stejskal-Tanner
\begin_inset CommandInset citation
LatexCommand cite
key "Stejskal1965JChemPhys"

\end_inset

 formula 
\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \begin{equation}
S_{b}=S_{0}e^{-bD}\label{eq:mono-exponential}\end{equation}

\end_inset

 
\end_layout

\begin_layout Standard

\lang british
where 
\begin_inset Formula $S_{0}$
\end_inset

 is the measured signal when no gradient direction is applied, 
\begin_inset Formula $D$
\end_inset

 is the diffusion coefficient that we wish to measure and 
\begin_inset Formula $b$
\end_inset

 the crucial experimental diffusion weighting parameter or 
\begin_inset Formula $b$
\end_inset

-value which summarises the amount of diffusion sensitising gradient history.
 
\begin_inset Formula $D$
\end_inset

 is often referred as the diffusivity value or apparent diffusivity coefficient
 (ADC).
 The units of 
\begin_inset Formula $D$
\end_inset

 are 
\begin_inset Formula $\mathrm{mm^{2}}$
\end_inset

/sec (for water at 
\begin_inset Formula $37^{o}$
\end_inset


\begin_inset Formula $D\approx$
\end_inset


\begin_inset Formula $3\cdot10^{-3}$
\end_inset


\begin_inset Formula $m^{2}$
\end_inset

/sec), and of 
\begin_inset Formula $b$
\end_inset

 are sec/
\begin_inset Formula $\mathrm{mm^{2}}$
\end_inset

, typically in the range 0-5,000 sec/
\begin_inset Formula $\mathrm{mm^{2}}$
\end_inset

 though some acquisition paradigms can call for very much larger values
 e.g.
 
\begin_inset Formula $12,000$
\end_inset

 sec/
\begin_inset Formula $\mathrm{mm^{2}}$
\end_inset

.
 In Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig: signals"

\end_inset

 we see the signal decay for different b-values and specific diffusivities.
 The obvious conclusion here is that signal in areas with high diffusivity,
 as in the corticospinal fluid (CSF) were water persists, will be always
 lower than the signal from areas of lower diffusivity as those found in
 fibrous brain structures, as the corpus callosum.
 Furthermore, there is least diffusivity and least signal loss when the
 gradient direction is into the wall of a fibre; along the fibre has greater
 diffusivity and greater signal loss; free water has greatest diffusivity
 and greatest signal loss.
 Signal decreases exponentially with 
\begin_inset Formula $b$
\end_inset

; Finally we can see that the 
\begin_inset Quotes eld
\end_inset

directional effect
\begin_inset Quotes erd
\end_inset

, i.e.
 the contrast between 'along' and 'transverse' signal is greatest when 
\begin_inset Formula $b\sim1000$
\end_inset

.
\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center

\lang british
\begin_inset CommandInset label
LatexCommand label
name "Fig: signals"

\end_inset


\begin_inset Graphics
	filename figures/various_signals.png
	scale 80

\end_inset


\begin_inset Caption

\begin_layout Plain Layout

\lang british
Signal as a function of 
\begin_inset Formula $b$
\end_inset

 for various values of 
\begin_inset Formula $D$
\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\lang british
What do you mean with directional effect?
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
The b-value 
\begin_inset Formula $b$
\end_inset

 or 
\emph on
diffusion weighting
\emph default
 is a function of the strength, duration and temporal spacing and timing
 parameters of the specific paradigm.
 This function is derived from the Bloch-Torrey equations
\begin_inset CommandInset citation
LatexCommand cite
key "Callaghan1991OUP"

\end_inset

.
 In the case of the classical Stejskal-Tanner pulsed gradient spin-echo
 (PGSE) sequence (described further in 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Acquisition-sequences-in-use"

\end_inset

), at the time of readout
\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \[
b=\gamma^{2}G^{2}\delta^{2}\left(\Delta-\frac{\delta}{3}\right),\]

\end_inset

where 
\begin_inset Formula $\gamma$
\end_inset

 is the gyromagnetic ra
\change_inserted 2 1312906931
t
\change_deleted 2 1312906930
d
\change_unchanged
io, 
\begin_inset Formula $\delta$
\end_inset

 denotes the pulse width, 
\begin_inset Formula $G$
\end_inset

 is the gradient amplitude and 
\begin_inset Formula $\Delta$
\end_inset

 the centre to centre spacing.
 
\begin_inset Formula $\gamma$
\end_inset

 is a 
\change_inserted 2 1312906921
physical 
\change_unchanged
constant, but we can change the other three parameters and in that way control
 the b-value.
\end_layout

\begin_layout Standard

\lang british
Although the PGSE is useful for expository clarity, in reality
\change_inserted 2 1312907051
 as indicated in 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Acquisition-sequences-in-use"

\end_inset


\change_unchanged
 more complicated but related sequences such as the twice-refocused spin-echo
 (TRSE) 
\begin_inset CommandInset citation
LatexCommand cite
key "Heid2000ISMRM,Reese2003MRM"

\end_inset

 sequence and subsequent refinements such as TRASE 
\begin_inset CommandInset citation
LatexCommand cite
key "Auerbach2004ISMRM"

\end_inset

 are employed as a means of removing the distortion effects from eddy currents
 resulting from the initial and final ramps of the gradient pulses.
 
\end_layout

\begin_layout Standard

\lang british
An important point to stress here is that we can control the size of b-values
 by changing the strength and timings of the gradient pulses
\change_inserted 2 1312907076
,
\change_unchanged
 and that depending on the b-value, we can expect different amount of signal
 loss.
 In Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig: directional"

\end_inset

 we see the directional dependence of the simulated signal of a single fibre
 oriented at 
\change_deleted 2 1312907153

\begin_inset Formula $0$
\end_inset


\change_inserted 2 1312907186
°
\change_unchanged
 
\change_deleted 2 1312907191
degrees
\change_unchanged
 for two b-values.
 
\change_deleted 2 1312907245
Surprisingly
\change_inserted 2 1312907261
Note the important features that
\change_deleted 2 1312907264
,
\change_unchanged
 the signal is lower in the direction of the fibre and at higher b-value.
\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center

\lang british
\begin_inset Graphics
	filename figures/directional_signal.png
	scale 80

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset Caption

\begin_layout Plain Layout

\lang british
Directional dependence of signal for two b-values.
 Signal is drawn as a function of direction for a Gaussian diffusion function
 with a horizontal principal direction (
\begin_inset Formula $0$
\end_inset


\change_deleted 2 1312907295
 degrees
\change_inserted 2 1312907295
°
\change_unchanged
) and two values of 
\begin_inset Formula $b$
\end_inset

.
 
\begin_inset Formula $D$
\end_inset

 is set to 
\begin_inset Formula $0.002$
\end_inset

.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset CommandInset label
LatexCommand label
name "fig: directional"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
In eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mono-exponential"

\end_inset

 we assume that the signal can be expressed by a single exponential term
 (mono-exponential).
 In fact there is evidence that this assumption may break down at higher
 
\begin_inset Formula $b$
\end_inset

-values and more complicated models have been proposed in order to deal
 with this issue.
 One of these, is the multi-exponential model used by Ozarslan et al.
\begin_inset CommandInset citation
LatexCommand cite
key "ozarslan2006resolution"

\end_inset

 which is expressed as 
\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \begin{equation}
S_{b}=S_{0}\sum_{i}^{N}f_{i}e^{-bD_{i}}\label{eq:multi-exponential}\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\lang british
where 
\begin_inset Formula $N$
\end_inset

 is the number of exponents
\change_inserted 2 1312907356
 or compartments
\change_unchanged
, 
\begin_inset Formula $D_{i}$
\end_inset

 is the 
\begin_inset Formula $i$
\end_inset

-th diffusion coefficient and 
\begin_inset Formula $f_{i}$
\end_inset

 is the volume fraction of
\change_deleted 2 1312907367
 the and
\change_unchanged
 the 
\begin_inset Formula $i$
\end_inset

-th 
\change_deleted 2 1312907372
exponent
\change_inserted 2 1312907374
compartment
\change_unchanged
.
 
\end_layout

\begin_layout Standard

\lang british
Another model of higher order is found in diffusion kurtosis imaging (DKI)
 proposed by Jensen et al.
\begin_inset CommandInset citation
LatexCommand cite
key "jensen2005diffusional"

\end_inset


\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \begin{equation}
\ln(S_{b})=\ln(S_{0})-bD+\frac{1}{6}b^{2}D^{2}K+O(b^{3})\label{eq:kurtosis}\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\lang british
where 
\begin_inset Formula $K$
\end_inset

 is the apparent diffusion kurtosis coefficient.
 
\end_layout

\begin_layout Standard

\lang british
By putting together these single gradient models (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mono-exponential"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:multi-exponential"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:kurtosis"

\end_inset

) for every gradient direction we can create systems of equations where
 we can fit and identify their unknown parameters.
 In this thesis we will try to avoid fitting in that way but we will try
 to reconstruct the signal in an non-parametric Fourier-analysis based approach
 using the combined information from many gradient directions.
\change_inserted 2 1312907469

\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\change_inserted 2 1312907524

\lang british
I think we need to make a stronger, clearer statement of what restrictions
 we are imposing.
\change_unchanged

\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Subsection

\lang british
Q-space reconstruction
\end_layout

\begin_layout Standard

\lang british
Bloch and Torrey 
\begin_inset CommandInset citation
LatexCommand cite
key "torrey1956bed"

\end_inset

 established differential equations governing MR diffusion in non-isotropic
 magnetic fields by analogy with Fick's Laws 
\begin_inset CommandInset citation
LatexCommand cite
key "einstein1956itb"

\end_inset

 for
\change_deleted 2 1312907580
 the
\change_unchanged
 spontaneous dispersion along concentration gradients of inhomogeneous substance
s.
 Callaghan 
\begin_inset CommandInset citation
LatexCommand cite
key "Callaghan1991OUP"

\end_inset

 also showed how these bulk properties could be derived by statistical methods
 from the collective spin histories of individual protons.
 When a molecule is at position 
\begin_inset Formula $x_{0}$
\end_inset

, we cannot read exactly where it will be after time 
\begin_inset Formula $t$
\end_inset

, we can only model a distribution of possible locations.
 This motion is described by a propagator 
\begin_inset Formula $P(\mathbf{x};\mathbf{x}_{o},t)$
\end_inset

 which defines the probability of being in 
\begin_inset Formula $\mathbf{x}$
\end_inset

 after a time 
\begin_inset Formula $t$
\end_inset

, starting at 
\begin_inset Formula $\mathbf{x}_{0}$
\end_inset

.
\end_layout

\begin_layout Standard

\lang british
Stejskal and Tanner 
\begin_inset CommandInset citation
LatexCommand cite
key "Stejskal1965JChemPhys"

\end_inset

 showed that the spin echo magnitude 
\begin_inset Formula $S(\mathbf{q},t)$
\end_inset

 from a pulsed gradient spin echo (PGSE) experiment (see 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Acquisition-sequences-in-use"

\end_inset

) is directly related to the diffusion propagator by the following 
\change_inserted 2 1312907893
(inverse) 
\change_unchanged
Fourier relation
\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \begin{equation}
S(\mathbf{q},t)=S_{0}\int P(\mathbf{r},t)e^{i\mathbf{q}\cdot\mathbf{r}}d\mathbf{r}\label{eq:fourier}\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\lang british
where 
\begin_inset Formula $S_{0}$
\end_inset

 is the signal in the absence of the applied magnetic diffusion gradient
 
\begin_inset Formula $\mathbf{g}$
\end_inset

, 
\begin_inset Formula $\mathbf{r}$
\end_inset

 is the relative spin displacement 
\begin_inset Formula $\mathbf{x}-\mathbf{x}_{0}$
\end_inset

 at diffusion time 
\begin_inset Formula $t$
\end_inset

, 
\begin_inset Formula $\mathbf{q}$
\end_inset

 is the spin displacement wave vector, related to the applied magnetic gradient
 
\begin_inset Formula $\mathbf{g}$
\end_inset

 by the formula 
\begin_inset Formula $\mathbf{q}=(2\pi)^{-1}\gamma\delta\mathbf{g}$
\end_inset

.
 With the 
\change_deleted 2 1312907907
inverse
\change_inserted 2 1312907911
corresponding direct
\change_unchanged
 Fourier transform we can reconstruct the diffusion propagator 
\begin_inset Formula $P$
\end_inset

 by measuring the signal in a number of different directions and gradient
 magnitudes.
 Q-space imaging (QSI) and Diffusion Spectrum Imaging (DSI) are the best
 known methods which try to reconstruct the full diffusion propagator in
 that way.
 In eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:fourier"

\end_inset

 the spin density is 
\change_deleted 2 1312908056
dropped
\change_inserted 2 1312908064
implicit in 
\begin_inset Formula $S_{0},$
\end_inset


\change_unchanged
 in a later chapter we will see a more general 
\change_deleted 2 1312908087
description
\change_inserted 2 1312908090
interpretation
\change_unchanged
 of th
\change_deleted 2 1312908095
at
\change_inserted 2 1312908095
is
\change_unchanged
 
\change_deleted 2 1312908100
equation
\change_inserted 2 1312908102
relationship
\change_unchanged
 (see eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:kq"

\end_inset

).
 
\end_layout

\begin_layout Standard

\lang british
Q-space is the space 
\change_deleted 2 1312908670
of one or more
\change_inserted 2 1312908678
defined by the coordinates of the
\change_unchanged
 3D spin displacement wave vectors 
\begin_inset Formula $\mathbf{q}$
\end_inset

 as shown in equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:fourier"

\end_inset

.
 The vector 
\begin_inset Formula $\mathbf{q}$
\end_inset

 parametrises the space of diffusion 
\change_deleted 2 1312908708
gradients
\change_inserted 2 1312908714
acquisitions
\change_unchanged
.
 It is related to the applied magnetic diffusion gradient 
\begin_inset Formula $\mathbf{g}$
\end_inset

 by the formula 
\begin_inset Formula $\mathbf{q}=(2\pi)^{-1}\gamma\delta\mathbf{g}$
\end_inset

 
\begin_inset CommandInset citation
LatexCommand cite
key "lenglet2009mathematical"

\end_inset

.
 Every single vector 
\begin_inset Formula $\mathbf{q}$
\end_inset

 has the same orientation as the direction of diffusion gradient 
\begin_inset Formula $\mathbf{g}$
\end_inset

 and length proportional to the strength 
\begin_inset Formula $g$
\end_inset

 of the gradient field, 
\change_deleted 2 1312908755
w
\change_inserted 2 1312908755
W
\change_unchanged
e actually have 
\begin_inset Formula $\mathbf{q}=k\sqrt{b}\mathbf{\hat{g}}$
\end_inset

 where 
\begin_inset Formula $b$
\end_inset

 is the b-value, 
\series bold

\begin_inset Formula $\mathbf{\hat{g}}$
\end_inset


\series default
 is the unit gradient direction
\change_inserted 2 1312908898
 
\begin_inset Formula $\mathbf{g}\mathbf{/|}\mathbf{g}\mathbf{|}$
\end_inset

,
\change_unchanged
 and 
\begin_inset Formula $k$
\end_inset

 is a multiplication constant which is a function of the timing parameters
 of the acquisition scheme.
 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\lang british
When creating a grid in q-space we usually normalize 
\begin_inset Formula $\mathbf{q}$
\end_inset

 by dividing by the 
\begin_inset Formula $\mathbf{q}$
\end_inset

 with the smallest non-negative b-value.
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
Every single point in q-space corresponds to a possible 
\change_inserted 2 1312908950
diffusion weighted acquisition i.e.
 a 
\change_unchanged
3D 
\change_inserted 2 1312908982
brain 
\change_unchanged
volume 
\change_deleted 2 1312908986
of the brain 
\change_inserted 2 1312908972
of measured signal 
\change_unchanged
for a specific gradient direction and strength (see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:q-space"

\end_inset

).
 Therefore if for example we have programmed the scanner to apply 60 gradient
 directions then our data should have 60 diffusion volumes with each volume
 obtained for a specific gradient.
 A Diffusion Weighted Image (DWI) is the volume acquired from only one direction
 gradient.
 Hence, in the previous example we would gather 60 DWI volumes corresponding
 to 60 locations (
\begin_inset Formula $\mathbf{q}$
\end_inset

-values) in 
\series bold

\begin_inset Formula $\mathbf{q}$
\end_inset


\series default
-space.
 An alternative way to 
\change_deleted 2 1312909032
see
\change_inserted 2 1312909034
think of
\change_unchanged
 
\begin_inset Formula $\mathbf{q}$
\end_inset

 is in mathematical terms as the combination of parameters which produces
 
\change_inserted 2 1312909062
the inverse
\change_deleted 2 1312909058
a
\change_unchanged
 Fourier transform relationship between the diffusion signal and the probability
 displacement distribution.
 In these terms (see Callaghan 
\begin_inset CommandInset citation
LatexCommand cite
key "Callaghan1991OUP"

\end_inset

) 
\begin_inset Formula $\mathbf{q}$
\end_inset

 is the reciprocal of the probability displacement vector 
\begin_inset Formula $\mathbf{r}$
\end_inset

, just as in conventional MRI 
\begin_inset Formula $\mathbf{k}$
\end_inset

 space is the reciprocal parametrisation of the brain space vector 
\series bold

\begin_inset Formula $\mathbf{v}$
\end_inset

.
\end_layout

\begin_layout Standard

\lang british
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\lang british
Another way to represent dMRI is the following.
 We can combine all the DWIs together creating a new multidimensional image
 where each voxel corresponds to a profile of diffusion signals measured
 in all the chosen gradient directions 
\begin_inset Formula $\mathbf{g}$
\end_inset

.
 This is the only known way to represent all different acquisition methods
 within the same structure and we are using it as the basis for our novel
 tractography algorithm.

\change_inserted 2 1312909127
 ARE WE KEEPING THIS?
\change_unchanged

\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/qspace.png
	scale 35

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset CommandInset label
LatexCommand label
name "Flo:qspace"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
One volume is collected for every sampling point in q-space.
 Picture from Hagmann et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Hagmann2006Radiographics"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
One problem in 
\change_inserted 2 1312909422
the 
\change_unchanged
diffusion imaging 
\change_inserted 2 1312909427
literature 
\change_unchanged
is that names for techniques often refer both to a particular type of imaging
 acquisition, and to 
\change_deleted 2 1312910338
the
\change_inserted 2 1312910342
a particular
\change_unchanged
 
\change_deleted 2 1312910234
subsequent
\change_inserted 2 1312910298
method to reconstruct the 
\change_deleted 2 1312910348
 analysis model
\change_inserted 2 1312910325
directional organisation of the voxel
\change_unchanged
.
 All dMRI acquisition methods acquire data in q-space, and the methods can
 be categorised by their sampling pattern in q-space.
 
\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center

\lang british
\begin_inset Graphics
	filename figures/Acquisitions_New.png
	lyxscale 16
	scale 30

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset Caption

\begin_layout Plain Layout

\lang british
A (Upper Left): DSI 604 directions, B (Upper Right): HARDI 65 directions,
 C (Lower Left): HARDI with 2 shells of 65 directions in each shell, D (Lower
 Right): QBI 515 directions
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset CommandInset label
LatexCommand label
name "Fig:q-space"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
We refer to a method as a 
\emph on
q-space spherical shell
\emph default
 method if it is an acquisition method 
\change_deleted 2 1312910487
collecting
\change_inserted 2 1312910488
using
\change_unchanged
 a 
\change_deleted 2 1312910491
series
\change_inserted 2 1312910498
collection
\change_unchanged
 of points in q-space that can be thought of as being on a curved surface,
 typically a sphere.
 Examples include techniques referred to as HARDI (High Angular Diffusion
 Imaging), Q-ball Imaging and HYDI (Hybrid Diffusion Imaging)
\change_inserted 2 1312909505

\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\change_inserted 2 1312909511

\lang british
References?
\change_unchanged

\end_layout

\end_inset


\change_unchanged
.
 A q-space shell method might involve a 
\change_deleted 2 1312909531
collection of a
\change_unchanged
 single shell (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:q-space"

\end_inset

B,D), e.g.
 QBI
\change_inserted 2 1312909536
,
\change_unchanged
 or multiple shells (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:q-space"

\end_inset

C) e.g.
 EQBI
\change_inserted 2 1312909555

\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\change_inserted 2 1312909563

\lang british
Reference?
\change_unchanged

\end_layout

\end_inset


\change_unchanged
.
 In clinical settings where we can only use a few directions (less than
 60 with minimum 6) it is recommended to use the SDT (simple diffusion tensor)
 
\change_inserted 2 1312910457
reconstruction 
\change_unchanged
model which is 
\change_deleted 2 1312909595
very
\change_inserted 2 1312909597
relatively
\change_unchanged
 easy to fit as it has 
\change_deleted 2 1312909614
very
\change_inserted 2 1312909615
only a
\change_unchanged
 few 
\change_deleted 2 1312909619
components
\change_inserted 2 1312909621
parameters
\change_unchanged
.
 
\end_layout

\begin_layout Standard

\lang british
A 
\emph on
q-space 3D grid (volume)
\emph default
 method is an acquisition method that is more easily thought of as 
\change_deleted 2 1312909652
collecting
\change_inserted 2 1312909660
a collection of
\change_unchanged
 points 
\change_inserted 2 1312910636
regularly 
\change_unchanged
distributed through a 
\change_deleted 2 1312909669
volume
\change_inserted 2 1312909670
region
\change_unchanged
 in q-space.
 The characteristic example is DSI (diffusion spectrum imaging) (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:q-space"

\end_inset

A).
 and QSI (
\begin_inset Formula $\mathbf{q}-$
\end_inset

space imaging)
\begin_inset CommandInset citation
LatexCommand cite
key "king1994q,Callaghan1991OUP"

\end_inset


\change_deleted 2 1312910661
 
\change_unchanged
.
 In chapter 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Grid-based-Q-space-Reconstructions"

\end_inset

 we will concentrate more on q-space grid methods and propose a new 
\change_inserted 2 1312910132
reconstruction 
\change_unchanged
method which we call DNI (Diffusion Nabla Imaging)
\change_inserted 2 1312910546
 which also uses q-space grid data
\change_unchanged
.
\end_layout

\begin_layout Subsection
Diffusion Tensor
\end_layout

\begin_layout Standard

\lang british
Assuming that the diffusion propagator is given by a 3-dimensional Gaussian
 distribution from eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:fourier"

\end_inset

we can write 
\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \begin{equation}
P(\mathbf{r},t)=\frac{1}{\sqrt{4\pi t^{3}\mid\mathbf{D}\mid}}exp(-\frac{\mathbf{r}^{T}\mathbf{D}^{-1}\mathbf{r}}{4t})\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\lang british
where 
\begin_inset Formula $\mathbf{D}$
\end_inset

 is known as the diffusion tensor.
 This tensor is a 
\begin_inset Formula $3x3$
\end_inset

 positive definite symmetric matrix that can be completely described by
 a centred ellipsoid with 3 principal axes and associated eigenvalues 
\begin_inset Formula $\lambda_{1},\lambda_{2},\lambda_{3}$
\end_inset

.
 The trace of the diffusion tensor has been found valuable for detecting
 and evaluating brain ischemia and stroke 
\begin_inset CommandInset citation
LatexCommand cite
key "moseley1995clinical,warach1995acute"

\end_inset

.
 Frequently, mean diffusivity
\change_inserted 2 1312910705
 
\change_unchanged
(MD) is used instead of the trace defined as
\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \begin{equation}
MD=\frac{trace(D)}{3}=\frac{\lambda_{1}+\lambda_{2}+\lambda_{3}}{3}\label{eq:mean_diffusivity}\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\lang british
Fractional Anisotropy (FA) is the most common scalar metric used in diffusion
 imaging which is used to characterise the presence or absence of a preferred
 direction for diffusion.
 Like the MD it depends only on the eigenvalues.
\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \begin{equation}
FA=\frac{1}{\sqrt{2}}\frac{\sqrt{(\lambda_{1}-\lambda_{2})^{2}+(\lambda_{2}-\lambda_{3})^{2}+(\lambda_{3}-\lambda_{1})^{2}}}{\sqrt{\lambda_{1}^{2}+\lambda_{2}^{2}+\lambda_{3}^{2}}}\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\lang british
If FA is equal to 1 that means very anisotropic (infinitely prolonged ellipsoid
 or a `stick') and if FA is equal to 0 that means completely isotropic (sphere).
 FA is used in clinical studies to diagnose diseases like stroke and cancer
 and asses the progress of therapy 
\begin_inset CommandInset citation
LatexCommand cite
key "maddah_phdthesis2008"

\end_inset

.
\end_layout

\begin_layout Standard

\lang british
Whenever we are using FA volumes we are implicitly assuming that the propagator
 of the spin displacements in every voxel has a 3D Gaussian distribution.
 This assumption is used in most of the diffusion related literature where
 DTI or Diffusion Tensor Imaging is the prevailing term.

\change_inserted 2 1312910861
 
\change_unchanged
Unfortunately, in reality things are much more complicated; inside our brain
 the axons are semi-permeable (restriction), the water molecules interact
 with many different elements in the complex intra fibre fluid, the fibres
 might cross, kiss, divert or bend inside a voxel or between voxels.
 Therefore, assuming a Gaussian distribution is a non-trivial approximation.
 However, FA is still prevalent as it is easy to calculate and it gives
 similar values across different acquisitions.
 
\change_inserted 2 1312911026

\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\change_inserted 2 1312911107

\lang british
The CHARMED model of Assaf and Basser seems to characterise hindered and
 restricted diffusion in a useful way.
 You might use it to improve this paragraph?
\change_unchanged

\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Subsection

\lang british
Orientation Distribution
\begin_inset CommandInset label
LatexCommand label
name "sub:Orientation-Distribution"

\end_inset


\end_layout

\begin_layout Standard

\lang british
Since the primary interest of dMRI is the way that the signal depends on
 the direction of underlying fibre orientations
\change_deleted 2 1312911195
.
\change_unchanged
, it is the orientation information in this propagator that is 
\change_deleted 2 1312911205
potentially
\change_inserted 2 1312911211
principally
\change_unchanged
 of interest.
\end_layout

\begin_layout Standard

\lang british
One possible approach would be to replace the diffusion probability density
 function with an isosurface, which is a surface that passes through all
 points of equal value, or, in other words, where the value is a constant.
 
\change_inserted 2 1312911283
For instance a 3D Gaussian isosurface is an ellipsoid.
 
\change_unchanged
A more commonly used technique that is less sensitive to noise
\change_inserted 2 1312911299

\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\change_inserted 2 1312911307

\lang british
Does this need justifying?
\change_unchanged

\end_layout

\end_inset


\change_unchanged
 involves the computation of the orientation distribution function from
 the displacement distribution
\begin_inset CommandInset citation
LatexCommand cite
key "Hagmann2006Radiographics,Tuch2004,wedeen2005mapping"

\end_inset

.
 An orientation distribution function may be considered a 
\change_deleted 2 1312911386
deformed 
\change_unchanged
sphere
\change_inserted 2 1312911393
 polar plot
\change_unchanged
 whose radius in a given direction is proportional to the 
\change_deleted 2 1312911404
sum of values
\change_inserted 2 1312911406
integral
\change_unchanged
 of the diffusion probability density function in that direction.
 For ease of visualization, we color code the surface according to the diffusion
 direction ([x,y,z] = [r,b,g], where r = red, b = blue, and g = green).
 An orientation distribution function or isosurface can be plotted for each
 individual MR imaging voxel in a section (see Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:ODF"

\end_inset

).
\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset CommandInset label
LatexCommand label
name "Flo:ODF"

\end_inset


\begin_inset Graphics
	filename last_figures/pdf_iso_odf.png
	scale 30

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset Caption

\begin_layout Plain Layout
On the top picture we see the reconstruction of the 3D displacement probability
 distribution also known as the diffusion propagator or ensemble average
 propagator (EAP) or diffusion spectrum produced from the inverse Fourier
 transform of the diffusion signal.
 Two approaches that may be used to simplify the visual representation of
 the EAP is the replacement of the displacement distribution with an isosurface,
 and computation of the commonly used orientation distribution function
 (ODF).
 This displacement distribution resembles a crossing of two fibres, however
 the ODF is used to identify the primary directions of the fibres.
 Picture from Hagmann et al.
\begin_inset CommandInset citation
LatexCommand cite
key "Hagmann2006Radiographics"

\end_inset

.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
The orientation distribution function (ODF) expresses the probability of
 a spin displacing into a differential solid angle about a possible fibre
 direction 
\begin_inset Formula $\hat{\mathbf{u}}$
\end_inset

.
 This is used in order to model and visualise the directional information
 in diffusion propagator and in simple words it just projects the diffusion
 function on to the sphere by integrating over the radial coordinate of
 the diffusion function.
 The ODF representation symbolised below with 
\begin_inset Formula $f$
\end_inset

 sacrifices all the radial information but retains the relevant directional
 information:
\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \begin{equation}
\psi(\hat{\mathbf{u}})=\int_{0}^{\infty}P(r\hat{\mathbf{u}})r^{2}dr\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\lang british
where 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
\lang english

\begin_inset Formula $\hat{\mathbf{u}}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\noun default
\color inherit
\lang british
 is a unit normal vector, 
\change_inserted 2 1312911711
and 
\change_unchanged

\begin_inset Formula $r$
\end_inset

 is the radial coordinate in the diffusion space
\change_deleted 2 1312911737
, and 
\begin_inset Formula $Z$
\end_inset

 is a normalisation constant to make
\change_inserted 2 1312911737
.

\change_deleted 2 1312911743
 
\change_inserted 2 1312911758
By construction 
\change_unchanged

\begin_inset Formula $\psi(\mathbf{\hat{u})}$
\end_inset

 
\change_inserted 2 1312911747
is 
\change_unchanged
a probability distribution over 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
\lang english

\begin_inset Formula $\hat{\mathbf{u}}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\noun default
\color inherit
\lang british
.
 
\end_layout

\begin_layout Standard

\lang british
The ODF is a function on the sphere.
 The sphere is usually represented by a discrete spherical grid with evenly
 distributed points.
 It is a common procedure to identify the direction of the underlying fibres
 from the points where the maximum values are found (see Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:ODF"

\end_inset

).
 This procedure is also known as 
\emph on
peak finding
\emph default
.
\end_layout

\begin_layout Subsection

\lang british
Tractography
\begin_inset CommandInset label
LatexCommand label
name "sub:Tractography"

\end_inset


\end_layout

\begin_layout Standard
Once we know the orientation of fibres at every voxel, we can try to join
 these directions up to reconstruct complete tracks and hence brain connections.
 In its simplest form, this consists of starting at a seed location and
 following the preferred direction until we reach a new voxel.
 We can then change to this voxel's referred direction and carry on until
 an entire track is propagated (see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:tensortrack"

\end_inset

).
 
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Tractography algorithms effectively reconstruct the paths in the brain,
 along which water diffusion is least hindered (Behrens and Jbabdi, 2009).
 In the case ofWM,molecu- les are more hindered in a systematic way by the
 axonal membranes and the myelin sheaths (Beaulieu, 2002).
 They will, thus, diffuse along rather than across the neuronal axons.
 This preferred diffusion directionality can indirectly infer geometrical
 features of the underlying axonal bundles.
 Therefore, tractography methods provide informa- tion on the route of group
 of axons, rather than on individual axonal processes (note that individual
 subcortical axons have a diameter in the order of a few µm, while the DWimaging
 resolution is in the order of 2 mm).
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
The two best known families of track propagation algorithms are: deterministic
\begin_inset CommandInset citation
LatexCommand cite
key "CLC+99,MCC+99"

\end_inset

 and probabilistic
\begin_inset CommandInset citation
LatexCommand cite
key "Behrens2007NeuroImage"

\end_inset

.
 A track propagation algorithm belongs to the probabilistic domain if the
 fibre model that is being used incorporates uncertainty i.e.
 errors in estimating the orientation of the fibre at every voxel.
 If it does not assume any uncertainty along the path of the track then
 it is deterministic.
 In chapter 
\begin_inset CommandInset ref
LatexCommand ref
reference "par:Euler-Delta-Crossings"

\end_inset

 we will give a short overview of many other track propagation methods including
 global tractography
\begin_inset CommandInset citation
LatexCommand cite
key "Kreher2008ISMRM"

\end_inset

.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout

\lang british
Tractography algorithms are based in local estimates of diffusion direction.
 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center

\lang british
\begin_inset CommandInset label
LatexCommand label
name "Flo:tensortrack"

\end_inset


\lang english

\begin_inset Graphics
	filename last_figures/tensor_trajectory.png
	scale 40

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset Caption

\begin_layout Plain Layout
The white line shows the track obtained by connecting up a set of voxels
 based on the direction of the axis of the maximum tensor eigenvalue and
 is an example of deterministic tractography.
 The color is a complementary way of coding the tensor ellipsoid direction
 where red denotes left-right, green denotes back-front and blue up-down.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
One of the simplest and first deterministic methods is called Fibre Assignment
 by Continuous Tracking (FACT) 
\begin_inset CommandInset citation
LatexCommand cite
key "MCC+99"

\end_inset

.
 The FACT algorithm starts through the input of an arbitrary point in the
 volume and then tracks in both directions e.g.
 forward and backwards.
 Perhaps the most interesting part with these tracking methods is how they
 decide when to stop tracking.
 FACT uses a single threshold variable 
\begin_inset Formula $R={\displaystyle \sum_{i}^{s}\sum_{j}^{s}|\mathbf{e}_{i}\cdot\mathbf{e}_{j}|/s(s-1)}$
\end_inset

 where 
\begin_inset Formula $s$
\end_inset

 is the number of neighbouring voxels and
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
 
\begin_inset Formula $\mathbf{e}$
\end_inset

 is the eigenvector corresponding to the largest eigenvalue in each voxel.

\family default
\series default
\shape default
\size default
\emph default
\bar default
\noun default
\color inherit
 The simplest case for defining a neighbourhood of a voxel is to use all
 26 other adjacent (touching) voxels.
 Now, let's think of how 
\begin_inset Formula $R$
\end_inset

 will behave in different neighbours.
 When adjacent fibres are aligned strongly 
\begin_inset Formula $R$
\end_inset

 will increase as the absolute value of the dot product grows bigger as
 the normalised vectors become more co-linear.
 On the other side, 
\begin_inset Formula $R$
\end_inset

 will grow shorter in regions without continuity in fibre direction, where
 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none

\begin_inset Formula $R=0$
\end_inset

 in perfect isotropic conditions.
 In voxels with 
\begin_inset Formula $R$
\end_inset

 less than a prespecified threshold e.g.
 0.8 the tracks will stop being propagated and FACT will terminate.

\family default
\series default
\shape default
\size default
\emph default
\bar default
\noun default
\color inherit
 An important problem with FACT is that it fails to track axons deviating
 from major pathways where it only tracks one of the major branches.
\change_inserted 1 1315343654

\begin_inset Note Note
status open

\begin_layout Plain Layout

\change_inserted 1 1315344626
TALK ABOUT THE F-E PICTURE
\change_unchanged
 - SAY AS WELL THAT FACT PROPAGATES IN NON-FIXED STEPS AND EULER INTERGRATION
 IN FIXED STEPS
\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/colourtracks4.png
	scale 35

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset CommandInset label
LatexCommand label
name "Flo:Dipytracks"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
Deterministic whole brain tractography based on EuDX and generated using
 Diffusion Imaging in Python (
\emph on
www.dipy.org
\emph default
).
 The color encodes the orientation of the mid-segment of every track using
 a colourmap based on Boy's real projective plane immersion 
\begin_inset CommandInset citation
LatexCommand cite
key "Demiralp-2009-CLF-url"

\end_inset

.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
Another popular deterministic approach commonly used in the the field of
 fluid dynamics for flow simulation was applied to the field of dMRI by
 
\begin_inset CommandInset citation
LatexCommand cite
key "CLC+99"

\end_inset

 and 
\begin_inset CommandInset citation
LatexCommand cite
key "BPP+00"

\end_inset

 assuming again a continuous vector field but now the track is propagated
 by the solution of a system of differential equations subject to an initial
 condition, the position of the seed point.
 Here the authors propose that a fibre can be represented by a 3D curve
 
\begin_inset Formula $\mathbf{r}$
\end_inset

 parametrised by the arc length 
\begin_inset Formula $s$
\end_inset

 of the track.
 The iterative solution of the equation
\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \begin{equation}
d\mathbf{r}(s)/ds=\mathbf{e}(\bm{r}(s))\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\lang british
where 
\series bold

\begin_inset Formula $\bm{e}$
\end_inset


\series default
 is the primary direction of the Tensor or a different model.
 The solution of this system of ordinary differential equations (ODE) in
 its simplest case is given by iterative methods like Euler integration
 bound to an initial condition 
\begin_inset Formula $\bm{r}(0)=\bm{r}_{0}$
\end_inset

 where 
\begin_inset Formula $\bm{r}_{0}$
\end_inset

is the seed point.
\end_layout

\begin_layout Standard

\lang british
\begin_inset Formula \begin{equation}
\bm{r}(s_{1})\sim\bm{r}(s_{0})+\alpha\mathbf{e}_{1}(\bm{r}(s_{0}))\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\lang british
where 
\begin_inset Formula $0<\alpha\leq1$
\end_inset

 defines the integration finite step.
 In Euler integration we areusing the first two terms of the Taylor expansion.
 Conturo et al.
\begin_inset CommandInset citation
LatexCommand cite
key "CLC+99"

\end_inset

 used Euler integration and Basser et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "BPP+00"

\end_inset

 used a higher order approximation called 
\begin_inset Formula $4^{th}$
\end_inset

order Runge-Kutta scheme.
 
\end_layout

\begin_layout Standard

\change_inserted 1 1315344200

\lang british
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center

\change_inserted 1 1315344320
\begin_inset Graphics
	filename last_figures/FACT_EUDX.png
	scale 70
	rotateOrigin center

\end_inset


\change_unchanged

\end_layout

\begin_layout Plain Layout

\change_inserted 1 1315344200

\lang british
\begin_inset Caption

\begin_layout Plain Layout

\lang british
FACT (left) uses propagates with different steps indicated by the entering
 point on each voxel.
 Other deterministic methods use static steps.
 In that case interpolation is necessary.
 For example in EuDX (right) trilinear interpolation is used.
\change_inserted 1 1315344875

\begin_inset Note Note
status open

\begin_layout Plain Layout

\change_inserted 1 1315344711

\lang british
 (Picture modified by Stamatopoulos thesis)
\change_unchanged

\end_layout

\end_inset

 
\begin_inset Note Note
status open

\begin_layout Plain Layout

\change_inserted 1 1315345823

\lang british
With Euler or R-K intergration interpolation is needed.
\change_unchanged

\end_layout

\end_inset


\change_unchanged

\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Standard

\lang british
Wedeen et al.
\begin_inset CommandInset citation
LatexCommand cite
key "WWS+08"

\end_inset

 showed that one could derive the local orientation field of vectors 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none

\begin_inset Formula $\mathbf{e}$
\end_inset

 from the local maxima of the ODF calculated in each voxel.
 In that way we could visualise crossing distributions and depict crossing
 fibres.

\change_deleted 1 1315344982
 
\change_unchanged

\family default
\series default
\shape default
\size default
\emph default
\bar default
\noun default
\color inherit
 The authors
\change_deleted 1 1315344982
 
\change_unchanged
 suggests that diffusion MRI with sufficient signal to noise ratio (SNR)
 could make tractography a mathematically well-posed problem.
 However, we need much more scanning time to reach the necessary resolution
 which is often impractical.
 Our novel tractography algorithm EuDX presented in chapter
\begin_inset CommandInset ref
LatexCommand ref
reference "par:Euler-Delta-Crossings"

\end_inset

 shares some similarities with Basser's method however it uses Euler intergratio
n rather than R-K and can deal with crossing fibres as those generated from
 the maxima of different
\change_deleted 1 1315345136
 
\change_unchanged
 orientation distributions (see Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:Dipytracks"

\end_inset

).
\change_inserted 2 1312912487

\begin_inset Note Note
status open

\begin_layout Plain Layout

\change_inserted 2 1312912504

\lang british
Perhaps you should talk me through this paragraph?
\change_unchanged

\end_layout

\end_inset


\change_inserted 1 1315345155

\begin_inset Note Note
status open

\begin_layout Plain Layout

\change_inserted 1 1315345166

\lang british
Conturo might need referencing.
\change_unchanged

\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Standard

\lang british
In summary, the deterministic algorithms propagate tracks by making a series
 of discrete locally optimum decisions.
 These are fast, simple and easy to interpret.
 Usually, we depict them using streamlines.
 A streamline is a curve that is always tangent to the velocity vector of
 the flow.
 The disadvantages of deterministic algorithms are that a pathway either
 exists or not (no uncertainty) and that they do not explore the entire
 space of possible white matter tracts.
 In other words, local thresholding makes our tractography vulnerable to
 small noise aberrations.
 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\lang british
R-K2 is less vulnerable to noise because it looks a few steps ahead but
 it can also generate more non-existing tracks that we will actually have
 no use of.
\end_layout

\end_inset


\change_inserted 1 1315346323

\end_layout

\begin_layout Standard

\lang british
Probabilistic tractography is meant to deal with this problem of noise and
 propagate tracks even in regions where the tracking is unclear.
 This is made possible by assuming that uncertainty exists concerning the
 orientation of the fibre at each point of the track.
 
\change_inserted 1 1315346343

\end_layout

\begin_layout Standard
Imagine a particle in a seed voxel moving in a random manner with a constant
 speed within the brain whitematter.
 The transition probability to a neighbouring point depends on the local
 orientation distribution or underlying model.
 This yields high transitional probabilities along the main fibre directions.
 Hence, the particle will move in parallel to the fibre direction with a
 higher probability than in a perpendicular direction.
 In this probabilistic method, we start a large number of particles from
 the same seed point, let the particles move randomly according to the local
 ODF and count the number of times a voxel is reached by the path of a particle
 (connectivity values).
 The random walk is stopped when the particle leaves the white matter volume.
 The 3-dimensional image of the connectivity values is called a tractogram
 (see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:tractogram"

\end_inset

).
\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center

\lang british
\begin_inset Graphics
	filename figures/probtrack2.png
	lyxscale 35
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset Caption

\begin_layout Plain Layout

\lang british
A simplified example showing in (i) & (ii) the same dataset but in (i) the
 yellow line shows the result of deterministic tractography which is given
 by a single trajectory and in (ii) is given by connectivity matrix depicting
 with red the probability of different pathways throughout the hole slice.
 Here only 3 possible pathways are depicted for the ease of understanding.
 Finally, in (iii) an example is given where it shows that probabilistic
 tractography weights more closer connections.
 However it can tract further deep than deterministic tractography.
 
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset CommandInset label
LatexCommand label
name "fig:deterministic_probabilistic"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
We will try to illustrate the difference between the two approaches using
 a simplified 2D example shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:deterministic_probabilistic"

\end_inset

 (i,ii).
 Generalising afterwards in 3D is straightforward.
 
\change_inserted 1 1315346562

\end_layout

\begin_layout Standard

\lang british
Let's imagine that we have a 2D slice where in each pixel we have calculated
 a vector showing the primary direction for that specific pixel.
 This vector 
\begin_inset Formula $\mathbf{e}$
\end_inset

 could have been calculated from the tensor as the principal eigenvector
 or as a principal direction of a different model e.g.
 the maximum point of the ODF.
 Let's now think that we want to find the best track from seed A to seed
 Z.
 When using deterministic tractography we are using only the local direction
 information in every pixel therefore in a direction field as this of Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:deterministic_probabilistic"

\end_inset

(i) we will have to use only one track and this is the diagonal pathway
 with yellow colour.
 However there are other possible tracks as well in this diagram e.g rather
 than taking the diagonal we could go first up north from A and then right.
 
\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/tractogram_human_connectome.png
	scale 40

\end_inset


\end_layout

\begin_layout Plain Layout

\change_inserted 1 1315346407

\lang british
\begin_inset CommandInset label
LatexCommand label
name "Flo:tractogram"

\end_inset


\change_unchanged

\begin_inset Caption

\begin_layout Plain Layout

\lang british
The 3D distribution of voxels connected to the seed voxel is called a tractogram.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout

\lang british
Maxime page 213
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
Probabilistic tractography aims to identify all the possible tracks by assigning
 to each one of them a weight.
 All the weights of all the tracks together sum to 1.
 This is possible by generating samples from a probability distribution
 for every pixel.
 In this toy example shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:deterministic_probabilistic"

\end_inset

(ii) the orientation of the blue vectors can be represented by a single
 parameter, angle 
\begin_inset Formula $\omega$
\end_inset

.
 
\begin_inset Formula $\omega$
\end_inset

 here is a random variable that takes values from a probability distribution
 function (PDF).
 Now we have many possible directions to move next but with different probabilit
ies.
 The weights of all directions again sum to 1.
 After this explanation we can identify in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:deterministic_probabilistic"

\end_inset

(ii) that the most likely track is again the diagonal (with deep red) but
 there are other possible tracks (with lighter red) that are less likely.
 In the same diagram we show with 3 combined red arrows some of the many
 directions that are possible in each point.
 However, some are more certain than others.
\end_layout

\begin_layout Standard

\lang british
Let's try now to understand how a track is valued as more probable than
 others.
 In Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:deterministic_probabilistic"

\end_inset

(iii) we have drawn a very simple image with only two pixel rows and we
 are assuming that the probability of moving along the primary direction
 (shown with blue arrow) is 0.9 and there is only a secondary direction given
 by 0.1 (1-0.9) i.e.
 we assume for ease of understanding here only 2 directions.
 We can see that there is a discontinuity in position K.
 In that point an Euler based deterministic approach (without interpolation)
 would have to stop at K (see yellow line).
 The probabilistic method will continue tracking and it will generate two
 tracks that both reach the target.
 The probability of each track is calculated by multiplying the probability
 of a specific direction of each point.
 Therefore, the shorter and dark red track will have 
\begin_inset Formula $p_{s}=0.9^{7}\times0.1$
\end_inset

 and the longer and lighter red track will have 
\begin_inset Formula $p_{l}=0.9^{10}$
\end_inset

.
 It is obvious that 
\begin_inset Formula $p_{s}>p_{l}$
\end_inset

 and that the darker red track is more likely to exist according to this
 method.
\end_layout

\begin_layout Standard

\lang british
This method of multiplying the probabilities at each voxel along the paths
 has been proposed by many 
\begin_inset CommandInset citation
LatexCommand cite
key "FW05"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "anwander2007cbp"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "bjornemoMICCAI02"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "HTJ+03"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "Hosey2005MagResMed"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "PPC+05"

\end_inset

 and used in many software packages as well 
\change_deleted 1 1315346733
as PICO
\begin_inset CommandInset citation
LatexCommand cite
key "PHW03"

\end_inset

 in Camino 
\change_inserted 1 1315346733

\begin_inset Note Note
status open

\begin_layout Plain Layout

\change_inserted 1 1315346748

\lang british
as PICO
\begin_inset CommandInset citation
LatexCommand cite
key "PHW03"

\end_inset

 in Camino? 
\change_unchanged

\end_layout

\end_inset


\change_unchanged
, 
\change_inserted 1 1315345950
FSL
\change_unchanged
 FDT 
\begin_inset CommandInset citation
LatexCommand cite
key "Behrens2003MRM,behrens2005rca,Behrens2003NatureNeuroscience"

\end_inset

 in FSL, and others.
 However there are some problems.
\change_inserted 1 1315346625

\end_layout

\begin_layout Standard

\change_inserted 1 1315345996

\lang british
\begin_inset Note Note
status open

\begin_layout Plain Layout

\change_inserted 1 1315346034
THE INFORMATION ABOUT PROBABILITIES HERE PERHAPS IS TOO SPECIFIC AND NEEDS
 TO BE TRANSFERED IN CHAPTER 3
\change_unchanged

\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Subsection

\lang british
Known problems
\begin_inset CommandInset label
LatexCommand label
name "sub:Known-problems"

\end_inset


\end_layout

\begin_layout Standard

\lang british
Although the probabilistic methods are able to identify many known tracts,
 they miss several large tracts such as the visual pathways LGN-MT and callosal
 MT
\begin_inset CommandInset citation
LatexCommand cite
key "Sherbondy2008JVision"

\end_inset

.
 The visual pathways are useful test cases for algorithmic development and
 testing because they diverge and bend significantly.
 Probabilistic methods have the advantages that they expand the track search
 space beyond deterministic algorithms and that they can easily expand with
 complex models supporting crossings (usually not more than 2 crossings).
 However, they don't compute an accurate probability of brain connections.
 The phraseology 
\begin_inset Quotes eld
\end_inset

Connection probabilities
\begin_inset Quotes erd
\end_inset

 or 
\begin_inset Quotes eld
\end_inset

estimation of global connectivity
\begin_inset Quotes erd
\end_inset

 or 
\begin_inset Quotes eld
\end_inset

the probability of the existence of a connection through the data field,
 between any two distant points
\begin_inset Quotes erd
\end_inset

 found in 
\begin_inset CommandInset citation
LatexCommand cite
key "Behrens2003MRM"

\end_inset

 can be very misleading because someone might believe that they represent
 the actual connectivity profile of the subject.
 For example we are certain (with probability 1) that LGN (lateral geniculate
 nucleus) is connected to V1 and V2 (primary visual cortex) in any healthy
 brain however the estimated connection probability in FDT is much less
 than 1.
 In addition, current probabilistic algorithms fail to identify pathways
 even when they are known to exist or in a few cases they generate pathways
 even when they do not exist 
\begin_inset CommandInset citation
LatexCommand cite
key "Behrens2007NeuroImage,jbabdi2007bfg,sherbondy2006mma"

\end_inset

.
 For example no connections between left MT+ and the posterior portion of
 Corpus Callosum were found in PiCo 
\begin_inset CommandInset citation
LatexCommand cite
key "PHW03"

\end_inset

 or FDT although it is well established that they do exist.
\end_layout

\begin_layout Standard

\lang british
In 2008 Sherbondy
\begin_inset CommandInset citation
LatexCommand cite
key "Sherbondy2008JVision"

\end_inset

 in order to try to deal with the problems explained in the previous paragraph
 introduced an algorithm that separates the pathway sampling and scoring
 steps.
 In that way the scoring does not depend any more on whether we are tracking
 from seed A to seed B or from B to A therefore, it assumes symmetry when
 the other probabilistic methods do not.
 At the same time Sherbondy's method assumes independence between different
 tracts i.e.
 path 
\begin_inset Formula $A\rightarrow B$
\end_inset

 is independent from 
\begin_inset Formula $A\rightarrow C$
\end_inset

 or 
\begin_inset Formula $K\rightarrow L$
\end_inset

.
 This does not happening in most other methods where a pathway depend on
 other pathways starting from the same seed.
 So, Sherbondy's method was designed to estimate connections that are known
 to exist.
 The disadvantage of this method is that it needs a lot of user interaction
 to add the known tracks and the user needs to be a specialist in white
 matter anatomy otherwise the results might be biased.
 Other tools like FSL's FDT uses waypoint masks to reduce the effect of
 this problem.
 But these need to be defined by the user defined too.
 
\end_layout

\begin_layout Standard

\lang british
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center

\lang british
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="3">
<features>
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Deterministic
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Probabilistic
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Voxel Noise Resistance
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Less
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
More
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Non-existing Tracts
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Yes
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Execution Time
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Fast
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Slow
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Memory Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Less
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
More
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Biased on Tract Length
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\lang british
Yes
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset Caption

\begin_layout Plain Layout

\lang british
Known problems with deterministic and probabilistic tractography 
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset CommandInset label
LatexCommand label
name "tbl:detvsprob"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang british
A small summary of the comparative strengths of deterministic and probabilistic
 tractography is given in the qualitative Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tbl:detvsprob"

\end_inset

 where we can see that although deterministic tractography will most likely
 stop more often at a noisy voxels it is much faster to calculate than probabili
stic tractography.
 They both can generate non-existing tracts because of propagation errors
 or errors in the reconstruction step.
 For noise related problems e.g.
 motion and eddy correction and possible solutions see 
\begin_inset CommandInset citation
LatexCommand cite
key "Hosey2005MagResMed,BPP+00,jones1999osm,HM96,ZHK+06,andersson2002mbm,WirestamMRM2006"

\end_inset

, and for methodology and ideas comparing across subjects see 
\begin_inset CommandInset citation
LatexCommand cite
key "KanaanPsych2006,moriBook,maddah_phdthesis2008,deriche1990dcm,DavisTMI02,ODonnell_MICCAI09,DoughertyPNAS2005,DauguetNeuroImage2007"

\end_inset

.
 We showed in the previous section that probabilistic tractography usually
 gives higher weight to shorter pathways.
 In the deterministic tractography an opposite weighting is required as
 longer pathways will have higher representation in the datasets and so
 it is more likely to have more seeds along a long track rather than along
 a short track.
 Therefore, a normalization by length both for probabilistic and deterministic
 tractography are highly recommended.
 
\change_inserted 1 1315346758

\end_layout

\begin_layout Standard

\change_inserted 1 1315346766

\lang british
\begin_inset Note Note
status open

\begin_layout Plain Layout

\change_inserted 1 1315346780
CONNECT WITH MORE REVIEWS IN THE EUDX CHAPTER
\change_unchanged

\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Subsection
Segmentation
\change_inserted 2 1312913515

\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\change_inserted 2 1312913624
Should this section go before the tractography one, and set out terminology
 clearly.
 I'm not sure what the best combination of track, tract, path, pathway,
 fibre, ...
 to use!!! 
\change_unchanged

\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
The goal of the methods described in this thesis is to automatically ﬁnd
 and anatomically name regions of the white matter of the brain using diﬀusion
 MRI.
 
\end_layout

\end_inset

The white matter contains pathways known as ﬁbre tracts that connect functional
 areas of the brain.
 A diagram of commonly found ﬁbre tracts is sketched in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:association_fibers"

\end_inset

 and real fibre tracts are shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:real_brain"

\end_inset

.
 The white matter contains three types of ﬁbre tracts: commissural, association,
 and projection
\begin_inset CommandInset citation
LatexCommand cite
key "o2006cerebral"

\end_inset

.
 Commissural tracts connect related regions of the two cerebral hemispheres.
 Association fibres connect regions in the same hemisphere.
 Association fibres come in various sizes: the smallest fibres are completely
 within the cortex, the medium ones are called u-fibres and connect one
 gyrus to the next, and the longest association bundles connect diﬀerent
 lobes.
 Finally, projection fibres connect the cortex and subcortical structures
 such as the thalamus, basal ganglia, and spinal cord.
 
\end_layout

\begin_layout Standard
A major issue with white matter is that it is particularly dense (see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:real_brain"

\end_inset

) i.e.
 the boundaries between different tracts are very difficult to distinguish,
 many bundles cross or touch other bundles (see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:association_fibers"

\end_inset

) and most bundles diverge into smaller and smaller tracts as they reach
 and enter gray matter areas.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/Gray751.png
	scale 50
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Flo:association_fibers"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
Diagram showing principal systems of association fibres in the cerebrum.
 The white matter ﬁbre tracts are large bundles of axons that interconnect
 the gray matter processing areas both within and across hemispheres.
 The association fibres connect fibres from the same hemisphere.
 Picture from Gray's Anatomy #751 
\begin_inset CommandInset citation
LatexCommand cite
key "gray_anatomy"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Previously it was not possible to automatically create white matter models
 similar to these anatomical atlas diagrams of ﬁbre tracts in vivo.
 However, methods are now available to estimate white matter ﬁbre trajectories
 using diﬀusion MRI.
 In this thesis we present a method for segmentation of the trajectories
 estimated from diﬀusion MRI by automatically grouping them into anatomical
 regions or to be more accurate regions of similar proximity and shape character
istics.
 This is the main topic of chapter 4 where we propose QuickBundles an extremely
 efficient algorithm for tractography segmentation.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/association_pathways2.png
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Flo:real_brain"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
Fibre pathways are so densely packed in the real brain that a segmentation
 algorithm of some kind looks like a possible solution for the neurosurgery
 planning of the future and further understanding of the brain connectivity.
 Picture from virtual hospital
\begin_inset CommandInset citation
LatexCommand cite
key "williams1999human"

\end_inset

.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
There are three main goals which should be satisﬁed by an automatic tractography
 segmentation algorithm
\begin_inset CommandInset citation
LatexCommand cite
key "o2006cerebral"

\end_inset

: automatic grouping of like trajectories into regions, region correspondence
 across subjects, and anatomical labeling of regions.
 Our ability to perform automatic, subject-speciﬁc deﬁnition of the white
 matter ﬁbre tracts has applications in neuroanatomical visualization, neurosurg
ical planning, and neuroscientiﬁc studies of white matter integrity, structure,
 and variability.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename last_figures/bundles_invert2.png
	scale 40
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Flo:PBC_labels"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
An example of a tractography segmentation based on labeling provided by
 a neuroanatomist.
 A major project of this thesis is to automatically find the labels or simplify
 the work of an expert by clustering tractographies.
 CST: Corticospinal Tract, FX: Fornix, CG: Cingulum Bundle, SLF: Superior
 Longitudinal Fasciculus, ARC: Arcuate Fasciculus, IOF: Inferior Occipitofrontal
 Fasciculus, CC-FM: Corpus Callosum Forceps Major, UNC: Uncinate Fasciculus.
 Data and labels from braincompetition.org
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
In the next chapters we will use the following definitions.
 Define a track (or streamline) as a polyline 
\begin_inset Formula $s=\{\mathbf{x_{1}},...,\mathbf{x_{n}}\}$
\end_inset

, where 
\begin_inset Formula $\mathbf{x\in}\mathbf{\mathbb{R}}^{3}$
\end_inset

.
 Then the entire tractography is defined as 
\begin_inset Formula $T=\{s_{1},...,s_{m}\}\sim\mathfrak{T}$
\end_inset

, where usually the number of tracks is 
\begin_inset Formula $|T|\simeq2\times10^{5}-2\times10^{6}$
\end_inset

.
 For an anatomical (physical) bundle (tract) e.g.
 arcuate fasciculus we use 
\begin_inset Formula $\upsilon$
\end_inset

 and for a fibre bundle we use 
\begin_inset Formula $u$
\end_inset

 where 
\begin_inset Formula $u\subset T$
\end_inset

, which approximates 
\begin_inset Formula $\upsilon$
\end_inset

.
 We think it is very important to always have in mind that we can only approxima
te a real tract.
 
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Grid-based Q-space Reconstructions
\begin_inset CommandInset label
LatexCommand label
name "sec:Grid-based-Q-space-Reconstructions"

\end_inset


\end_layout

\begin_layout Subsection
Overview
\end_layout

\begin_layout Standard
The idea that only the orientation information from the diffusion signal
 is adequate for accurate tractography generation is under question.
 We propose a new method based on the work of Yeh et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Yeh2010"

\end_inset

 who extends the current derivations for diffusion signal reconstruction
 and provides both scalar and vector metrics that facilitate the understanding
 of the underlying signal and its use for fast and accurate tractography.
 The key issue is the reentrance of the spin density as an important part
 of the diffusion voxel reconstruction.
 The spin density together with the diffusion propagator give rise to the
 spin propagator.
 From the spin propagator both old metrics like FA and MD can be calculated
 non-parametrically along with new metrics as NPA which give higher insight
 on the underlying signal in a model free fashion.
 We also show important comparisons between FA and QA0 (quantitative anisotropy
 - first component) in different acquisition paradigms.
 QA a new voxel vector metric introduced by 
\begin_inset CommandInset citation
LatexCommand cite
key "Yeh2010"

\end_inset

.
\end_layout

\begin_layout Subsection
Theory
\end_layout

\begin_layout Standard
The starting point is the classical formulation seen in eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:kq"

\end_inset

 of joint k-space and q-space imaging (Calaghan 8.3.1 p.
 438)
\begin_inset CommandInset citation
LatexCommand cite
key "Callaghan1991OUP"

\end_inset

 using the narrow pulse gradient spin echo (PGSE) sequence of Tanner and
 Stejskal
\end_layout

\begin_layout Standard
\align center
\begin_inset Formula \begin{eqnarray}
RF(\mathbf{k},\mathbf{q}) & = & \int\rho(\mathbf{r})\exp(j2\pi\mathbf{k}\cdot\mathbf{r})\int p_{\Delta}(\mathbf{r},\mathbf{R})\exp(j2\pi\mathbf{q}\cdot\mathbf{R})d\mathbf{R}d\mathbf{r}\label{eq:kq}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
Here 
\begin_inset Formula $RF$
\end_inset

 is the complex RF signal measured at spatial wave number 
\begin_inset Formula $\mathbf{k}$
\end_inset

 and magnetic gradient wave number 
\begin_inset Formula $\mathbf{q}$
\end_inset

, 
\begin_inset Formula $\rho$
\end_inset

 is the local spin density (number of protons per unit volume contributing
 to the RF signal), 
\begin_inset Formula $\Delta$
\end_inset

 is the diffusion time scale of the sequence, 
\begin_inset Formula $p_{\Delta}$
\end_inset

 is the average diffusion propagator (transition probability distribution),
 
\series bold

\begin_inset Formula $\mathbf{r}$
\end_inset


\series default
 is the voxel coordinate and 
\begin_inset Formula $\mathbf{R}$
\end_inset

 is the diffusion displacement.
 
\end_layout

\begin_layout Standard
The k-space reconstruction gives us diffusion weighted image data 
\begin_inset Formula $S$
\end_inset

 which reveal the average propagator 
\begin_inset Formula $p_{\Delta}$
\end_inset

 
\begin_inset CommandInset citation
LatexCommand cite
key "Wedeen"

\end_inset

 of each voxel 
\end_layout

\begin_layout Standard
\align center
\begin_inset Formula \begin{eqnarray}
S(\mathbf{r},\mathbf{q}) & = & \int\rho(\mathbf{r})p_{\Delta}(\mathbf{r},\mathbf{R})\exp(j2\pi\mathbf{q}\cdot\mathbf{R})d\mathbf{R}\label{eq:W}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
In order to represent the average propagator in the scale of spin quantity
 Yeh et al.
\begin_inset CommandInset citation
LatexCommand cite
key "Yeh2010"

\end_inset

 introduced a 
\emph on
spin density function 
\emph default
which is estimated by scaling the average propagator 
\begin_inset Formula $p_{\Delta}$
\end_inset

with the spin density 
\begin_inset Formula $\rho$
\end_inset

, i.e.
 
\begin_inset Formula $Q(\mathbf{r},\mathbf{R})=\rho(\mathbf{r})p_{\Delta}(\mathbf{r},\mathbf{R})$
\end_inset

.
 
\end_layout

\begin_layout Standard
\align center

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
\lang british
\begin_inset Formula \begin{eqnarray}
S(\mathbf{r},\mathbf{q}) & = & \int Q(\mathbf{r},\mathbf{R})\exp(j2\pi\mathbf{q}\cdot\mathbf{R})d\mathbf{R}\label{eq:W2Q}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
We can apply the inverse fourier transform in eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:W2Q"

\end_inset

 and obtain
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
Q(\mathbf{r},\mathbf{R}) & = & \int S(\mathbf{r},\mathbf{q})exp(-j2\pi\mathbf{q}\cdot\mathbf{R})d\mathbf{q}\label{eq:Q2S_complex}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
Because
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
\lang british
 
\begin_inset Formula $Q(\mathbf{r},\mathbf{R})$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\noun default
\color inherit
\lang english
 is real, 
\begin_inset Formula $S(\mathbf{r},\mathbf{q})$
\end_inset

 is symmetric (even) in q-space, i.e.
 
\begin_inset Formula $S(\mathbf{r},\mathbf{q})=S(\mathbf{r},-\mathbf{q})$
\end_inset

, so we can use directly the fourier cosine transform 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
Q(\mathbf{r},\mathbf{R}) & = & \int S(\mathbf{r},\mathbf{q})cos(2\pi\mathbf{q}\cdot\mathbf{R})d\mathbf{q}\label{eq:cosine_transform}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
and obtain the spin distribution function 
\begin_inset Formula $\psi$
\end_inset

 from an unweighted truncated radial projection 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
\psi_{Q}(\mathbf{r},\mathbf{\hat{u}}) & = & \intop_{0}^{L_{\Delta}}Q(\mathbf{r},L\mathbf{\hat{u}})dL\label{eq:SDF}\end{eqnarray}

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
!!! add here equations 5 & 6 from Frank's paper? and their matrix form
\end_layout

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $L_{\Delta}$
\end_inset

 is the diffusion sampling length.
 This parameter acts like a smoothing factor.
 The higher 
\begin_inset Formula $L_{\Delta}$
\end_inset

 the more detailed the SDF will be but also the more noisy.
 Typical values for the diffusion sampling length are 
\begin_inset Formula $[1.1\sigma-1.3\sigma]$
\end_inset

.
 Usually 
\begin_inset Formula $L_{\Delta}=1.2\sigma$
\end_inset

 is a good balance between noisy reconstruction and over-smoothing, according
 to 
\begin_inset CommandInset citation
LatexCommand cite
key "Yeh2010"

\end_inset

 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
where 
\begin_inset Formula $\sigma$
\end_inset

 stands for what? standard deviation?
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
We now apply this formulation under the assumption that the diffusion voxel
 can be represented by a single tensor model.
 eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:W"

\end_inset

 can be written in the form
\end_layout

\begin_layout Standard
\align center
\begin_inset Formula \begin{eqnarray}
S(\mathbf{q}) & = & S_{0}exp(-b\mathbf{q}^{T}D\mathbf{q})\label{eq:Tensor}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $S_{0}$
\end_inset

 is the image when b-value is equal to 0, 
\begin_inset Formula $b$
\end_inset

 is the b-value for a specific direction and 
\begin_inset Formula $D$
\end_inset

 is a 
\begin_inset Formula $3x3$
\end_inset

 matrix, known as the diffusion tensor.
 Then from eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Q2S_complex"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Tensor"

\end_inset

 the Fourier transform of 
\begin_inset Formula $S$
\end_inset

 is equal to 
\end_layout

\begin_layout Standard
\align center
\begin_inset Formula \begin{eqnarray}
Q(\mathbf{R}) & = & \int S_{0}\exp(-b\mathbf{q}^{T}D\mathbf{q})\exp(-j2\pi\mathbf{q}\cdot\mathbf{R})d\mathbf{q}\label{eq:FourierW}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
The same equation in its triple integral form can be written as 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
Q(R) & =S_{0} & \iiint\exp(-b\sum_{i=1}^{3}q_{i}^{2}\lambda_{i}-j2\pi\sum_{i=1}^{3}q_{i}R_{i})dq_{1}dq_{2}dq_{3}\nonumber \\
 & =S_{0} & \iiint\prod_{i=1}^{3}exp(-bq_{i}^{2}\lambda_{i}-j2\pi q_{i}R_{i})dq_{1}dq_{2}dq_{3}\nonumber \\
 & =S_{0} & \prod_{i=1}^{3}\int\exp(-bq_{i}^{2}\lambda_{i}-j2\pi q_{i}R_{i})dq_{i}\nonumber \\
 & =S_{0} & \prod_{i=1}^{3}\int\exp(-b\lambda_{i}[q_{i}^{2}+\frac{j2\pi R_{i}}{b\lambda_{i}}q_{i}])dq_{i}\nonumber \\
 & =S_{0} & \prod_{i=1}^{3}\int\exp\{-b\lambda_{i}[(q_{i}+\frac{j\pi R_{i}}{b\lambda_{i}})^{2}+\frac{\pi^{2}R_{i}^{2}}{b^{2}\lambda_{i}^{2}}]\}\nonumber \\
 & =S_{0} & \prod_{i=1}^{3}\int\exp\{-b\lambda_{i}(q_{i}+\frac{j\pi R_{i}}{b\lambda_{i}})^{2}\}exp\{-\frac{\pi^{2}R_{i}^{2}}{b\lambda_{i}}\}\label{eq:NextQ}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
In that stage we could try to make use of the formula 
\begin_inset Formula $\int\frac{1}{\sqrt{2\pi\sigma^{2}}}\exp(-\frac{(x-\mu)^{2}}{2\sigma^{2}})dx=1$
\end_inset

.
 Now we can see that 
\begin_inset Formula $b\lambda_{i}=1/2\sigma^{2}$
\end_inset

 and 
\begin_inset Formula $\mu$
\end_inset

 corresponds to 
\begin_inset Formula $\mu=-jR_{i}/b\lambda_{i}$
\end_inset

.
 Therefore, eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:NextQ"

\end_inset

 can now be written as 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
Q(\mathbf{R}) & =S_{0} & \prod_{i=1}^{3}\sqrt{\frac{\pi}{b\lambda_{i}}}\exp(-\frac{\pi^{2}R_{i}^{2}}{b\lambda_{i}})\nonumber \\
 & =S_{0} & \left(\frac{\pi}{b}\right)^{3/2}\frac{1}{\sqrt{\prod_{i=1}^{3}\lambda_{i}}}\exp(-\frac{\,\,\pi^{2}}{b}\mathbf{R}^{T}D^{-1}\mathbf{R})\label{eq:TensorQ}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $D$
\end_inset

 is the diffusion tensor.
 We can replace the displacement vector 
\begin_inset Formula $\mathbf{R}$
\end_inset

 with a scalar value 
\begin_inset Formula $L$
\end_inset

 and a unit vertor 
\begin_inset Formula $\hat{u}$
\end_inset

 i.e.
 
\begin_inset Formula $\mathbf{R}=L\hat{\mathbf{u}}$
\end_inset

 and from eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:TensorQ"

\end_inset

 we can replace 
\begin_inset Formula $\frac{2\pi^{2}}{b}\mathbf{\hat{u}}^{T}D^{-1}\mathbf{\hat{u}}$
\end_inset

 with 
\begin_inset Formula $k$
\end_inset

 and 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
\lang british

\begin_inset Formula $S_{0}\left(\frac{\pi}{b}\right)^{3/2}\frac{1}{\lambda_{1}\lambda_{2}\lambda_{3}}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\noun default
\color inherit
\lang english
 with 
\begin_inset Formula $\alpha$
\end_inset

.
 Using that last change of variables we can now write 
\begin_inset Formula \begin{eqnarray}
\psi_{Q}(\mathbf{r},\mathbf{\hat{u}}) & = & \intop_{0}^{L_{\Delta}}Q(\mathbf{r},L\mathbf{\hat{u}})dL\nonumber \\
 & = & \alpha\intop_{0}^{L_{\Delta}}\exp(-L^{2}\frac{k}{2})dL\label{eq:TensorQ2}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
Setting 
\begin_inset Formula $m=\sqrt{k}L$
\end_inset

 and using the derivation for the error function eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:TensorQ2"

\end_inset

 illustrates the remarkable result that we can calculate analyticaly the
 spin odf for gaussian diffusion using the cumulative distribution function
 
\begin_inset Formula $CDF$
\end_inset

.
 
\begin_inset Newline newline
\end_inset


\begin_inset Formula \begin{eqnarray}
\psi_{Q}(\mathbf{\hat{u}}) & = & \frac{\alpha}{\sqrt{k}}\intop_{0}^{\sqrt{k}L_{\Delta}}e^{-m^{2}/2}dm\\
 & = & \alpha\sqrt{\frac{2\pi}{k}}\left[CDF(\sqrt{k}L_{\Delta})-\frac{1}{2}\right]\label{eq:spinodf_cdf}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
This can be used as a check to compare the approximated/sampled spin odf
 that is derived in 
\begin_inset CommandInset citation
LatexCommand cite
key "Yeh2010"

\end_inset

 with eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:spinodf_cdf"

\end_inset

 for the case of gaussian diffusion.
 
\end_layout

\begin_layout Standard
What is also very interesting is to try to derive what the normalization
 factor should be for the spin odf in eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:TensorQ2"

\end_inset

.
 Because calculating a spherical intergral from eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:spinodf_cdf"

\end_inset

 seems at the moment very complicated we first work with the simpler gaussian
 diffusion ODF derived by Tuch 
\begin_inset CommandInset citation
LatexCommand cite
key "Tuch2004"

\end_inset

 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{equation}
\psi_{p_{\Delta}}=\frac{1}{Z}\sqrt{\frac{\pi\tau}{\mathbf{u}^{T}D^{-1}\mathbf{u}}}\label{eq:tuchs_gaussian_odf}\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
\frac{Z}{\sqrt{\pi\tau}} & = & \iintop_{S^{2}}(\mathbf{u}^{T}D^{-1}\mathbf{u})^{-\frac{1}{2}}d\mathbf{u}\label{eq:spherical_integral_Z}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
Lets now define 
\begin_inset Formula $f_{D}(\mathbf{u})=(\mathbf{u}^{T}D^{-1}\mathbf{u})^{-\frac{1}{2}}$
\end_inset

.
 From 
\begin_inset CommandInset citation
LatexCommand cite
key "olver2010nist"

\end_inset

 (19.31.2) we know that we can calculate the following integral on the entire
 space (eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:hole_space_known"

\end_inset

).
 By expanding it in polar form we can find surface integral needed in eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:spherical_integral_Z"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
MHG & = & \iiint f_{D}(x)e^{-|x|^{2}}dx\label{eq:hole_space_known}\\
 & = & \intop_{0}^{\infty}\left[\iint f_{D}(ru)du\right]e^{-r^{2}}r^{2}dr,\qquad x=ru\:(polar)\label{eq:hole_space_polar}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
However we know that 
\begin_inset Formula $f_{D}(r\mathbf{u})=((r\mathbf{u})^{T}D^{-1}(r\mathbf{u}))^{-\frac{1}{2}}=r^{-1}(\mathbf{u}^{T}D^{-1}\mathbf{u})^{-\frac{1}{2}}$
\end_inset

 therefore 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray*}
MHG & = & \intop_{0}^{\infty}\left[\iint f_{D}(u)du\right]e^{-r^{2}}rdr\\
 & = & \iint f_{D}(u)du\intop_{0}^{\infty}re^{-r^{2}}dr\\
 & = & \frac{1}{2}\iint f_{D}(u)du\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
Consequently,
\begin_inset Formula $\frac{Z}{\sqrt{\pi\tau}}=2MHG$
\end_inset

 where MHG is the multivariate hypergeometric function with 
\begin_inset Formula $\mu=-\frac{1}{2}$
\end_inset

,
\begin_inset Formula $B=I$
\end_inset

,
\begin_inset Formula $n=3$
\end_inset

 and 
\begin_inset Formula $\lambda_{1},\lambda_{2},\lambda_{3}$
\end_inset

 the eigenvalues of 
\begin_inset Formula $\mathbf{A}$
\end_inset

 derived from 
\begin_inset CommandInset citation
LatexCommand cite
key "olver2010nist"

\end_inset

 (19.31.2) & (19.16.9).
 Therefore, 
\begin_inset Formula \begin{eqnarray*}
\frac{Z}{\sqrt{\pi\tau}} & = & 2MHG\\
 & = & \frac{2\pi^{\frac{3}{2}}\Gamma(1)}{\sqrt{det(I)}\Gamma(\frac{3}{2})}R_{-\frac{1}{2}}(\frac{1}{2},\frac{1}{2},\frac{1}{2};\lambda_{1},\lambda_{2},\lambda_{3})\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
and 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none

\begin_inset Formula $R_{-\frac{1}{2}}=\frac{1}{2}\intop_{0}^{\infty}t^{0}(t+\lambda_{1})^{-\frac{1}{2}}(t+\lambda_{2})^{-\frac{1}{2}}(t+\lambda_{3})^{-\frac{1}{2}}dt$
\end_inset

 with 
\begin_inset Formula $\alpha=\frac{1}{2}$
\end_inset

 and 
\begin_inset Formula $\alpha'=1$
\end_inset

.
\end_layout

\begin_layout Standard
Given 
\begin_inset Formula $\lambda_{1},\lambda_{2},\lambda_{3}$
\end_inset

 we can integrate numerically or even possibly analytically.
 For the isotropic case the integral simplifies to 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none

\begin_inset Formula $\frac{1}{2}\intop_{0}^{\infty}t^{0}(t+\lambda)^{-\frac{3}{2}}dt=\frac{1}{\sqrt{\lambda}}$
\end_inset

 and for the cylindrical case (
\begin_inset Formula $\lambda_{2}=\lambda_{3}$
\end_inset

) to 
\begin_inset Formula $\frac{1}{2}\intop_{0}^{\infty}(t+\lambda_{1})^{-\frac{1}{2}}(t+\lambda_{2})^{-1}dt$
\end_inset

.
\end_layout

\begin_layout Subsection
From the sODF to FA
\end_layout

\begin_layout Standard
As 
\begin_inset Formula $FA(\lambda_{1},\lambda_{2},\lambda_{3})$
\end_inset

 is a function of the eigen-values of the diffusion tensor model we could
 try to approximate directly FA from the sODF by finding 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none

\begin_inset Formula $\lambda_{1},\lambda_{2},\lambda_{3}$
\end_inset

 through the global maximum , equatorial maximum and inferior maximum of
 the sODF.
\end_layout

\begin_layout Standard

\lang british
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename Ldelta1_Ldelta_10.png
	scale 60
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout

\lang british
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
import scipy.stats.distributions as ssd 
\begin_inset Newline newline
\end_inset

used ssd.norm.cdf
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

if k=0 then cdf = NaN but 
\begin_inset Formula $\lim_{k\rightarrow0}\backsimeq0.398$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
What is QA?
\end_layout

\begin_layout Standard
QA is defined by the sODF value at the resolved fibre orientation 
\begin_inset Formula $\hat{\mathbf{u}}$
\end_inset

 (local maximum) minus the isotropic component (global minimum) for the
 voxel.
 QA can be also very easily normalized by the maximum sODF value of all
 voxels.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename QA.svg

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
The sphere represents the isotropic component of the sODF (star) which will
 be removed.
 The remainders are the QA components
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/dsi_studio_result.png
	scale 40

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Multiple crossings using the peak directions from the sODF.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Hey !!!!!
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
lstparams "basicstyle={\footnotesize},breaklines=true,mathescape=true,tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

peaks=odf.copy()
\end_layout

\begin_layout Plain Layout

for all faces
\end_layout

\begin_layout Plain Layout

	$f_0,f_1,f_2$ = face
\end_layout

\begin_layout Plain Layout

	$d_0,d_1,d_2$ = odf[$f_0$],odf[$f_1$],odf[$f_2$]
\end_layout

\begin_layout Plain Layout

	if $d_0$ > $d_1$ and $d_2$
\end_layout

\begin_layout Plain Layout

		peaks[$f_0$]=peaks[$f_1$]=0
\end_layout

\begin_layout Plain Layout

		continue
\end_layout

\begin_layout Plain Layout

	if $d_1$ > $d_0$ and $d_2$
\end_layout

\begin_layout Plain Layout

		peaks[$f_0$]=peaks[$f_2$]=0
\end_layout

\begin_layout Plain Layout

		continue
\end_layout

\begin_layout Plain Layout

	if $d_2$ > $d_0$ and $d_1$
\end_layout

\begin_layout Plain Layout

		peaks[$f_2$]=peaks[$f_1$]=0
\end_layout

\begin_layout Plain Layout

		continue
\end_layout

\begin_layout Plain Layout

peaks = peaks[0:len(peaks)/2]
\end_layout

\begin_layout Plain Layout

indices = where(peak>0)
\end_layout

\begin_layout Plain Layout

return sort(peaks),sort(indices)
\end_layout

\begin_layout Plain Layout

 
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Peak Finding 
\begin_inset Newline newline
\end_inset

Using a symmetric evenly distributed sphere
\begin_inset Newline newline
\end_inset

Input: odf, faces
\begin_inset Newline newline
\end_inset

Output: peaks and indices in descending order
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
asdfas
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename peak_finding_angle_resolution.svg
	scale 30
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Caption

\begin_layout Plain Layout
A is local maximum and B are other possible local maxima.
 This simple illustration shows that the triangulation of the sphere is
 important for the determination of closed peaks and that peaks which belong
 to the same triangle cannot be determined.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
What is NPA?
\end_layout

\begin_layout Standard
Local voxelwise measures such as fractional anisotropy (FA), apparent diffusivit
y coefficient (ADC), or mean diffusivity (MD) [1,2] have been extensively
 adopted in clinical and applied research practice based on diffusion weighted
 MR imaging (dMRI).
 This underlines the need for valid and reliable measures which can indicate
 the degree of local organisation of white matter in the brain.
 The measures listed above are based on the parametric simple diffusion
 tensor (SDT) model 
\begin_inset CommandInset citation
LatexCommand cite
key "Basser1994"

\end_inset

 which works well when there is a single dominant fibre direction but is
 also known not to give valid information if the local organisation is more
 complex 
\begin_inset CommandInset citation
LatexCommand cite
key "Yeh2010,Tuch2002ThesisMIT"

\end_inset

.
 We show how model-free, alternatives can yield non-parametric anisotropy
 and directionality measures (NPA).
 These are constructed from the spin orientation distribution function (sODF).
 We apply exact analytical results which show the form of the sODF when
 the single tensor model is correct, and further indicate how the tensor's
 parameters may be estimated from this model-free approach.
 We compare the performance of these parametric and non-parametric measures
 for simulated data.
\end_layout

\begin_layout Standard
Simulations were computed for a 
\begin_inset Formula $102$
\end_inset

-point grid sampling scheme, with a maximum b-value of 
\begin_inset Formula $4000\, s/mm^{2}$
\end_inset

.
 The simulated fibre was aligned with the gradient frame of reference, and
 the diagonal elements of the diffusion tensor, D, where chosen to match
 typical values for white matter: 
\begin_inset Formula $\lambda_{1}=1.4x10^{-3}$
\end_inset

 
\begin_inset Formula $mm^{2}/s$
\end_inset

, and 
\begin_inset Formula $\lambda_{2}=\lambda_{3}=0.35x10^{-3}$
\end_inset

 
\begin_inset Formula $mm^{2}/s$
\end_inset

.
 Variable fibre orientation was realised by spatially rotating the simulated
 fibres at discrete orientations.
 100 orientations were used, which spanned uniformly the space of 
\begin_inset Formula $(\theta,\phi)$
\end_inset

.
 
\end_layout

\begin_layout Standard
In addition to the SDT a two compartment model with an isotropic component
 was added with volume fraction 0.5 and diffusivity 
\begin_inset Formula $0.7x10^{-3}$
\end_inset

.
 For each acquisition scheme and fibre type, the “ideal” (noise-free) diffusion
 weighted signals were calculated according to the SDT model, assuming a
 constant ideal value of the baseline signal 
\begin_inset Formula $S_{0}=100$
\end_inset

.
 Complex Gaussian noise was then superimposed upon the ideal signals to
 provide the complex noise-contaminated signals and their magnitude was
 then obtained.
 This results in noisy values with a Rician distribution, which can be scaled
 in order to set the signal to noise ratio to any desired level.
 In this study the SNRs were 
\begin_inset Formula $20,40,60,80,$
\end_inset

 and 
\begin_inset Formula $100$
\end_inset

.
 The sODF and SDT were fitted using 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
texttt{dipy}
\end_layout

\end_inset

 (diffusion imaging in python http://nipy.org/dipy).
 
\end_layout

\begin_layout Standard
The sODF was calculated for a tesselated spherical icosahedron with 362
 vertices.
 Two values (1.2 and 3.5) were used for 
\begin_inset Formula $L_{\Delta}$
\end_inset

, the diffusion sampling length.
 Non-parametric FA, NPA, was calculated from the sODF by 
\end_layout

\begin_layout Enumerate
locating the vertex 
\begin_inset Formula $V_{1}$
\end_inset

 with maximum sODF value 
\begin_inset Formula $max_{1}$
\end_inset

; 
\end_layout

\begin_layout Enumerate
with 
\begin_inset Formula $V_{1}$
\end_inset

 as pole, locating the vertex 
\begin_inset Formula $V_{2}$
\end_inset

 on the corresponding equatorial band of width ±5 degrees with maximum sODF
 value 
\begin_inset Formula $max_{2}$
\end_inset

; 
\end_layout

\begin_layout Enumerate
locating a vertex 
\begin_inset Formula $V_{3}$
\end_inset

 in the equatorial band at approximately 90 degrees away from 
\begin_inset Formula $V_{2}$
\end_inset

, denoting the sODF value of 
\begin_inset Formula $max_{3}$
\end_inset

 at 
\begin_inset Formula $V_{3}$
\end_inset

.
 
\end_layout

\begin_layout Enumerate
With 
\begin_inset Formula $npd_{1}=max_{1}^{2}$
\end_inset

, 
\begin_inset Formula $npd_{2}=max_{2}^{2}$
\end_inset

, and 
\begin_inset Formula $npd_{3}=max_{3}^{2}$
\end_inset

, non-parametric anisotropy (NPA) was calculated by applying the classical
 FA 
\begin_inset CommandInset citation
LatexCommand cite
key "Correia2009"

\end_inset

 formula to the 3 values (
\begin_inset Formula $npd_{1},npd_{2},npd_{3}$
\end_inset

).
 
\end_layout

\begin_layout Paragraph

\series medium
The rationale for the squared sODF values is based on Tuch's formula eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:tuchs_gaussian_odf"

\end_inset

 for ODF in the SDT case which implies that the ODF in the 3 principal axis
 directions of the tensor is proportional to the square root of the correspondin
g eigenvalue of the tensor.
 We have further derived an exact formula 
\begin_inset Formula $max_{j}\propto\sqrt{\lambda_{j}}[\Phi(cL_{\Delta}/\sqrt{\lambda_{j}})-.5]$
\end_inset

 where 
\begin_inset Formula $c$
\end_inset

 is a constant that depends on the acquisition parameters, and 
\begin_inset Formula $\Phi$
\end_inset

 is the cumulative distribution function of the standard gaussian distribution.
 
\end_layout

\begin_layout Paragraph

\series medium
The average NPA and FA are presented below for 200 simulations for each
 noise level, and single fibres with or without an isotropic component and
 with different diffusion sampling length.
 We can see that NPA gives very similar results with FA and as expected
 it is modulated by the degree of smoothing controlled by the value of the
 diffusion sampling length.
 
\end_layout

\begin_layout Paragraph

\series medium
We plan to extend this approach with voxels containing multiple peaks where
 FA would be unable to give an informative result and also extend it to
 other types of ODFs.
 In summary, we have shown that an informative new scalar anisotropy function
 (NPA) can be calculated without fitting just from the spin ODF which promises
 to be a model-free proxy for FA.
 NPA differs from GFA 
\begin_inset CommandInset citation
LatexCommand cite
key "Tuch2004"

\end_inset

 in that it uses just 3 values of the sODF with a geometric relationship
 instead of the entire ODF.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/NPA_L_Delta1.2.png
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Comparison of NPA with FA for single fibre with and without an isotropic
 compartment at a range of signal to noise ratios.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
asdflasf
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/NPA_L_Delta3.5.png
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
As above but with higher diffusion sampling length.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simulations were computed for a 102-point grid sampling scheme, with a maximum
 b-value of 4000s/mm2.
 
\end_layout

\begin_layout Plain Layout
Single fibre cases: The simulated fibre was first aligned with the gradient
 frame of reference to give a diagonal tensor.
 For each acquisition scheme and fibre type, the “ideal” (noise-free) diffusion
 weighted signals were calculated according to the diffusion tensor model
 [ref], assuming a constant ideal value of the baseline signal S0 = 100.
 Complex Gaussian noise was then superimposed upon the ideal signals to
 provide the complex noise-contaminated signals and their magnitude was
 then obtained.
 This results in noisy values with a Rician distribution, which can be scaled
 in order to set the signal to noise ratio to any desired level.
 Variable fibre orientation was realised by spatially rotating the simulated
 fibres at discrete orientations.
 100 orientations were used, which spanned uniformly the space of (theta,
 phi), 0 ≤ theta ≤ 180 and 0 ≤ phi ≤ 360.
 To evaluate the robustness of the results of each scheme in the presence
 of noise, the procedure of noise generation and creation of noisy data
 was repeated 1000 times.
 
\end_layout

\begin_layout Plain Layout
Two fibre cases: The first fibre was aligned with the gradient frame of
 reference, and the diagonal elements of the diffusion tensor, D1, where
 chosen to match typical values for white matter:
\begin_inset Formula $\lambda_{1}=1.4x10^{-3}$
\end_inset

 
\begin_inset Formula $mm^{2}/s$
\end_inset

, and 
\begin_inset Formula $\lambda_{2}=\lambda_{3}=0.35x10^{-3}$
\end_inset

 
\begin_inset Formula $mm^{2}/s$
\end_inset

.
 These correspond to 
\begin_inset Formula $FA=2^{-\frac{1}{2}}=0.7071$
\end_inset

.
 The diffusion tensor for the second fibre, D2, was obtained by rotating
 D1 by an angle theta around the y-axis.
 The noise-free diffusion weighted signals were calculated according to
 the two-tensor compartment model [ref].
 Rician noise was then added to this data, and scaled to different values
 of signal to noise ratio (SNR).
 
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Balance property in 64, 101 and 118 directions
\end_layout

\begin_layout Subsection
Robustness of GQI
\end_layout

\begin_layout Standard
GQI was shown to have comparable accuracy to other well established q-space
 methods when it comes to resolving crossing fibres.
 In addition, this is achievable with as little as 102 points on a grid
 sampling scheme, bringing the total acquisition time down to a clinically
 acceptable level.
 Another advantage of GQI is that it is also applicable to a shell sampling
 scheme.
 Despite their successes in tractography applications, q-space techniques
 have until now failed to produce scalar metrics that could replace the
 ones derived from the diffusion tensor model (e.g.
 mean diffusivity, MD, and fractional anisotropy, FA) in terms of their
 multi-subject comparability and specificity to pathology.
 The data acquired with a grid sampling scheme can still be used to estimate
 a diffusion tensor and respective scalar parameters, but the effects of
 the high b-values required for q-space imaging (
\begin_inset Formula $>2000s/mm^{2}$
\end_inset

) in the accuracy of the resulting DTI-based parameters has not been well
 characterized.
 The authors of GQI have also proposed a new scalar metric called quantitative
 anisotropy (QA), but its properties have not been compared to FA’s.
 In this study we will compare the estimated values of MD, FA and QA0 (first
 component of QA) obtained with grid and shell sampling schemes, in terms
 of their precision and ability to differentiate between different brain
 fibre populations.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/MartaISMRM2.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Fig:CSR_t-test"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
Sample results of the paired t-tests comparing CSR(FA) and CSR(QA0)
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Twelve healthy volunteers aged between 18 and 40 were scanned on a 3T scanner
 (TIM Trio, Siemens), using Siemens advanced diffusion work-in-progress
 sequence, and STEAM 
\begin_inset CommandInset citation
LatexCommand cite
key "merboldt1992diffusion,MAB04"

\end_inset

 as the diffusion preparation method.
 The field of view was 
\begin_inset Formula $240x240mm^{2}$
\end_inset

, matrix size 
\begin_inset Formula $96x96$
\end_inset

, and slice thickness 
\begin_inset Formula $2.5mm$
\end_inset

 (no gap).
 55 slices were acquired to achieve full brain coverage, and the voxel resolutio
n was 
\begin_inset Formula $2.5x2.5x2.5mm{}^{3}$
\end_inset

.
 Two sampling schemes were considered: a 102-point grid acquisition with
 a maximum b-value of 
\begin_inset Formula $4000\, s/mm^{2}$
\end_inset

, and a single shell acquisition using 118 non-collinear gradient directions
 and a b-value of 
\begin_inset Formula $1000\, s/mm^{2}$
\end_inset

.
 The two acquisition schemes were matched for total acquisition time (
\begin_inset Formula $14\, min\,37s$
\end_inset

), voxel resolution, and bandwidth.
 FA, MD and QA0 maps were then generated for each acquisition scheme and
 for the 12 volunteers using dipy (diffusion imaging in python [ref XXX]).
 All the FA datasets were non-linearly registered into MNI space using fsl
 tools, and the same transformation parameters were applied to MD and QA0
 maps 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
(Fig.# shows the FA and QA0 maps obtained for one volunteer)
\end_layout

\end_inset

.
 Fourteen ROIs of different brain regions were drawn in MNI space: putamen
 (left and right), caudate (left and right), thalamus (left and right),
 parasagittal white matter (left and right), pons, internal capsule (left
 and right), and genu, body and splenium of the corpus callosum.
 Small cubic ROIs were also constructed by finding the centroid of each
 anatomical ROI and using it as the centre for a 3x3x3 ROI.
 For each ROI we calculated the mean value for each metric, and the spatial
 coefficient of variation (CV) within the ROI (see eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:CV_roi"

\end_inset

).
 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
CV_{ROI} & = & \frac{\sigma_{x}}{<x>}=\frac{N_{voxels}\sqrt{\sum_{x_{i}\in ROI}(x_{i}-<x>)^{2}}}{\sqrt{N_{voxels}-1}\sum_{x_{i}\in ROI}x_{i}}\label{eq:CV_roi}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
The coefficient of variation of each ROI mean across subjects was also calculate
d, as a measure of each metric’s comparability between subjects.
 The contrast-to-scatter ratio (CSR) (calculated for FA in eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:CSR_FA"

\end_inset

) is a good measure of a metric’s ability to differentiate between different
 brain fibre populations [Cite CCorreia et al.
 Abstract 3556 ISMRM 2009].
 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
CSR(FA) & = & \frac{mean(FA)_{ROI_{1}}-mean(FA)_{ROI_{2}}}{\sqrt{var(FA)_{ROI_{1}}+var(FA)_{ROI_{2}}}}\label{eq:CSR_FA}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
Combining the left and right versions of each ROI, we have 9 ROIs of different
 brain populations, which can be used to define 36 pairs of ROIs, and the
 CSR of all metrics was calculated for each of these pairs.
 Paired t-tests were then conducted to compare the performance of each metric
 with the two acquisition schemes, and also to compare FA and QA0 directly
 for each acquisition scheme.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/MartaISMRM1.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Fig:t-test_QA0"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
Results of the paired t-test comparing the CVs across subjects for MD, FA
 and QA0.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The 102 grid sampling scheme produces significantly higher mean FA and QA0
 values than the ones obtained with the 118 shell scheme, while the opposite
 was observed for MD.
 The CSR results for FA and QA0 were not significantly different between
 the two acquisition schemes, but the 102 grid scheme produces significantly
 higher CSRs for MD for 26/36 ROI pairs (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:CSR_t-test"

\end_inset

).
 For MD, no significant different was found for the CV across subjects,
 but for FA and QA0 the 102 scheme produced results more comparable across
 the different volunteers (Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:t-test_QA0"

\end_inset

).
 For FA and MD the 102 scheme showed lower CV within ROIs, especially for
 white matter, but no difference was found for QA0.
 When comparing FA and QA0 directly, our results show that FA produces higher
 CSRs than QA0 for 23/36 ROI pairs for the 102 grid sampling, and for 19/36
 ROI pairs for the 118 scheme.
 FA also shows lower variation across subjects for both acquisition schemes.
 Finally, FA lower CVs within white matter ROIs, while QA0 shows less variabilit
y for grey matter.
 The results described and shown above were obtained with the cubic ROIs,
 but do not differ significantly when the same analysis was applied to larger
 anatomical ROIs.
\end_layout

\begin_layout Standard
Our results indicate that the MD and FA maps generated from a grid sampling
 scheme designed for GQI are still suitable for analysis, since they do
 not show poorer performance when compared to a single shell and low b-value
 acquisition.
 In fact, the overall results suggest that the 102 grid sampling produces
 slightly more robust results than the 118 shell acquisition.
 A previous study [Cite Correia et al.
 MRI 27: 163-75] has shown that metrics such as MD and FA benefit from the
 use of multiple b-values, which could explain the better performance of
 the 102 grid scheme.
 
\end_layout

\begin_layout Subsection
Comparing 12 vs 32 channels
\end_layout

\begin_layout Subsection
Conclusion
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Euler Delta Crossings Propagation
\begin_inset CommandInset label
LatexCommand label
name "par:Euler-Delta-Crossings"

\end_inset


\end_layout

\begin_layout Subsection
The problem
\end_layout

\begin_layout Standard
Tractography methods provide a tool to resolve major neuronal fibre bundles
 non-invasively and in-vivo 
\begin_inset CommandInset citation
LatexCommand cite
key "Catani2002NeuroImage"

\end_inset

.
 From the development of the first tractography algorithms 
\begin_inset CommandInset citation
LatexCommand cite
key "MCC+99,CLC+99"

\end_inset

 published nearly 12 years ago many methods have been published which depend
 strictly on the underlying voxel model or acquisition paradigm making it
 very difficult for other researchers to apply their methods and evaluate
 their datasets.
 
\end_layout

\begin_layout Standard
In this work we designed a purely deterministic method which is fast, accurate
 and comprehensive.
 But most importantly it can have as input model-based or model-free reconstruct
ion algorithms of any known algorithm or complexity.
 We call this algorithm EuDX.
 Eu stands for Euler Euler integration, D stands for Delta which is a function
 that combines together all the different stopping criteria and X stands
 for crossings.
 EuDX can deal with any number of crossings as long as your data support
 them.
 The purpose of this algorithm is to be faithful to the reconstruction results
 rather than try to correct or enhance them by introducing regional or global
 considerations which is the topic of other methods reviewed below.
 Therefore EuDX serves mainly as a robust method for quickly inspecting
 different reconstruction results using streamlines.
 EuDX is noise-friendly i.e.
 if a voxel is too noisy then EuDX will stop tracking on that voxel.
 This property is often useful when validating underlying orientation models.
 Branching is also supported by using trilinear interpolation.
 This method is an extension of the method used by Yeh et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Yeh2010"

\end_inset

 and Conturo et al.
\begin_inset CommandInset citation
LatexCommand cite
key "CLC+99"

\end_inset

 with the addition of supporting multiple anisotropic functions and multiple
 crossings.
\end_layout

\begin_layout Subsection
Overview
\end_layout

\begin_layout Standard
In sections 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Tractography"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Known-problems"

\end_inset

 we discussed some of the ideas and the problems behind the most popular
 propagation methods; deterministic and probabilistic.
 The focus in this section will be to give a more general overview and introduce
 many more methods.
\end_layout

\begin_layout Standard
Most tractography techniques can be grouped in three categories, as pointed
 out in Sotiropoulos thesis 
\begin_inset CommandInset citation
LatexCommand cite
key "sotiropoulos2010processing"

\end_inset

; local, global and simulated.
 Local approaches propagate a curve from a starting (seed) point using locally
 greedy criteria, i.e.
 tracking sequentially through orientation estimates in adjacent voxels.
 Global approaches identify the best path between two points of interest,
 according to some optimization criterion, rather than identifying paths
 arising from a single point.
 Simulated approaches comprise of algorithms that simulate the diffusion
 process or solve the diffusion equation to reconstruct white matter tracks.
\end_layout

\begin_layout Subsubsection
Local
\end_layout

\begin_layout Standard

\series bold
Deterministic 
\series default
tractography was the first to appear.
 Streamlines are created as trajectories orthograde and retrograde along
 an initial direction at a specific point (seed) in the 3D volume.
 In FACT
\begin_inset CommandInset citation
LatexCommand cite
key "MCC+99"

\end_inset

 streamlines are propagated in anequal steps governed by the entry point
 of the streamline in the voxel, Euler integration with equal steps was
 used in Conturo et al 
\begin_inset CommandInset citation
LatexCommand cite
key "CLC+99"

\end_inset

 and similarly Runge-Kutta integration was used in 
\begin_inset CommandInset citation
LatexCommand cite
key "BPP+00"

\end_inset

.
 
\end_layout

\begin_layout Standard
Deterministic approaches usually stop when a low anisotropy region is encountere
d (e.g.
 FA drops below 
\begin_inset Formula $0.2$
\end_inset

) to avoid propagation within CSF or GM regions or a large angle changes
 occur (e.g.
 larger than 
\begin_inset Formula $45^{\circ}$
\end_inset

) between successive steps to avoid unrealistically sharp turns.
 
\end_layout

\begin_layout Standard
Streamline methods can be also utilized when multiple orientations are estimated
 in a voxel.
 These can be obtained as the principal eigenvectors of multiple tensors
 fitted to the data 
\begin_inset CommandInset citation
LatexCommand cite
key "Tuch2002ThesisMIT"

\end_inset

, as the local peaks of the diffusion ODF estimated using DSI 
\begin_inset CommandInset citation
LatexCommand cite
key "wedeen2005mapping"

\end_inset

 or QBI 
\begin_inset CommandInset citation
LatexCommand cite
key "Tuch2004"

\end_inset

 and fibre ODFs 
\begin_inset CommandInset citation
LatexCommand cite
key "tournier2004direct"

\end_inset

.
 An approach to deal with these cases, chooses, upon entering a voxel, the
 orientation that produces the smallest curvature with the incoming path
 
\begin_inset CommandInset citation
LatexCommand cite
key "WWS+08"

\end_inset

.
 Another approach follows all orientations that do not exceed a curvature
 threshold, by initiating a new streamline per orientation 
\begin_inset CommandInset citation
LatexCommand cite
key "chao2008multiple"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "Descoteaux2009"

\end_inset

.
 
\end_layout

\begin_layout Standard
Streamline tractography utilizes only the fibre orientation estimates.
 Tensor deflection tractography (TEND) is a FACT variant that uses the whole
 DTI tensor rather than just its principal eigenvector to determine the
 direction of curve propagation 
\lang british

\begin_inset CommandInset citation
LatexCommand cite
key "LWT+03"

\end_inset


\lang english
.
 
\end_layout

\begin_layout Standard
All the methods presented until now are deterministic and provide binary
 connectivity information.
 A voxel B can be either connected or not connected to the seed S, depending
 on whether a streamline from S passes through B.
 
\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Streamline tractography utilizes only the fibre orientation estimates.
 In general, more information is available upon post-processing ofDWimages.
 For example, with DTI a diffusion tensor is computed.
 For perfectly spherical tensors the deflection angle is zero, while for
 oblate tensors, the deflection is towards the ellip- soid plane.
 Tensor deflection tractography is less sensitive to noise than streamline,
 as shown in simulations for straight tracts (Lazar et al., 2003).
 It can also propagate through regions of perpendicular fibre crossings,
 where the principal eigenvector of the underlying oblate tensor is meaningless.
 However, tensor deflection underestimates curvature for curved tracts.
 Furthermore, TEND results should be interpreted carefully, as an incoming
 direction that coincides with any of the tensor eigenvectors will not be
 deflected by that tensor; even if it is perpendicular to the principal
 eigenvector of a highly prolate tensor (Lazar et al., 2003).
 All the methods presented in this section are deterministic and provide
 binary connectivity information.
 A voxel B can be either connected or not connected to the seed S, depending
 on whether a streamline from S passes through B.
 To tackle this issue, a group of probabilistic tractography approaches
 have been developed and these are presented in the following section.
\end_layout

\end_inset


\lang british
 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\lang british
Other deterministic approaches can be found here A recent deterministic
 algorithm called Tensorlines
\begin_inset CommandInset citation
LatexCommand cite
key "weinstein1999tad"

\end_inset

 shares the problems of the other deterministic algorithms by failing in
 relatively sharp turns and Meyer's Loop.
 Furthermore, because these methods need a continuous field this necessitates
 the use of interpolation e.g.
 nearest, bicubic or trilinear.
 The amount and type of interpolation is another factor that can change
 dramatically the results of tractography and it is very rarely reported.
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\series bold
Probabilistic
\series default
 tractography was introduced by 
\begin_inset CommandInset citation
LatexCommand cite
key "Parker2003"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "Behrens2003MRM"

\end_inset

 and calculates a spatial distribution of tracks arising from a single seed
 rather than a single track.
 In each propagation step of each streamline, a random perturbation of the
 underlying fibre orientation estimate is followed.
 Per- turbations are generated using functions that characterize the uncertainty
 in the fibre orientation within each voxel.
 A probabilistic index of connectivity (PICo) is defined between a seed
 and an arbitrary point as 
\begin_inset Formula $M/N$
\end_inset

 where 
\begin_inset Formula $M$
\end_inset

 is the number of tracks that traverse the seed and the point and 
\begin_inset Formula $N$
\end_inset

 is the all the tracks that start from the seed.
 
\end_layout

\begin_layout Standard
Probabilistic approaches mainly differ in the way the orientation uncertainty
 is assessed.
 Most commonly a Bayesian framework will be used to calculate the posterior
 probability of the model orientation parameters 
\begin_inset CommandInset citation
LatexCommand cite
key "Behrens2003MRM"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "Behrens2007NeuroImage"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "hosey2005inference"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "friman2006bayesian"

\end_inset

 and 
\begin_inset CommandInset citation
LatexCommand cite
key "zhang2009probabilistic"

\end_inset

.
 In 
\begin_inset CommandInset citation
LatexCommand cite
key "Behrens2003MRM"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "Behrens2007NeuroImage"

\end_inset

 Monte Carlo-Markov chain (MCMC) is used to sample the orientation posterior
 distribution.
 In 
\begin_inset CommandInset citation
LatexCommand cite
key "friman2006bayesian"

\end_inset

 the posterior is computed numerically after using Dirac priors.
 In 
\begin_inset CommandInset citation
LatexCommand cite
key "zhang2009probabilistic"

\end_inset

 particle filtering is use for the same cause.
\end_layout

\begin_layout Standard

\series bold
Bootstrap
\series default
 tractography is an alternative method to characterize uncertainty in fibre
 orientation 
\begin_inset CommandInset citation
LatexCommand cite
key "pajevic2003parametric"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "lazar2005bootstrap"

\end_inset

.
 This is an non-parametric approach where a diffusion acquisition is repeated
 many times for the same subject and some images from this set are drawn
 in random with replacement.
 This is a single bootstrap sample.
 Drawing many samples will give a distribution for the fiber orientation.
 The advantage of bootstrap tractography is that no ad-hoc assumptions are
 made on the noise and is sensitive to all sources of variability that affect
 the acquired dataset.
 The disadvantage is that many repeated acquisitions are required (at least
 5 for DTI according to 
\begin_inset CommandInset citation
LatexCommand cite
key "o2006just"

\end_inset

).
 
\end_layout

\begin_layout Standard
Model-based residual bootstrap offers an alternative, since it requires
 only a single data acquisition (Chung 2006;Berman et al., 2008; Haroon et
 al., 2009; Jones, 2008).
 A single bootstrap sample can then be generated by permuting freely the
 residuals (or just the sings of the residuals - wild boostrap Jones 2008;
 Whitcher 2008 ) between all model predicted values.
\end_layout

\begin_layout Itemize
Jones 2005
\end_layout

\begin_layout Itemize
Iterative resampling with replacement - Efron (1979)
\end_layout

\begin_layout Itemize
Hasan et al.
 (2004)
\end_layout

\begin_layout Standard

\series bold
Other probabilistic
\emph on
 
\series default
\emph default
estimate the orientation uncertainty as an empeiricaly defined function.
 For example in 
\begin_inset CommandInset citation
LatexCommand cite
key "Parker2003"

\end_inset

 this is determined using the degree of FA.
 The higher the FA the higher the confidence on the principal eigenvector
 of the tensor.
 In (Parker and Alexander 2003) Monte-Carlo simulations are used to predict
 the orientation uncertainty for multiple tensors.Normal distribution is
 assumed for every tensor.
 Cook et al.
 2004 used a Watson distributsion and Seunarine 2007 used a Bingham distribution
 both for PAS or ODFs.
 In Parker and Alexander 2005 - PAS was used.
 In 
\begin_inset CommandInset citation
LatexCommand cite
key "descoteaux2009deterministic"

\end_inset

 fODF was used.
\end_layout

\begin_layout Itemize
Bjornemo, Brun, Kikinis, Westin 2002 - Regularized stochastic white matter
 tractography 
\begin_inset CommandInset citation
LatexCommand cite
key "bjornemoMICCAI02"

\end_inset


\end_layout

\begin_layout Subsubsection
Global
\end_layout

\begin_layout Standard
A limitation of probabilistic tractography is that the probabilistic index
 of connectivity decreases with distance from the seed point (see 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Tractography"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Known-problems"

\end_inset

).
 Another limitation is that it is still sensitive to local noise.
 Global approaches try to overcome these limitations by being distance-indipende
nt and by increasing resistance against noise.
 This is achieved by finding an optimal path between two voxels, according
 to a global property (see 
\begin_inset CommandInset citation
LatexCommand cite
key "DiffMRIBook"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "jbabdi2007bayesian"

\end_inset

 developed a 
\series bold
global Bayesian
\series default
 model to derive the posterior probability of connections.The path trajectories
 represented by splines are compatible with the local fibre orientations
 in regions with low uncertainty estimates.
 In regions with high uncertainty, the global connectivity information constrain
s the local parameter estimation and affects the path sampling.
\end_layout

\begin_layout Standard

\series bold
Front evolution 
\series default
techniques often employ fast marching.
 The front expands from the seed neighbours to the next neighbouring nodes
 with speeds determined by the local fibre orientations.
 As the front propagates, a time of front arrival can be associated with
 each visited voxel.
 Once all image voxels have been traversed by the front, paths of connection
 can be obtained going backwards in the map of front arrival times.
 Starting from an arbitrary voxel, a gradient descent algorithm can find
 the fastest route back to the seed.
 A connectivity index can be associated with each path, representing either
 the weakest link along the path or the agreement between the path tangents
 and the underlying vector orientation field.
 For more see 
\begin_inset CommandInset citation
LatexCommand cite
key "parker2002estimating"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "tournier2003diffusion"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "campbell2005flow"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "fletcher2007volumetric"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "gigandet2009global"

\end_inset

.
\end_layout

\begin_layout Standard

\series bold
Graph-based 
\series default
tractography utilises weighted networks (graphs) 
\begin_inset CommandInset citation
LatexCommand cite
key "IturriaMedina2007NeuroImage"

\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "zalesky2008dt"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "lifshits2009combinatorial"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "Fillard2009a"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "sotiropoulos2010brain"

\end_inset

.
 Each image voxel becomes a node in the graph where the edges of the graph
 connect pairs of neighbouring voxels or ROIs.
 The edges are assigned weights, that can be representative of any type
 of structural information.
 Anatomical paths are then defined as chains with successive elements being
 neighbouring voxels.
 The weights of the edges are used to determine the path strength.
 The strongest path between any image voxel and a seed can then be identified
 using algorithms that search efficiently the image graph.
\end_layout

\begin_layout Standard

\series bold
Energy Minimization
\series default
 methods try to optimize 
\begin_inset CommandInset citation
LatexCommand cite
key "kreher2008gibbs"

\end_inset

 all tracks from the whole brain volume simultaneously.
 Each tract is represented as a chain of cylinders, whose position and orientati
on can change.
 The method tries to find the set of cylinders that best approximate the
 underlying white matter bundles.
 This is achieved by minimizing an energy function, mimicking the polymerization
 process through which chains of monomers are created in an energetically-favour
able way.
 Usually Gibbs sampling is employed.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Kreher2008ISMRM"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "reisert2010global"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "lazar2002white"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "Fillard2009"

\end_inset

.
 Despite the very promising results
\begin_inset CommandInset citation
LatexCommand cite
key "reisert2010global"

\end_inset

, the very high computation time is an important disadvantage of this framework.
\end_layout

\begin_layout Standard
Collins 2010
\end_layout

\begin_layout Standard
Min Energy Solution - 2 regions
\end_layout

\begin_layout Itemize
Fletcher 2007
\end_layout

\begin_layout Itemize
Cheng 2006
\end_layout

\begin_layout Standard
Microanatomy Tracking
\end_layout

\begin_layout Standard
MicroTrack
\begin_inset CommandInset citation
LatexCommand cite
key "sherbondy2010microtrack"

\end_inset

an algorithm that combines global tractography and direct microstructure
 estimation using diffusion-weighted imaging data.
 
\end_layout

\begin_layout Subsubsection
Simulated
\end_layout

\begin_layout Standard
These methods simulate the diffusion of water molecules within the brain
 tissue or directly solve Fick’s second law of diffusion 
\begin_inset CommandInset citation
LatexCommand cite
key "batchelor2001study"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "kang2005white"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "hageman2009diffusion"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "hagmann2003dti"

\end_inset

.
\end_layout

\begin_layout Standard
In 
\begin_inset CommandInset citation
LatexCommand cite
key "batchelor2001study"

\end_inset

, the diffusion equation is solved using a finite element approach.
 Successive diffusion simulations over the entire brain, starting froma
 seed, are performed in 
\begin_inset CommandInset citation
LatexCommand cite
key "kang2005white"

\end_inset

.
 Tractography by simulating fluid flow through a 
\begin_inset Quotes eld
\end_inset

pressure
\begin_inset Quotes erd
\end_inset

 tensor field is performed in 
\begin_inset CommandInset citation
LatexCommand cite
key "hageman2009diffusion"

\end_inset

.
 The Navier-Stokes equation is solved using a finite element approach.
 However, solving a partial differential equation increases execution time.
 Furthermore, it is not always easy with these approaches to obtain a connectivi
ty map across the whole brain volumeand there is usually a large number
 of parameters to set.
 
\end_layout

\begin_layout Standard
For further understanding of the current map of all the different tractography
 algorithms see the reviews from 
\begin_inset CommandInset citation
LatexCommand cite
key "fillard2011quantitative"

\end_inset

 ,
\begin_inset CommandInset citation
LatexCommand cite
key "sotiropoulos2010processing"

\end_inset

 and 
\begin_inset CommandInset citation
LatexCommand cite
key "Jbabdi2007"

\end_inset

.
 In 
\begin_inset CommandInset citation
LatexCommand cite
key "fillard2011quantitative"

\end_inset

 10 tractographies were simulated using a novel hardware phantom.
 Generally, comparing all these different methods which all have different
 parameters and are based on different underlying models is a difficult
 process and a ground truth from anatomical studies or hardware phantoms
 is absolutely necessary.
\begin_inset Note Note
status open

\begin_layout Plain Layout
ADD some links from last HBM
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
http://www.docstoc.com/docs/58019487/Diffusion-Tensor-MRI-at-3-Tesla
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Algorithm
\end_layout

\begin_layout Itemize

\series bold
Input
\end_layout

\begin_deeper
\begin_layout Itemize
anisotropic volume metric
\end_layout

\begin_layout Itemize
unit directions 
\end_layout

\begin_layout Itemize
resampling sphere
\end_layout

\begin_layout Itemize
seeds
\end_layout

\begin_layout Itemize
anisotropy low threshold
\end_layout

\begin_layout Itemize
step size 
\end_layout

\begin_layout Itemize
angular threshold
\end_layout

\begin_layout Itemize
total_weighting threshold
\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
lstparams "basicstyle={\footnotesize},breaklines=true,numbers=left,numberstyle={\footnotesize},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

For all seeds
\end_layout

\begin_layout Plain Layout

	For all peaks
\end_layout

\begin_layout Plain Layout

		track = EuDX_Both_Directions
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
EuDX Main
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
lstparams "basicstyle={\footnotesize},breaklines=true,numbers=left,numberstyle={\footnotesize},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

Delta, i_direction = Initial_Direction
\end_layout

\begin_layout Plain Layout

direction=i_direction
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

While Delta is True
\end_layout

\begin_layout Plain Layout

	Delta, new_direction = Propagation_Direction(direction)
\end_layout

\begin_layout Plain Layout

	IF Delta is False
\end_layout

\begin_layout Plain Layout

		Break
\end_layout

\begin_layout Plain Layout

	point += step_size*new_direction
\end_layout

\begin_layout Plain Layout

	track.append(point)
\end_layout

\begin_layout Plain Layout

	direction=new_direction
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

Delta=True
\end_layout

\begin_layout Plain Layout

direction=-direction
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

While Delta is True
\end_layout

\begin_layout Plain Layout

	Delta,new_direction = Propagation_Direction(direction)
\end_layout

\begin_layout Plain Layout

	IF Delta is False
\end_layout

\begin_layout Plain Layout

		Break
\end_layout

\begin_layout Plain Layout

	point += step_size*new_direction
\end_layout

\begin_layout Plain Layout

	track.insert(0,point)
\end_layout

\begin_layout Plain Layout

	direction = new_direction
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Both Directions 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
lstparams "basicstyle={\footnotesize},breaklines=true,numbers=left,tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

point=grid_point[seed]
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

IF aniso[point]<aniso_thr	
\end_layout

\begin_layout Plain Layout

	return False
\end_layout

\begin_layout Plain Layout

Else
\end_layout

\begin_layout Plain Layout

	return True, direction
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Initial Direction
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset listings
lstparams "basicstyle={\footnotesize},breaklines=true,numbers=left,numberstyle={\footnotesize},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

weigths=Trilinear_Interpolation
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

IF out of boundaries
\end_layout

\begin_layout Plain Layout

	return False
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

total_weight=0
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

For the 8 corners of the neighbourhood
\end_layout

\begin_layout Plain Layout

	Delta, direction = Nearest_Direction
\end_layout

\begin_layout Plain Layout

	IF Delta is False
\end_layout

\begin_layout Plain Layout

		Continue
\end_layout

\begin_layout Plain Layout

	total_weight += W[corner]
\end_layout

\begin_layout Plain Layout

	new_direction += W[corner]*direction
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

IF total_weight < .total_weith_threshold
\end_layout

\begin_layout Plain Layout

	return False
\end_layout

\begin_layout Plain Layout

Else
\end_layout

\begin_layout Plain Layout

	return True, normalized(new_direction)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Propagation Direction
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
lstparams "basicstyle={\footnotesize},breaklines=true,numbers=left,numberstyle={\footnotesize},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

IF maximum peak < aniso_thr
\end_layout

\begin_layout Plain Layout

	return False
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

For all peaks (directions)
\end_layout

\begin_layout Plain Layout

	If peak < aniso_thr
\end_layout

\begin_layout Plain Layout

		Break
\end_layout

\begin_layout Plain Layout

	angle = angle(peak direction,current direction)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

IF maximum_angle > angl_thr
\end_layout

\begin_layout Plain Layout

	return False
\end_layout

\begin_layout Plain Layout

Else
\end_layout

\begin_layout Plain Layout

	return True, direction(closest peak on angular terms)
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Nearest Direction
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Resampling Sphere and Anisotropy Metric
\end_layout

\begin_layout Standard
Explain what kind of volumes can be added as an input to the algorithm
\end_layout

\begin_layout Subsection

\series bold
Old Description
\end_layout

\begin_layout Standard
We extend classical streamline methods 
\begin_inset CommandInset citation
LatexCommand cite
key "MCC+99,CLC+99,BPP+00"

\end_inset

 and latest as in 
\begin_inset CommandInset citation
LatexCommand cite
key "Descoteaux2009,Yeh2010"

\end_inset

 to create a more general streamline tractography method which can be used
 with very different types of diffusion anistropic fields.
 
\end_layout

\begin_layout Standard
We solve for 
\begin_inset Formula $\mathbf{p}_{t}=\mathbf{p}_{0}+\int_{0}^{t}\mathbf{v}(p(\mathbf{s}))d\mathbf{s}$
\end_inset

 and we perform the integration numerically using Euler 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{equation}
\mathbf{p}_{n+1}=\mathbf{p}_{n}+\mathbf{v}(p_{n})\Delta s\label{eq: euler}\end{equation}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $\Delta s$
\end_inset

 is the propagation step size which should be smaller than the smallest
 voxel size, 
\begin_inset Formula $\mathbf{v}$
\end_inset

 is the propagation direction and 
\begin_inset Formula $\mathbf{p}_{0}$
\end_inset

 is the initial seed point.
 Alternatively than Euler, R-K of 2nd and 4th order can be used.
 In addition to the seed points we do not to use a scalar function like
 FA or NPA for our stopping criteria but it could be a vector function as
 well like QA or even the full diffusivity profile.
 The only constraint is to be 
\begin_inset Formula $\geqslant0$
\end_inset

 everywhere in the grid.
 We call this function 
\begin_inset Formula $\mathcal{A}$
\end_inset

 and we could imagine it as an accumulation of vector fields applied on
 the image grid.
 Therefore, when we write 
\begin_inset Formula $\mathcal{A}(\mathbf{u}_{i})=\alpha_{i}$
\end_inset

 this reads for the peak unit direction of 
\begin_inset Formula $\mathbf{u}_{i}$
\end_inset

 the peak value was 
\begin_inset Formula $\alpha_{i}$
\end_inset

.
 For the simple case of FA, 
\begin_inset Formula $\mathbf{u}$
\end_inset

is equal with the eigenvector corresponding to the highest eigenvalue, 
\begin_inset Formula $\mathcal{A}(\mathbf{e})=fa$
\end_inset

.
 For the QA case which can allow even for 5 peaks or more we use 
\begin_inset Formula $\mathcal{A}(\mathbf{u}_{i})=qa_{i}$
\end_inset

 where 
\begin_inset Formula $i\in[0,4]$
\end_inset

 denotes the current peak.
 (Dandelion case to be added here).
\end_layout

\begin_layout Standard
The EuDX algorithm can be described in the following way:
\end_layout

\begin_layout Standard
(1) 
\begin_inset Formula $A(\mathbf{u})$
\end_inset

 is estimated at every point of the volume.
 This resembles a composite vector field where every point contains the
 peak directions superimposed to the anisotropy values.
 In order to reduce space 
\begin_inset Formula $\mathbf{u}$
\end_inset

 can be replaced by an index to the closest sampling point on an evenly
 distributed sphere.
 We create an empty list of tracks 
\begin_inset Formula $T=[]$
\end_inset

 and then we generate random or uniform seed points 
\begin_inset Formula $\mathbf{p}_{0j}$
\end_inset

 for every track 
\begin_inset Formula $t_{j}$
\end_inset

.
\end_layout

\begin_layout Standard
(2) The following step is to pick a seed point 
\begin_inset Formula $\mathbf{p}_{0}$
\end_inset

 and start propagating.
 We need to remember that the propagation direction can go forward and backwards
 or better towards one direction and its opposite direction.
 For the moment we only propagate towards one direction set by
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{equation}
\mathbf{v}(\mathbf{p}_{0})=argmax_{u_{i}}\mathcal{A}(\mathbf{u})\label{eq:argmax_anisotropy}\end{equation}

\end_inset


\end_layout

\begin_layout Standard
As 
\begin_inset Formula $\mathcal{A}$
\end_inset

 can be much more than a scalar function we need to remember that when we
 finish with this track followed by direction 
\begin_inset Formula $\mathbf{v}$
\end_inset

 we will need to propagate towards the direction of 
\begin_inset Formula $argsecondmax$
\end_inset

, 
\begin_inset Formula $argthirdmax,...,argmin$
\end_inset

 as the current 
\begin_inset Formula $\mathbf{p}_{0}$
\end_inset

 voxel might contain one or more crossings.
\end_layout

\begin_layout Standard
(3) We check for initial propagation direction which checks for the condition:
\end_layout

\begin_layout Standard
If 
\begin_inset Formula $\mathcal{A}(p_{n})<\mathcal{A}_{thr}$
\end_inset

 then STOP.
\end_layout

\begin_layout Standard
Else 
\begin_inset Formula $t_{j}$
\end_inset

.append(
\begin_inset Formula $\mathbf{p}_{0}$
\end_inset

).
\end_layout

\begin_layout Standard
This can be very useful in general to cancel out any seed points which are
 in the background or in very low anisotropy areas where tracking is not
 recommended.
 The threshold is different for every different metric QA, FA, GFA etc.
 If step (3) returns TRUE then we add the seed point to the empty track.
\end_layout

\begin_layout Standard
(4) In order to generate smooth tractography it is recommended to use some
 kind of interpolation.
 Here we have been using trilinear interpolation which works in the following
 way.
 The seed devides the neibourhing area in 8 parts in 3D (4 in 2D) and the
 total contribution of the neighbouring points is added according to the
 weights 
\begin_inset Formula $w$
\end_inset

 of the antipodal side.
 The weights express subvolumes in 3D (or subareas in 2D) (see figure).
\end_layout

\begin_layout Standard
(5) One good strategy now is to find the nearest direction from the seed's
 initial direction 
\begin_inset Formula $\mathbf{v}(\mathbf{p_{n}})$
\end_inset

 to every 
\begin_inset Formula $\mathbf{u}_{i}$
\end_inset

 of every one of the 8 corners of the neighbourhood of the seed.
 
\end_layout

\begin_layout Standard
If 
\begin_inset Formula $\dfrac{\mathbf{u}(\mathbf{x}_{i})\cdot\mathbf{v}(\mathbf{p}_{n})}{||\mathbf{u}(\mathbf{x}_{i})||||\mathbf{v}(\mathbf{p}_{n})||}\leqq\theta_{thr}$
\end_inset

 we count the corresponding weight otherwise we continue to the next weight.
 We check as well the condition 
\begin_inset Formula $\mathcal{A}(u)\leqq\mathcal{A}_{thr}$
\end_inset

.
 All the adjacent weights will contribute to the new direction given by
 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{equation}
\mathbf{v}^{'}(\mathbf{p}_{n})=\sum_{m}w_{m}\mathbf{v}(\mathbf{p}_{n})\end{equation}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $\mathbf{v}(\mathbf{p}_{n})=\dfrac{\mathbf{v}^{'}(\mathbf{p}_{n})}{||\mathbf{v}^{'}(\mathbf{p}_{n})||}$
\end_inset

.
\end_layout

\begin_layout Standard
(6) The next point is calculated using 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
\mathbf{p}_{n+1} & = & \mathbf{p}_{n}+v(\mathbf{p}_{n})\Delta s\label{eq:fdx_next_point}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
At this point we store the new point in the track 
\begin_inset Formula $t_{j}.append(\mathbf{p}_{n+1})$
\end_inset

 and continue tracking until one of the stopping criteria is met.
 Finally, we have to repeat the procedure for the opposite direction of
 the initial 
\begin_inset Formula $\mathbf{v}(\mathbf{p}_{o})$
\end_inset

 and for the smaller maxima as in (2).
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename FDX_propagation.svg
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
EuDX tracking example
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Evaluation with Fibre Cup phantom and Marta's phantoms
\end_layout

\begin_layout Subsection
Evaluation with real subjects
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard

\end_layout

\begin_layout Section

\change_deleted 2 1312986126
Super
\change_inserted 2 1312986129
Highly
\change_unchanged
 Efficient Tractography Clustering 
\end_layout

\begin_layout Subsection
Overview
\end_layout

\begin_layout Standard
The current tractography propagation algorithms can generate massive tractograph
ies which are difficult to interpret and visualize.
 A clustering of some kind seems to be a solution to simplify the complexity
 of the datasets and provide a useful segmentation; however most proposed
 clustering algorithms are very slow and often need to calculate pairwise
 distances of size 
\begin_inset Formula $NxN$
\end_inset

 where 
\begin_inset Formula $N$
\end_inset

 is the number of tracks.
 This amount of comparisons puts a massive load on clustering algorithms
 forcing them to be inefficient and therefore impractical for everyday analysis
 as it is difficult to compute all these distances or even store them in
 memory.
 This adds a further overload on the use of tractography for clinical applicatio
ns but also puts a wall on understanding and intrepreting the quality of
 diffusion datasets.
 We show in this document that a stable overall linear time clustering algorithm
 exists and that we can generate meaningful clusters in seconds with minimum
 memory consumption.
 We can use this algorithm to simplify tractographies, identify hidden structure
s, find landmarks, create atlases and compare and register tractographies.
 In our approach we don't need to calculate all pairwise distances as most
 of the other existing methods do and furthermore we can update our clustering
 online or in parallel.
 We can show that we can generate meaningful clusters 200-1000 times faster
 than any other available methods even without parallelism.
 Nonetheless our method is multipurpose and it can be used as an input to
 other algorithms with higher order complexity which can now become more
 efficient.
 We show results from a few hundred to many million tracks.
\end_layout

\begin_layout Subsubsection
Related Work
\end_layout

\begin_layout Standard
During the last 10 years there have been numerous efforts from many researchers
 to address the unsupervised and supervised problems of brain tractography.
 All these methods suffer from low efficiency, however they do provide many
 useful ideas.
 Moberts et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "moberts2005evaluation"

\end_inset

 evaluated different hierarchical clustering methods including a less common
 one, shared nearest neighbor (SNN) against a gold standard segmentation
 by physicians.
 Wang et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "wang2010tractography"

\end_inset

 proposed a nonparametric Bayesian framework using hierarchical Dirichlet
 processes mixture model (HDPM).
 This is one of the very few methods not based on distances.
 A track is modeled here as a discrete distribution over a codebook of discretiz
ed orientations and voxel regions.
 In this paper the authors explain that calculating pairwise distances is
 very time consuming and therefore they try to avoid that.
 Their approach automatically learns the number of clusters from data with
 Dirichlet processes priors.
 Visser et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Visser2010"

\end_inset

 used hierarchical clustering and fuzzy c-means together with recombination
 of subsets of the same tractography to reduce the effect of the large datasets
 on the distance matrix.
 With this paper we share the same track distance function.
 
\end_layout

\begin_layout Standard
Guevara et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Guevara2010"

\end_inset

 used a cascade of different algorithms from hierarchical clustering together
 to 3d watershed on fibre extremeties.
 a) they divide the tractography into left-right hemisphere, interhemispheric
 and cerebellum subset, b) create subsets of different track length, c)
 use hierarchical clustering based on the random voxel parcels, d) then
 watershed over extremities and e) hierarchical clustering to merge the
 different sub-bundles using the Hausdorff distance.
\end_layout

\begin_layout Standard
Wakana et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Wakana2007NeuroImage"

\end_inset

 used regions of interest to include or exclude tracks generated by FACT
 and Hua et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Hua2008NeuroImage"

\end_inset

 used regions of interest together with probabilistic tractography.
 Zvitia et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "zvitia2008adaptive"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "Zvitia2010"

\end_inset

 used adaptive mean shift so that they do not need to provide the number
 of clusters, they also used this approach for registration of datasets
 from the same subject.
\end_layout

\begin_layout Standard
Brun et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "brun2004clustering"

\end_inset

 is using the mean and covariance of the track as feature space and normalized
 cuts for the segmentation.
 Ding et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Ding2003a"

\end_inset

 used k-nearest neighbours another agglomerative approach applied on correspondi
ng track segments.
\end_layout

\begin_layout Standard
O'Donnell et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "ODonnell_IEEETMI07"

\end_inset

 generate a tractographic atlas using spectral embedding and expert anatomical
 labeling and then they automatically segment using again spectral clustering
 and embedding the tracks from the new tractographies as points in the embedded
 space to the closest existing atlas clusters.
 The true affinity matrix is too big to compute therefore they are using
 the Nystrom approximation; working on a subset and avoid generating the
 complete affinity/distance matrix.
 Then later in 
\begin_inset CommandInset citation
LatexCommand cite
key "o2009tract"

\end_inset

 they tried group analysis on prespecified bundles.
\end_layout

\begin_layout Standard
Tsai et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Tsai2007"

\end_inset

 used a combination of similarity using minimum spanning trees, locally
 linear embedding and k-means in that way they showed that they can incorporate
 both local and global structures by changing a few parameters.
 The advantage of this method was that it showed a way to merge a chain
 of neighbouring structures into one cluster.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "gerig2004analysis"

\end_inset

 used as well hierarchical clustering with minimum, closest and Haussdorf
 distances.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "corouge2004towards"

\end_inset

 used different types of track distances e.g.
 haussdorf distances and other properties like torsion and curvature and
 in 
\begin_inset CommandInset citation
LatexCommand cite
key "Corouge2004"

\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "Corouge2006"

\end_inset

 used Generalized Procrustes Analysis and PCA to analyze the shape of bundles.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "Maddah_MICCA2005"

\end_inset

used B-spline representations of fibre tracts against an atlas, and then
 based on the labeled atlas of the fibre tracts, the subject’s fibre tracts
 were clustered.
 Later 
\begin_inset CommandInset citation
LatexCommand cite
key "maddah2006statistical"

\end_inset

 using a similar track representation (quintic B-splines) calculated a model
 for each bundle as the average and standard deviation of that parametric
 representation.
 In that way creates an atlas which is used as a prior for expectation maximizat
ion clustering of the corpus callosal tracks into Witelson subdivisions
 
\begin_inset CommandInset citation
LatexCommand cite
key "witelson1989hand"

\end_inset

 using population averages.
 Later in 
\begin_inset CommandInset citation
LatexCommand cite
key "Maddah_IEEEBI2008"

\end_inset

 they showed that they could use together spatial priors but also the shape
 of the tracks to guide tractography clustering.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "jonasson2005fiber"

\end_inset

 measured the similarity between two fibres by counting the number of points
 sharing the same voxel together with spectral clustering.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "ElKouby2005"

\end_inset

 used ROI-based connectivity parcellation and k-means.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "jianu2009exploring"

\end_inset

presented a new method for visualizing and navigating through tractography
 data combining dendrograms from hierarchical clustering, 3d and 2d embeddings
 using the approximation of 
\begin_inset CommandInset citation
LatexCommand cite
key "chalmers1996linear"

\end_inset

 for 
\begin_inset CommandInset citation
LatexCommand cite
key "eades1984heuristic"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "zhang2005dti"

\end_inset

 used an agglomerative hierarchical clustering using the same distance as
 in 
\begin_inset CommandInset citation
LatexCommand cite
key "zhang2003visualizing"

\end_inset

 and later in
\begin_inset CommandInset citation
LatexCommand cite
key "zhang2008identifying"

\end_inset

 combined single linkage hierarchical clustering together with distances
 and expert labeling of specific bundles.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "Durrleman2009"

\end_inset

 introduced currents to model fibre bundles where a fibre is seen as a set
 of wires sending information in one direction at constant rate.
 Currents have good diffeomorphic properties and can be used for registration
 of bundles as shown in
\begin_inset CommandInset citation
LatexCommand cite
key "Durrleman2009"

\end_inset

 and later in 
\begin_inset CommandInset citation
LatexCommand cite
key "durrleman2010registration"

\end_inset

.
 This methodology does not impose point-to-point or fibre-to-fibre correspondenc
es however it is sensitive to the fibre density and orientation of the bundles.
 As all the methods above is also computationaly expensive.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "leemans17new"

\end_inset

 using affinity propagation successfully clustered the fronto-occipital
 fibres, cingulum and arcuate fasciculus using and additional frontal and
 occipital AND masks and a NOT mask on the right cerebrum.
 However, it seems the authors worked on a very small part of the entire
 tractography as later 
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "malcolm2009filtered"

\end_inset

 used affinitiy propagation to cluster tracks created using filtered tractograph
y and reported that probably affinity propagation cannot be used for group
 clustering.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "ziyan2009consistency"

\end_inset

 introduced a probabilistic registration and clustering algorithm based
 on expectation maximization algorithm which creates a sharper atlas from
 a set of subjects on 3 bundles CC, CI and FX.
 This work used an initial spectral clustering
\begin_inset CommandInset citation
LatexCommand cite
key "ODonnell_IEEETMI07"

\end_inset

 to label the bundles and then updated these labels iteratively while performing
 bundle wise registration combined using polyaffine integration.
 
\end_layout

\begin_layout Standard
In summary, most researchers had to complete distance matrices or/and simplify
 the datasets by length or selections or with masks or extensive ROIs or
 avoid track distances entirely because being cpu and memory consuming.
 We hope that our method can be of a solution to this problem.
\end_layout

\begin_layout Subsubsection

\series bold
Our approach
\end_layout

\begin_layout Itemize
Linear time clustering on track distances, average 
\begin_inset Formula $O(N)$
\end_inset

 with worst case 
\begin_inset Formula $O(N^{2})$
\end_inset

 when every track is a singleton cluster itself.
\end_layout

\begin_layout Itemize
Can be used with all types of diffusion MRI tractographies which generate
 streamlines e.g.
 DTI, DSI, GQI etc.
\end_layout

\begin_layout Itemize
Fastest known tractography clustering method.
 Real-time on tractographies with less than 20K tracks.
\end_layout

\begin_layout Itemize
Based only on tracks.
 No other prior input is needed.
 For example no rois are used drawn from scalar volume data or other atlases.
\end_layout

\begin_layout Itemize
Robust as we can find agreements even between different subjects.
\end_layout

\begin_layout Itemize
Ability to create tractography atlases at high speed.
 Giving also the possibility for one to one comparisons.
\end_layout

\begin_layout Itemize
Helping explore multiple tractographies and find correspondences between
 tractographies.
\end_layout

\begin_layout Itemize
Create landmarks used for registration or population comparisons.
\end_layout

\begin_layout Itemize
You can think of this method as fast dimensionality reduction or filtering
 for trajectories.
\end_layout

\begin_layout Itemize
Can find hidden tracks not visible to the user.
\end_layout

\begin_layout Itemize
Provides a framework for other higher order methods to be efficient.
\end_layout

\begin_layout Itemize
Rotation, translation and scale invariant (check).
\end_layout

\begin_layout Itemize
Creates a unique tool to explore massive datasets.
\end_layout

\begin_layout Itemize
Unlearned tracks will be added as new clusters as being very distant from
 all other clusters.
\end_layout

\begin_layout Itemize
Contains only one meaningful threshold i.e.
 distance threshold usually set in mm.
\end_layout

\begin_layout Itemize
Easy understand how it works when think of bundles as cylinders.
\end_layout

\begin_layout Itemize
Clusters hold the entire tractography information.
 Complete assignments - no fuzziness.
\end_layout

\begin_layout Itemize
The main concept of this clustering method is that cluster can be represented
 by virtual tracks which are used only during cluster comparisions and not
 updated at every iteration.
\end_layout

\begin_layout Itemize
A virtual track is the average of all tracks in the cluster.
 We call it virtual because it doesn't really exist in the real dataset
 and to distinguish it from exemplar tracks which are again features of
 the cluster but are represented by real tracks.
\end_layout

\begin_layout Itemize
The method also generates to linear time exemplar tracks.
\end_layout

\begin_layout Itemize
The clustering creates a book of bundles/clusters which have easy to obtain
 descriptors/features.
\end_layout

\begin_layout Itemize
When clusters are held in a tree structure this permits upwards amalgamations
 to form bundles out of clusters, and downwards disaggregation to split
 clusters into finer sub-clusters corresponding to a lower distance threshold.
 However, we will touch this hierarchical extension of this algorithm here
 and mostly concentrate on one level amalgamations.
\end_layout

\begin_layout Itemize
LSC as k-means, k-centers, expectation maximization and most clustering
 algorithms is not a global clustering method therefore it will give different
 results under different initial conditions of the dataset when there is
 no obvious distance threshold which can separate the clusters in to meaningful
 bundles; for example we should expect different clusters under different
 permutations/orderings of the tracks in a densely packed tractography.
 However, we found that there is enough agreement even between two clusterings
 of the same tractography with different orderings.
 If the clusters are trully separable by distances then there is a global
 solution indepenent of orderings.
 This is often perceivable in smaller subsets of the initial tractography.
\end_layout

\begin_layout Itemize
We found that this problem is minimized even with real datasets when a low
 distance threshold of about 10 mm is used.
 Furthermore the output of LSC can become now input for another recent quick
 algorithm of quadratic time 
\begin_inset Formula $O(M^{2})$
\end_inset

 called affinity propagation where now 
\begin_inset Formula $M\ll N$
\end_inset

 therefore the overall time stays linear on the number of tracks 
\begin_inset Formula $N$
\end_inset

.
 Other algorithms previously too slow to be used on the entire tractography
 can now be used too e.g.
 kNN, hierarchical clustering and many others.
\end_layout

\begin_layout Subsection
Materials and methods
\end_layout

\begin_layout Subsubsection
HARDI/DSI datasets
\end_layout

\begin_layout Itemize
Twelve healthy subjects
\end_layout

\begin_layout Itemize
Siemens Trio 3T
\end_layout

\begin_layout Itemize
b-values/directions
\end_layout

\begin_layout Itemize
voxel size
\end_layout

\begin_layout Subsubsection
Simulation datasets
\end_layout

\begin_layout Itemize
Marta's dataset
\end_layout

\begin_layout Itemize
PBC Competion Datasets
\end_layout

\begin_layout Itemize
Generate orbits of different functions etc.
 cosines
\end_layout

\begin_layout Subsubsection
Reconstruction algorithms
\end_layout

\begin_layout Itemize
GQI/thresholds for Marta and real datasets
\end_layout

\begin_layout Itemize
FA for fibre Cup
\end_layout

\begin_layout Subsubsection
Deterministic tractography
\end_layout

\begin_layout Itemize
EuDX with which options? Random seeds, thresholds (angl=60, totalw=.5, step_sz)
\end_layout

\begin_layout Subsection
Track distances and preprocessing
\end_layout

\begin_layout Standard
Numerous distance metrics between two trajectories have been proposed in
 the litetature, such as in 
\begin_inset CommandInset citation
LatexCommand cite
key "Ding2003"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "MaddahIPMI2007"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "zhang2005dti"

\end_inset

 with most common the Haussdorf distance found in 
\begin_inset CommandInset citation
LatexCommand cite
key "corouge2004towards"

\end_inset

 and many other papers.
 We are using mainly a very simple distance proposed in 
\begin_inset CommandInset citation
LatexCommand cite
key "Visser2010"

\end_inset

 and [us HBM2010] which we call minimum average direct-flip (MDF) distance
 
\begin_inset Formula $d_{df}(s_{A},s_{B})$
\end_inset

 between track 
\begin_inset Formula $s_{A}$
\end_inset

 and track 
\begin_inset Formula $s_{b}$
\end_inset

 , see eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:direct_flip_distance"

\end_inset

.
 This distance can be applied only when both tracks have the same number
 of points.
 Therefore, an initial downsampling of tracks where all segments have the
 same length on a track and all tracks have the same number of segments
 is necessary.
 
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
\begin_inset Formula \begin{eqnarray}
d_{df} & = & \min(d_{d},d_{f})\label{eq:direct_flip_distance}\\
d_{d}(s_{A},s_{B}) & = & \frac{1}{K}\sum_{i=1}^{K}||x_{i}^{A}-x_{i}^{B}||_{2}\nonumber \\
d_{f}(s_{A},s_{B}) & = & \frac{1}{K}\sum_{i=1}^{K}||x_{i}^{A}-x_{K-i}^{B}||_{2}\nonumber \end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $K$
\end_inset

 is the number of points 
\begin_inset Formula $x$
\end_inset

 on both tracks 
\begin_inset Formula $A$
\end_inset

 and 
\begin_inset Formula $B$
\end_inset

.
\end_layout

\begin_layout Standard
In some cases it is still valid to use a type of Haussdorf distance which
 for simplicity denote (MAM) distance - shortcut for {minimum,maximum or
 mean} average minimum distance (MAM).
 We mostly use the mean version of that family of distances, see eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mean_average_distance"

\end_inset

 but the others are useful too as they could stress different properties
 of the datasets.
 These distances are slower to compute but they can work with different
 number of segments on tracks that is useful for some applications.
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray}
d_{avg}(s_{A},s_{B}) & = & \frac{1}{K_{A}}\sum_{i=1}^{K_{A}}d(x_{i}^{A},s_{B})\nonumber \\
d_{min}(s_{A},s_{B}) & = & \min_{j=1,...,K_{B}}d(x_{i}^{A},s_{B})\label{eq:mininum_distance}\\
d_{max}(s_{A},s_{B}) & = & \max_{j=1,...,K_{B}}d(x_{i}^{A},s_{B})\label{eq:maximum distance}\\
d(x_{i}^{A},s_{B}) & = & \min_{j=1,...,K_{B}}||x_{i}^{A}-x_{j}^{B}||_{2}\nonumber \\
m_{in} & = & \min(d_{avg}(s_{A},s_{B}),d_{avg}(s_{B},s_{A}))\label{eq:min_average_distance}\\
m_{ax} & = & \max(d_{avg}(s_{A},s_{B}),d_{avg}(s_{B},s_{A}))\nonumber \\
m_{ean} & = & (d_{avg}(s_{A},s_{B})+d_{avg}(s_{B},s_{A}))/2\label{eq:mean_average_distance}\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
where here 
\begin_inset Formula $K_{A}$
\end_inset

 can be different that 
\begin_inset Formula $K_{B}$
\end_inset

.
 Finally, other distances than the average minimum based on the minimum
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mininum_distance"

\end_inset

 maximum distance see eq.
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:maximum distance"

\end_inset

 can be used.
 However, these have not been investigated in this work concerning the clusterin
g part.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename distances.png
	scale 60
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset CommandInset label
LatexCommand label
name "Flo:Distances_used"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
Distances used in this work.
 The main distance used is minimum average direct flip (MDF) distance 
\begin_inset Formula $d_{df}=\min(d_{d},d_{f})$
\end_inset

 which is a symmetric distance can deal with the track direction problem
 and works on tracks which have the same number of points.
 Another distance is the mean average distance which is again symmetric
 but does not need for the tracks to have the same number of points 
\begin_inset Formula $m_{ean}=(d_{avg}(s_{A},s_{B})+d_{avg}(s_{B},s_{A}))/2$
\end_inset

.
 In this figure the components of both distances are shown; with solid lines
 we draw the tracks and then with dash lines we connect the points of the
 two tracks which provide a useful distance 
\begin_inset Formula $d$
\end_inset

 on the overall metrics.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Coming back to the MDF distance (eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:direct_flip_distance"

\end_inset

) ; its main advantages is that it is fast to compute, track direction is
 not an issue and that it is easy to understand what it will do from the
 simplest case where you have parallel equi-length tracks to the most complicate
d where you have very divergent tracks.
 Another advantage is that it will separate short tracks from long tracks
 and as we will see this will be a great way to find broken or erroneous
 tracks.
 Finally, an advantage of having tracks with the same number of points is
 that we can easily do statistical operations on them; for example add them
 together.
 We will see in the next section that track addition is a key property of
 our clustering algorithm.
\end_layout

\begin_layout Subsection
Linear-time Trajectory Skeleton Clustering 
\end_layout

\begin_layout Subsubsection
Algorithm
\end_layout

\begin_layout Standard
Local Skeleton Clustering (LSC) is a remarkably fast algorithm which can
 simplify tractography representation in an accessible structure at linear
 time with the number of tracks 
\begin_inset Formula $N$
\end_inset

.
 LSC is a linear time 
\begin_inset Formula $O(N)$
\end_inset

 distance based clustering algorithm that we created in order to simplify
 huge trajectory datasets as those produced by current tractography generation
 algorithms.
 In general, there are very few linear time clustering algorithms mainly
 two are well known and these are CLARANS
\begin_inset CommandInset citation
LatexCommand cite
key "ng2002clarans"

\end_inset

 and BIRCH
\begin_inset CommandInset citation
LatexCommand cite
key "zhang1997birch"

\end_inset

.
 LSC is different than both of these methods but one way to think of LSC
 is like one level of BIRCH implemented on track dimensions where cluster
 additions are online track amalgamations.
 
\end_layout

\begin_layout Standard
LSC creates an online tree of cluster nodes.
 The cluster node is defined as 
\begin_inset Formula $c=\{I,\mathbf{h},n\}$
\end_inset

 where 
\begin_inset Formula $I$
\end_inset

 is the list of the integer indices of the tracks in that cluster, 
\begin_inset Formula $\mathbf{h}$
\end_inset

 is an 
\begin_inset Formula $n\times3$
\end_inset

 matrix which the most important feature of the cluster and 
\begin_inset Formula $n$
\end_inset

 is the number of tracks on that cluster.
 
\begin_inset Formula $\mathbf{h}$
\end_inset

 is a matrix which can be updated online when a track is added on a cluster
 and is equal to
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{equation}
\mathbf{h}=\sum_{i=1}^{n}s_{i}\end{equation}

\end_inset

where 
\begin_inset Formula $s_{i}$
\end_inset

 is the 
\begin_inset Formula $p\times3$
\end_inset

 matrix representing track 
\begin_inset Formula $i$
\end_inset

, 
\begin_inset Formula $\Sigma$
\end_inset

 represents here matrix addition along the second axis and 
\begin_inset Formula $n$
\end_inset

 is the number of tracks in the cluster.
 LSC assumes that all tracks have the same number of points 
\begin_inset Formula $p$
\end_inset

 therefore an equidistant downsampling of tracks is necessary before LSC
 starts.
 In short summary the algorithm works as follows.
 Select the first track 
\begin_inset Formula $s_{0}$
\end_inset

and place it in the first cluster 
\begin_inset Formula $c_{0}\leftarrow\{0,s_{0},1\}$
\end_inset

.
 Then for all remaining tracks i) goto next track 
\begin_inset Formula $s_{i}$
\end_inset

 ii) calculate MDF distance between this track and virtual tracks of all
 existing clusters 
\begin_inset Formula $c_{k}$
\end_inset

, where a virtual track is defined on the fly as 
\begin_inset Formula $\mathbf{v}=\mathbf{h}/n$
\end_inset

 iii) if the minimum mdf distance is smaller than the a distance threshold
 
\begin_inset Formula $thr$
\end_inset

 add the track to the cluster with the minimum distance and update 
\begin_inset Formula $c_{j}\leftarrow\{I\bigcap i,\mathbf{h}\leftarrow h+s,N\leftarrow N+1\}$
\end_inset

 ;otherwise create a new cluster 
\begin_inset Formula $c_{|C|+1}\leftarrow\{0,s_{i},1\}$
\end_inset

, 
\begin_inset Formula $|C|\leftarrow|C|+1$
\end_inset

 where 
\begin_inset Formula $|C|$
\end_inset

 denotes the current total number of clusters.
 
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
lstparams "basicstyle={\footnotesize},breaklines=true,language=Python,mathescape=true,numbers=left,numberstyle={\footnotesize},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

#First track becomes the first class
\end_layout

\begin_layout Plain Layout

$c_{0}=
\backslash
left
\backslash
{0,s_{0},1
\backslash
right
\backslash
}$
\end_layout

\begin_layout Plain Layout

$C=
\backslash
left
\backslash
{c_{0}
\backslash
right
\backslash
}$, $|C|=1$
\end_layout

\begin_layout Plain Layout

#For all the following tracks
\end_layout

\begin_layout Plain Layout

for $i$ from $1$ to $|T|-1$
\end_layout

\begin_layout Plain Layout

	$
\backslash
mathbf{t}=T_{i}$
\end_layout

\begin_layout Plain Layout

	#Store distances with cluster features
\end_layout

\begin_layout Plain Layout

	$alld$=zeros($|C|$)
\end_layout

\begin_layout Plain Layout

	#Store flipping if needed
\end_layout

\begin_layout Plain Layout

	$flip$=zeros($|C|$)
\end_layout

\begin_layout Plain Layout

	#For all the clusters
\end_layout

\begin_layout Plain Layout

	for $k$ from $0$ to $|C|-1$
\end_layout

\begin_layout Plain Layout

		$
\backslash
mathbf{v}=C_{k}.
\backslash
mathbf{h}/C_{k}.N$
\end_layout

\begin_layout Plain Layout

		$d$=$d_{d}(
\backslash
mathbf{t},
\backslash
mathbf{v})$
\end_layout

\begin_layout Plain Layout

		$f$=$d_{f}(
\backslash
mathbf{t},
\backslash
mathbf{v})$
\end_layout

\begin_layout Plain Layout

		#If flip distance is smaller than direct distance
\end_layout

\begin_layout Plain Layout

		if $f < d$
\end_layout

\begin_layout Plain Layout

			$d = f$
\end_layout

\begin_layout Plain Layout

			$flip_{k}=1$
\end_layout

\begin_layout Plain Layout

		$alld_{k}=d$	
\end_layout

\begin_layout Plain Layout

	#Find minimum distance and index
\end_layout

\begin_layout Plain Layout

	$m=min(alld)$
\end_layout

\begin_layout Plain Layout

	$l=argmin(alld)$	
\end_layout

\begin_layout Plain Layout

	#If smaller than any class threshold then 
\end_layout

\begin_layout Plain Layout

	#add track to that class
\end_layout

\begin_layout Plain Layout

	if $m < thr$
\end_layout

\begin_layout Plain Layout

		if $flip_{l}=1$
\end_layout

\begin_layout Plain Layout

			$C_{l}.
\backslash
mathbf{h}+=t'$ #reverse direction
\end_layout

\begin_layout Plain Layout

		else
\end_layout

\begin_layout Plain Layout

			$C_{l}.
\backslash
mathbf{h}+=t$ #same direction
\end_layout

\begin_layout Plain Layout

		$C_{l}.N+=1$
\end_layout

\begin_layout Plain Layout

		$C_{l}.I$.append(i)
\end_layout

\begin_layout Plain Layout

	#Otherwise create a new class
\end_layout

\begin_layout Plain Layout

	else
\end_layout

\begin_layout Plain Layout

		$|C|+=1$
\end_layout

\begin_layout Plain Layout

		$C_{|C|-1}.I_{0}=l$
\end_layout

\begin_layout Plain Layout

		$C_{|C|-1}.
\backslash
mathbf{h}=
\backslash
mathbf{t}$
\end_layout

\begin_layout Plain Layout

		$C_{|C|-1}.N=1$
\end_layout

\begin_layout Plain Layout

	
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout

\series bold
\begin_inset CommandInset label
LatexCommand label
name "alg:LSC"

\end_inset


\series default
Local Skeleton Clustering
\begin_inset Newline newline
\end_inset


\series bold
Input
\series default
: tractography 
\begin_inset Formula $T=\{s_{0},...,s_{i},...,s_{|T|-1}\}$
\end_inset

, distance threshold 
\begin_inset Formula $thr$
\end_inset


\begin_inset Newline newline
\end_inset


\series bold
Output
\series default
: clustering 
\begin_inset Formula $C=\{c_{0},...,c_{k},...,c_{|C|-1}\}$
\end_inset

, where a cluster 
\begin_inset Formula $c=\{I,\mathbf{h},N\}$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
When using the MDF distance and adding tracks together because tracks are
 not directed towards a specific direction flipping can be of an issue.
 The complete LSC algorithm is described in detail in 
\begin_inset CommandInset ref
LatexCommand ref
reference "alg:LSC"

\end_inset

 and a simple visual step by step example is given in 
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:LSC_simple"

\end_inset

.
 One the of the reasons why LSC is a linear time algorithm is because on
 the structure of the cluster node; we only save the sum of current tracks
 in the cluster for example if we were using k-means at every iteration
 we would have to recalculate the average and that is conputationaly much
 more intensive.
 Another nice property of LSC is that it goes through the tracks only once
 and that a track belongs to only one cluster.
 Another nice property is that we can extend the cluster node to contain
 more information for example we could redefine 
\begin_inset Formula $c=\{I,\mathbf{h},n,\mathbf{v}\}$
\end_inset

 where the virtual track is saved as well but we could also add more interesting
 information for example we could redefine 
\begin_inset Formula $c=\{I,\mathbf{h},n,\mathbf{h}^{2}\}$
\end_inset

 to obtain second order information and that way we could calculate the
 variance of the cluster where 
\begin_inset Formula $\mathbf{h}^{2}\leftarrow\{x^{2},y^{2},z^{2},xy,yz,xz\}$
\end_inset

.
 Although this alternative would be very useful as even more refined cluster
 distances could be used which take into account that information this is
 not addressed in this document.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename last_figures/LSC_algorithm.png
	scale 27
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Fig:LSC_simple"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
LSC step by step visual example.
 Initially in panel (i) 6 unclustered tracks (A-F) are presented; imagine
 that the distance threshold used is the mdf distance (eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:direct_flip_distance"

\end_inset

) between B and E.
 The algorithm starts and in (ii) we see that track A was selected, so no
 other clusters exist so track A becomes the first cluster (labeled with
 purple color) and the virtual track of that cluster is identical with A
 as seen in (iii) , next in (iv) track B is selected and we calculate the
 mdf distance between B and the virtual track of the other clusters.
 For the moment there is only one cluster to compare so LSC calculates mdf(B,vir
tual-purple) and this is obviously bigger than threshold (that being mdf(B,E)
 therefore a new cluster is assigned for B and B becomes the virtual track
 of that cluster as show in (v).
 In (vi) the next track is selected and this is again far away from both
 purple and blue virtuals therefore another cluster is created and B is
 the virtual of the blue cluster as shown in (vii).
 In (viii) track D is current and after we have calculated mdf(D,purple),mdf(D,B
lue) and mdf(D,green) it is obvious that D belongs to the purple cluster
 as mdf(D,purple) is smaller and lower than threshold as shown in (ix).
 However we can now see in (x) that things change for the purple cluster
 because the virtual track is not anymore made by only one track but it
 is the average of D and A shown with dashline.
 In (xi) E is the current track and will be assigned at the green cluster
 as shown in (xii) because mdf(E,virtual green)=mdf(E,B)=thr and in (xiii)
 we see the updated virtual track for the green cluster which is equal to
 (B+E)/2 where + means track addition.
 In (xiv) the last track is picked and compared with the virtual tracks
 of the other 3 clusters obviously mdf(F,purple) is the only with smaller
 threshold and F is assigned to the purple cluster in (xv).
 Finally, in (xvi) the virtual purple track is refined as (D+A+F)/3.
 As there are no more tracks to select the algorithm stops.
 We can see all three clusters have been found and all tracks have been
 assigned successfuly.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
One of the disadvantages of most clustering algorithms is that they give
 different results with different initial conditions for example have a
 look at k-means, expectation-maximization and k-centers.
 The same holds for LSC so if there is not a single distance which can separate
 all clusters then with different permutations of the same tractography
 we will see similar number of clusters as show in Fig.
 XXX but different underlying clusters.
 
\end_layout

\begin_layout Subsubsection
Power of LSC simplifications
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset CommandInset label
LatexCommand label
name "Flo:cst_pbc"

\end_inset


\begin_inset Graphics
	filename last_figures/cst_simplification.png
	scale 30
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
This is a part of the CST bundle consisting of 
\begin_inset Formula $11041$
\end_inset

 tracks merged by an expert (PBC data) shown with red color.
 Visualy it looks like all tracks have similar shape and possibly merge
 towards the bottom and then spread when going upper.
 However, this is only an illusion.
 LSC can help us see the real structure of the bundle and identify its elements.
 Here on the right side we see a simplification (virtual tracks) of the
 red CST by running LSC with distance threshold of 
\begin_inset Formula $10$
\end_inset

 mm and downsampling of 
\begin_inset Formula $12$
\end_inset

 points.
 We can easily perceive that lots of parts which looked homogeneous are
 actually broken bundles e.g.
 dark green (bottom), light blue (bottom) or bundles with very different
 shape e.g.
 light green virtual track up.
 To cluster this bundle took 
\begin_inset Formula $135$
\end_inset

 ms 
\begin_inset Formula $\simeq$
\end_inset

 
\begin_inset Formula $0.14$
\end_inset

 seconds.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Itemize
Simulations
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/helix_phantom.png
	scale 80
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
On the left we see 3 bundles of simulated trajectories; red, blue and green
 consisting of 150 tracks each.
 All 450 tracks are clustered together using LSC and the virtual tracks
 are shown when threshold 1 was used shown in the middle and 8 on the right.
 We can see that when the threshold is low enough the underlying structure
 is a good representation of the underlying geometry.
 However when the distance threshold is higher closer bundles could merge
 together as seen in the result on the right side where the red and blue
 bundle have merged together in one cluster represented by the purple virtual
 track.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
asdfasfasf
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/LSC_simple.png
	scale 60

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Left - Here we see how LSC clustered the fornix bundle with dataset from
 the PBC competition.
 The initial fornix shown with black colour consists of 1076 tracks.
 All tracks were equidistantly downsampled at 3 points in this example.
 With a 5mm threshold our method generates 22 clusters (top right).
 With 10mm generates 7 and with 20mm the whole fornix is determined by one
 cluster only (bottom right).
 Right - an example of a full tractography 250,000 tracks being clustered
 using LSC with a distance threshold of 10mm.
 Here you see only 763 virtual tracks depicted which produce a useful simplifica
tion of the initial tractography.
 Small bundles have been removed.
 Every track shown here represents an entire cluster from 10 to 5000 tracks
 each.
 These can be thought as fast access points to explore the entire dataset.
 The colour here just encodes track orientation.
 Therefore, you can click on a track and obtain the entire cluster/bundle
 back.
 Visualizing an entire dataset of that size is impossible on standard graphic
 cards and most visualization tools can only show you a random sample of
 the tractography at real time.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
asfasdf
\end_layout

\begin_layout Subsubsection
Complexity and timings
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="5">
<features>
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Number of tracks
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Algorithms
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Timings (secs)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LSC (secs)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Speedup
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Wang et al.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
30
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.07
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
429
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
60,000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Wang et al.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
14400
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
14.7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
980
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
400,000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Visser et al.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
75000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
160.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
468
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
LSC run on 12 point tracks and distance threshold at 10mm compared with
 some timings reported from other state of the art methods found in the
 literature.
 Unfortunately timings were very rarely reported until today as most algorithms
 were very slow on full datasets.
 However the speedup that LSC offers is obviously of great importance; allowing
 even for real-time clustering on subsets less than 20,000 tracks.
 LSC was run on a single thread of Intel Xeon(R) CPU E5420 @ 2.50GHz to generate
 this timings.
 
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Itemize
plot timings vs #tracks for LSC vs different distance thresholds
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/lsc_timings_points2.png
	scale 25
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
LSC is a super-efficient algorithm that its performance is influenced from
 a few parameters.
 The first is the number of tracks, a second is the distance threshold in
 millimeters - shown with different colours and another is the amount of
 initial downsampling of the initial trajectories.
 A last parameter not shown in these diagrams is the underlying structure
 of the data which is expressed by the number of final clusters.
 We used a full tractography to generate these figures without removing
 or preselecting any parts.
 This results run of a single thread Intel(R) Xeon(R) CPU E5420 @ 2.50GHz.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Itemize
plot cluster size along time
\end_layout

\begin_layout Itemize
\begin_inset Formula $O(N)$
\end_inset

 on the number of tracks when the number of clusters is small which is the
 average case worst case is 
\begin_inset Formula $O(N^{2})$
\end_inset

 when the number of clusters is the same as the number of tracks.
\end_layout

\begin_layout Itemize
\begin_inset Formula $O(M)$
\end_inset

 i.e.
 on memory usage where 
\begin_inset Formula $M$
\end_inset

 is the number of clusters and because this is usually much smaller than
 
\begin_inset Formula $N$
\end_inset

 we considered memory consumption to be trivial.
 For example even for big tractographies 20 or more clusterings can be stored
 simultaneously in RAM with no problem.
\end_layout

\begin_layout Subsubsection
Stability and orderings
\end_layout

\begin_layout Itemize
completeness
\end_layout

\begin_layout Itemize
correctness
\end_layout

\begin_layout Itemize
random classification error
\end_layout

\begin_layout Itemize
kappa?
\end_layout

\begin_layout Standard
plot one subject with 5 random orderings (10 comparisons) and mean and std
 for each of these methods and then the same for all other subjects and
 then plot
\end_layout

\begin_layout Standard
the mean of means and std of means (barchart)
\end_layout

\begin_layout Subsubsection
Virtual tracks, exemplar tracks and other features.
\end_layout

\begin_layout Standard
The virtual tracks created by LSC have very nice properties as they represent
 an average track which can stand as the most important feature of the cluster
 that they belong.
 However, now that we have segmented our tractography in small bundles one
 could calculate many more important features for the cluster.
 The first thing in mind is the variance which now can be computed for every
 cluster 
\begin_inset Formula $c_{i}$
\end_inset

 as 
\begin_inset Formula $Var(c_{i})_{j}=Var(x_{j}-v{}_{j}))$
\end_inset

 where 
\begin_inset Formula $x_{j}$
\end_inset

 is point 
\begin_inset Formula $j$
\end_inset

 in a track in that cluster and 
\begin_inset Formula $v_{j}$
\end_inset

 is the corresponding point of the virtual track.
 Many other variance related or higher order statistics can be computed
 now easily.
 
\end_layout

\begin_layout Standard
Another interesting idea in relation to the virtual track is to try to identify
 another feature for the bundle which will now belong to the real datasets.
 In other words find an exemplar or centroid track.
 Remember that the virtual tracks do not exist as they are but they are
 just the outcome of massive amalgamations.
 There are many strategies on how to select good exemplars for the bundles.
 A very quick procedure that we use in this work is to find which track
 from the cluster is closer to the virtual track.
 We denote this exemplar track with the letter 
\begin_inset Formula $e$
\end_inset

.
 Another exemplar could be selected as the most similar track along all
 tracks in the bundle which we denote with 
\begin_inset Formula $e_{2}$
\end_inset

.
 This will be efficient only on small bundles with less than 5000 tracks
 because we need to calculate all pairwise distances in the bundle and then
 choose that which has most neighbours.
 We will see in the next section how the exemplars can be used to simplify
 the bi-directionality problem when merging clusters.
\end_layout

\begin_layout Subsubsection
The bi-directionality problem
\begin_inset CommandInset label
LatexCommand label
name "sub:The-bi-directionality-problem"

\end_inset


\end_layout

\begin_layout Standard
Most tractography generation methods will create tracks with random directions;
 meaning that close and similar tracks can have opposite directions.
 Of course the tracks do not really curry directional information.
 With direction here we mean how we encode the sequence of points which
 define the track.
 We call this the bi-directionality problem.
 Using the mdf distance we have already found a way in LSC to reduce this
 problem locally in the clusters.
 However, if we need to merge clusters together we should have a way to
 further reduce this difficult problem.
 Define a static point in the 3d space of the tractography, possibly away
 from the mid-saggital plane.
 Then re-direct all tracks so that the first point of every track is closer
 to the static point.
 If the tractography is in native space it suffices to have the origin 
\begin_inset Formula $(0,0,0)$
\end_inset

 as the static point, in MNI space we can use 
\begin_inset Formula $(100,100,100)$
\end_inset

.
 This method will redirect correctly most tracks however there will be a
 small percentage which will still have that problem.We can correct for this
 by using exemplar rather than virtual tracks as virtuals can be misrepresent
 a bundle if the bundle consists of bi-directional tracks.
 However, if we use an exemplar track as the feature of the track that track
 will have only one direction.
\end_layout

\begin_layout Subsection
Parallel version
\begin_inset CommandInset label
LatexCommand label
name "sub:Parallel-version"

\end_inset


\end_layout

\begin_layout Subsubsection
Algorithm
\end_layout

\begin_layout Standard
The LSC is a super-efficient algorithm however we wanted to make it even
 more efficient so that for example it is trivial to cluster hundreds of
 subjects together and use many CPUs or computers simultaneously.
 With the speed of LSC that would mean that you would actually be able to
 create an atlas of hundreds of subjects in a few hours.
 Therefore, we extend LSC to a parallel version which we call pLSC.
 This algorithm works as follows.
 First we redirect and downsample all tracks.
 Then we put all tracks together and brake them into subsets.
 For every subset we assign a new thread and LSC to run on that thread.
 Therefore, we have now many LSCs running on different CPUs.
 Then we collect all individual clusterings and start merging them together.
 We can pair every two results together and merge them in a binary way or
 just merge all clusterings to the first clustering.
 We can do merging with many different ways here we present the most modest
 but useful attempt.
\end_layout

\begin_layout Standard

\series bold
Merging
\series default
: We can merge bundles using exemplar tracks or virtual tracks.
 We first set a distance threshold 
\begin_inset Formula $thr$
\end_inset

 usually the same as the one we used for the LSCs in the previous step.
 Lets assume now that we have gathered the virtual tracks from clustering
 
\begin_inset Formula $A$
\end_inset

 in 
\begin_inset Formula $V_{A}=\{v_{0},...,v_{|V_{A}|}\}$
\end_inset

 and from clustering 
\begin_inset Formula $B$
\end_inset

 in
\begin_inset Formula $V_{B}=\{v_{0}^{'},...,v_{|V_{B}|}^{'}\}$
\end_inset

 where 
\begin_inset Formula $|V|$
\end_inset

 denotes the number of virtual tracks of each clustering.
 
\begin_inset Formula $|V_{A}|$
\end_inset

 can be different than 
\begin_inset Formula $|V_{B}|$
\end_inset

.
 (a) For every 
\begin_inset Formula $v_{i}^{'}$
\end_inset

 in set 
\begin_inset Formula $V_{B}$
\end_inset

 we find the closest 
\begin_inset Formula $v_{j}$
\end_inset

 in set 
\begin_inset Formula $V_{A}$
\end_inset

 and store the distance between these two tracks.
 Therefore we now have a set of minimum distances from 
\begin_inset Formula $V_{B}$
\end_inset

 to 
\begin_inset Formula $V_{A}$
\end_inset

.
 The size of this set is the same with 
\begin_inset Formula $|V_{B}|$
\end_inset

.
 (b) Finally, we merge those clusters from 
\begin_inset Formula $V_{B}$
\end_inset

 which have minimum distances smaller than 
\begin_inset Formula $thr$
\end_inset

 and if not then we create a new cluster.
 In that way clusters from the two sets who have very similar features will
 merge together and if not new clusters will be created.
 In that way will not have any loss of information from both sets.
\end_layout

\begin_layout Subsection
Tightness comparisons
\begin_inset CommandInset label
LatexCommand label
name "sub:Tightness-comparisons"

\end_inset


\end_layout

\begin_layout Standard
Very rarely in the literature we found arithmetic ways to compare different
 clustering results.
 Usually, there were only empirical comparisons or comparisons against simulatio
ns.
 We think that being able to compare results is crucial for creating stable
 brain imaging procedures.
 We would like to have a way to compare different clusterings of the same
 subject or different subjects.
 Although we do understand that this is a difficult problem, we propose
 the following solution with a metric which we call tight comparison (TC).
 Tight comparison works as follows.
 Lets assume that we have gathered the exemplar tracks from clustering 
\begin_inset Formula $A$
\end_inset

 in 
\begin_inset Formula $E_{A}=\{e_{0},...,e_{|E_{A}|}\}$
\end_inset

 and from clustering 
\begin_inset Formula $B$
\end_inset

 in 
\begin_inset Formula $E_{B}=\{e_{0}^{'},...,e_{|V_{B}|}^{'}\}$
\end_inset

 where 
\begin_inset Formula $|E|$
\end_inset

 denotes the number of exemplar tracks of each clustering 
\begin_inset Formula $E$
\end_inset

.
 The size of set 
\begin_inset Formula $E_{A}$
\end_inset

 does not need to be the same with that of 
\begin_inset Formula $E_{B}$
\end_inset

 (i.e.
 
\begin_inset Formula $|E_{A}|\neq|E_{B}|$
\end_inset

 or 
\begin_inset Formula $|E_{A}|=|E_{B}|$
\end_inset

).
 Next, we calculate all pairwise mdf distances between the two sets and
 store them in rectangular matrix 
\begin_inset Formula $D_{AB}$
\end_inset

.
 From the the columns of 
\begin_inset Formula $D_{AB}$
\end_inset

 we can find correspondence pairs from 
\begin_inset Formula $A$
\end_inset

 to 
\begin_inset Formula $B$
\end_inset

 (
\begin_inset Formula $E_{A\rightarrow B}$
\end_inset

) and by checking the rows of 
\begin_inset Formula $D_{AB}$
\end_inset

 we can find the corresponding pairs from 
\begin_inset Formula $A$
\end_inset

 to 
\begin_inset Formula $B$
\end_inset

 (
\begin_inset Formula $E_{B\rightarrow A}$
\end_inset

).
 From these pairs we only keep those which have distances smaller than a
 small tight threshold 
\begin_inset Formula $t_{thr}$
\end_inset

.
 Then we define TC to be
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{equation}
TC=\frac{1}{2}\left(\frac{|E_{A\rightarrow B}\leq t_{thr}|}{|E_{A}|}+\frac{|E_{B\rightarrow A}\leq t_{thr}|}{|E_{B}|}\right)\end{equation}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $|E_{A\rightarrow B}\leq t_{thr}|$
\end_inset

 denotes the number of exemplars from A which had a close pair to B that
 was closer than 
\begin_inset Formula $t_{thr}$
\end_inset

 and similarly for 
\begin_inset Formula $|E_{B\rightarrow A}\leq t_{thr}|$
\end_inset

 the number of exemplars from B to A which their distance was smaller than
 
\begin_inset Formula $t_{thr}$
\end_inset

.
 When 
\begin_inset Formula $TC=0$
\end_inset

 that means that no exemplar from the one set was closer than 
\begin_inset Formula $t_{thr}$
\end_inset

 to any other exemplar to the other set.
 When 
\begin_inset Formula $TC=1$
\end_inset

 then all exemplars from one set had a close neighbour to the other set.
 This metric is extremely useful especially when comparing tractographies
 from different subjects.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
!!!!CREATE A DIAGRAM WHERE YOU SHOW COMPARISONS FROM DIFFERENT ORDERINGS
 AND DIFFERENT SUBJECTS
\end_layout

\begin_layout Plain Layout
For different subjects 
\begin_inset Formula $\binom{10}{2}=45$
\end_inset

 , TC10 mean 0.4690955208544213, TC10 std 0.02635549381315298, TC100 mean
 0.52516460626048289, TC100 std 0.049120754359623708, t-test t-statistic -8.0359458
956507464, p-value 3.5820657551255408e-10.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Direct applications
\end_layout

\begin_layout Standard
We found that LSC has numerous applications from detecting erroneous tracks
 to creating atlases, finding landmarks and guiding registration algorithms.
 Here we present just a few of the strategies that someone could follow.
\end_layout

\begin_layout Subsubsection
Removing erroneous tracks
\end_layout

\begin_layout Standard
It is well known that there are different artifacts seen in tractographies
 today caused by subject motion, poor voxel reconstruction, incorrect tracking
 and many other reasons.
 However there is no known automatic method to try and detect these tracks
 and therefore remove them from the datasets.
\end_layout

\begin_layout Standard
One of the tracks which are most likely erroneous are tracks which wind
 more than one times; similar to a spiral.
 We can detect those with the following algorithm.
 Lets assume that we have a track 
\begin_inset Formula $s$
\end_inset

 which we want to check if it winds: a) we perform a singular value decompositio
n on the centered track 
\begin_inset Formula $U,\mathbf{d},V=\mathtt{SVD}(s-\bar{s})$
\end_inset

, b) project the highest singular value 
\begin_inset Formula $\mathbf{d_{0}}$
\end_inset

 to the first column of 
\begin_inset Formula $U,$
\end_inset

 
\begin_inset Formula $U_{o}$
\end_inset

 creating the first component of a two dimensional coordinate 
\begin_inset Formula $p_{x}$
\end_inset

 and the second highest 
\begin_inset Formula $\mathbf{d_{1}}$
\end_inset

 to the second column 
\begin_inset Formula $U_{1}$
\end_inset

 creating the second coordinate 
\begin_inset Formula $p_{y}$
\end_inset

 and c) calculate the cumulative winding angle on the 2d plane d) if the
 cumulative angle is more that 
\begin_inset Formula $400$
\end_inset

 degrees then that would mean that the initial track 
\begin_inset Formula $s$
\end_inset

 is winding and therefore needs to be removed, see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:winding"

\end_inset

.
\end_layout

\begin_layout Standard
This winding tracks can be dangerous when we merge clusters because they
 could be close to many different clusters.
 We found that winding tracks often form bundles with many similar tracks.
 Also, they are usually long tracks so they will not be removed with any
 filters which remove short tracks.
 We can use LSC with a low threshold and then run the previous algorithm
 only on the exemplar tracks of the bundles rather than the entire tractography.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset CommandInset label
LatexCommand label
name "Flo:winding"

\end_inset


\begin_inset Graphics
	filename last_figures/winding.png
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Example of detecting a possibly erroneous 3d bundle (on the left) by projecting
 its exemplar track and counting the winding cumulative angle 
\begin_inset Formula $\sum_{0}^{N}\omega_{i}$
\end_inset

 on the 2d plane as shown on the right, where 
\begin_inset Formula $N$
\end_inset

 is the total number of track segments.
 Usually bundles with total angle higher than 400 degrees are removed from
 the datasets as most likely to be erroneous.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
LSC can also simplify detection of tracks which are very dissimilar to others
 and therefore they are very distant from all other clusters.
 Usually when we use an LSC threshold of about 10mm these tracks will be
 part of small bundles containing a few tracks (<10) and their distance
 of the bundle they belong against all other bundles will be much higher
 than average.
 This can give us another detection method for outliers.
\end_layout

\begin_layout Standard
Finally, LSC can be used to remove small or broken tracks in an interactive
 way, for example see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:cst_pbc"

\end_inset

 where the red large bundle has been merged by an expert and then with LSC
 we can perceive the skeleton of the bundle and see which parts create that
 structure.
 Without LSC it would be counterintuitive to figure out that this bundle
 consists of many small or divergent parts; possibly because of the noise
 in the real datasets.
 In that figure both very diverging, small or broken tracks can be identifying
 after the simplification provided by LSC.
 In summary, we have shown that LSC can provide a fully automatic, efficient
 and robust detection system for erroneous tracks in specific bundles or
 entire tractographies.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/erroneous_tracks.png
	scale 65
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Flo:erroneous_tracks"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
161 most likely erroneous bundles automatically detected by our winding
 method all having total winding angle higher than 500 degrees and shown
 with random colours per bundle.
 On the left panel we see the bundles on their exact position in the dataset
 from the top of the head, on the middle panel we see the same tractography
 from the side and the third panel we see the part of middle panel on the
 red box slightly rotated and much zoomed so that some erroneous tracks
 can be easily shown.
 To cluster the initial tractography not shown here we used LSC with threshold
 10mm.
 This is the first known automatic detection system of outliers and erroneous
 tracks for tractography data.
 By calculating the number of winding tracks in your datasets over the total
 number of tracks you can have an indicator of the quality of our datasets.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Agreements and landmarks
\end_layout

\begin_layout Subsubsection
Atlases made easy
\begin_inset CommandInset label
LatexCommand label
name "sub:Atlases-made-easy"

\end_inset


\end_layout

\begin_layout Standard
A solid tractographic atlas was joined in MNI space from 10 subjects.
 Here we explain the steps we used to achieve that.
\end_layout

\begin_layout Standard

\series bold
Alignment
\series default
.
 Tractographies were created using EuDX with QA produced by Generalized
 Q-Sampling with diffusion sampling length of 1.2 and datasets from 101 gradient
 directions with maximum b-value 4000 and 1 with b-value ~ 0 gathered from
 10 healthy subjects at the MRC-CBU Siemens Trio using the 32 channels coil,
 STEAM sequence and voxel size 
\begin_inset Formula $2.5\times2.5\times2.5$
\end_inset

; see section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Acquisition-sequences-in-use"

\end_inset

 for acquisition details.
 The EuDX parameters were: low QA threshold of 0.0239, propagation step size
 of 0.5, angular threshold 60 degrees and total weighting 0.5.
 The tractographies for all subjects were initially in native space and
 the goal was to warp them in MNI space, using nonlinear registration.
 
\end_layout

\begin_layout Standard
Because the registration problem is generally considered a difficult problem
 with a non-unique solution we wanted to make sure that we are using a known,
 well established and robust method therefore we choosed to use fnirt with
 the same parameters as used with the first steps of TBSS
\begin_inset CommandInset citation
LatexCommand cite
key "Smith2006NeuroImage"

\end_inset

.
 For that reason FA volumes were generated from the same datasets using
 Tensor fitting with weighted least squares after sculp stripping with bet
 and parameters '-F -f .2 -g 0'.
 These FA volumes were again in native space therefore we needed to warp
 them in MNI space.
 For this purpose a standard template FMRIB58_FA_1mm from the FSL toolbox
 was used as the reference volume.
 However, we wanted primirily to have the displacements which would do a
 point wise mapping from native space to MNI space and we found this to
 be technically very difficult with the FSL tools as they assume that these
 displacements will be applied only on volumetric data and not with point
 data as those used in tractographies.
 Finally, after some considerable effort we found a combination of flirt,fnirt,i
nvwarp,fnirtfileutils and fnirtfileutils -withaff which gave us the correct
 displacements.
 As this being very technical we will not describe it further here but the
 code is available in module (dipy.external.fsl).
 It is also important to say that we didn't use eddy correction with any
 of this type of datasets because eddy correction is unstable with volumes
 at high b-values because there is no much signal for guiding a correct
 registration with the other volumes at lower b-values.
\end_layout

\begin_layout Standard
After creating the displacements for every subject; these were applied to
 all tractographies in the native space so they are mapped in the MNI space
 of voxel size 
\begin_inset Formula $1\times1\times1mm^{3}$
\end_inset

 .
 Having all tractographies in MNI space is something very useful because
 we can now compare them against available templates or against each other
 and calculate different statistics.
 Notwithstanding, a method is described below to 
\emph on
genera
\emph default
te
\emph on
 a
\emph default
 
\emph on
robust tractographic atlas 
\emph default
using
\emph on
 clustering
\emph default
.
\end_layout

\begin_layout Standard

\series bold
Tractographic Atlas.

\series default
 For all subjects, i) load warped tractography ii) re-direct a static point
 
\begin_inset Formula $(100,100,100)$
\end_inset

 as explained in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:The-bi-directionality-problem"

\end_inset

, iii) downsample the tracks to have only 12 points, iv) calculate and store
 LSC clustering with a 10mm threshold.
 Then merge all clusterings again with 10 mm threshold as explained in section
 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Parallel-version"

\end_inset

 (merging).
 When creating an atlas by merging many different subjects the most important
 issue is what you remove from the atlas as outliers.
 LSC here provides a possible solution for this problem.
 If we plot the number of tracks for each cluster sorted in ascending order
 we can see an interesting pattern 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset CommandInset label
LatexCommand label
name "Flo:atlas_big_bundles"

\end_inset


\begin_inset Graphics
	filename last_figures/big_bundles_atlas.png
	scale 60
	rotateOrigin center

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
14520 clusters when created by joining the LSC clusterings of 10 subjects
 in MNI space.
 We found that most of the clusters had a few tracks and only a few clusters
 had many.
 In the diagram above we can see 20% of the largest clusters had more than
 90% of the total amount of tracks.
 This was a very positive result showing that there is a lot of agreement
 between different subjects which would be useful for a solid atlas with
 the biggest bundles becoming landmark bundles and the small bundles removed
 as outliers.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard

\series bold
Finding and using Landmarks
\end_layout

\begin_layout Standard
One can use this atlas or similar atlases created from more subjects in
 order to select specific structures and study these structures directly
 in different subjects without using any of the standard region-of-interest
 based methods.
\end_layout

\begin_layout Standard
A simple example is given in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:CloseToSelected"

\end_inset

.
 In the first row we see a tractrographic atlas joined by merging the LSC
 clusterings of 10 healthy subjects as described in the previous section.
 Then from these clusters represented by their virtual tracks we keep only
 196 biggest clusters i.e.
 those which contain the highest number of tracks, so that we are sure that
 there is enough agreement from the different tractographies and from these
 we just pick as an example here 19 virtual tracks which correspond to well
 known bundle structures in the literature: 1 from genu of corpus callosum
 (GCC), 3 from the body of corpus callosum (BCC), 1 from the splenium (SCC),
 1 from the pons cerebellar peduncle (CP), 1 from left arcuate fasciculus
 (ARC-L), 1 from right arcuate fasciculus (ARC-R), 1 from left inferior
 occipitofrontal fasciculus (IFO-L) and 1 from right inferior occipitofrontal
 fsciculus (IFO-R), 1 from right fornix (FX-R), 1 from left fornix (FX-L),
 1 optic radiation (OR), 1 left cingulum (CGC-L), 1 from right cingulum
 (CGC-R), 1 from left corticospinal tract (CST-L), 1 from right corticospinal
 tract (CST-R), 1 from left uncinate (UNC-L) and 1 from right uncinate (UNC-R).
 These 19 tracks are coloured randomly.
 Then on the second row we bring for the first 6 selections the tracks closer
 than 20mm from 3 random subjects.
 Similarly, on the third row the tracks closer than 15mm to the next 7 picked
 tracks.
 Finally on the last row we bring the tracks from the 3 subjects which are
 closer than 18mm.
 The colours used for the selected tracks are automaticaly assigned from
 the colours of tracks picked from the atlas.
 We can see that there is a massive reliability and continuity in the same
 or in between different subjects although we only selected very few tracks.
 Using a similar procedure we could create a book of bundles for every subject
 and then compare the subjects per bundle.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/close_distance.png
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Flo:CloseToSelected"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
A novel way to do comparisons between subjects.
 Correspondence between different subjects (last 3 rows) and a few landmarks
 picked from the tractographic atlas generated by merging LSC clusterings
 of 10 subjects (top row).
 That we can see this amount of agreement and continuity on the last 3 rows
 from such a few skeletal tracks is a great hope for implementing new robust
 ways of statistical comparisons using tractographic datasets.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
LSC as input to other learning methods
\end_layout

\begin_layout Standard
We found that LSC is of great value to many less efficient algorithms e.g.
 hierarchical clustering, affinity propagation, nearest neighbours, spectral
 clustering and other unsupervised and supervised learning methods.
 We present here one example with LSC as input to affinity propagation and
 one with LSC as input to hierarchical clustering.
\end_layout

\begin_layout Standard
Most clustering algorithms need to calculate all pairwise distances between
 tracks; that means that for a medium sized tractography of 250,000 tracks
 we would need 232 GBytes of RAM with single floating point precision.
 Something which is not and will not be available soon in personal computers.
 In those cases some people would wish that sparse matrices would be of
 a nice approximation however dense tractographies produce very dense distance
 matrices.
 The straightforward solution to this problem is to use LSC in order to
 first segment in small clusters and then use the skeletons (i.e.
 exemplar or virtual tracks) of these clusters with other higher complexity
 operations and merge the clusters together in bigger clusters.
\end_layout

\begin_layout Standard
Algorithm:
\end_layout

\begin_layout Standard
i)Cluster using LSC as explained in section
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Atlases-made-easy"

\end_inset


\end_layout

\begin_layout Standard
ii)Gather virtual tracks
\end_layout

\begin_layout Standard
iii)Calculate mdf distance of virtual tracks with themselves.
\end_layout

\begin_layout Standard
iv)Use any other clustering method to segment this much smaller distance
 matrix 
\begin_inset Formula $D$
\end_inset

.
\end_layout

\begin_layout Standard
In Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:LSC+HC+AP"

\end_inset

 at the left panel we show a result were we used hierarchical clustering
 with single linkage for step (iv) with threshold of 20mm using the package
 hcluster (see 
\begin_inset CommandInset citation
LatexCommand cite
key "eads-hcluster-software"

\end_inset

).
 A known drawback of single linkage is the so-called chaining phenomenon:
 clusters may be forced together due to single elements being close to each
 other, even though many of the elements in each cluster may be very distant
 to each other.
 Chaining is usually considered as a disadvantage because it is too driven
 by local neighbours.
 Nevertheless, we can use this property to cluster the corpus callosum all
 together (shown with dark red in left top of Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:LSC+HC+AP"

\end_inset

) creating a fully automatic CC detection system.
 Furthermore, we can use different cutting thresholds to amalgamate together
 different structures e.g.
 see the cingulum bundles in the same panel.
\end_layout

\begin_layout Standard
In the right panel of Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:LSC+HC+AP"

\end_inset

 we see implementation of step (iv) using a more recent algorithm; affinity
 propagation
\begin_inset CommandInset citation
LatexCommand cite
key "dueck2009affinity"

\end_inset

 which before was correctly identified from our group and 
\begin_inset CommandInset citation
LatexCommand cite
key "malcolm2009filtered"

\end_inset

 that was difficult or impossible to be used for group analysis or to cluster
 entire tractographies of many thousands of track.
 A small introduction of how this algorithm works is given in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Affinity-Propagation"

\end_inset

 .
 In here we can see in the bottom right panel how nicely it has clustered
 arcuate, longitudinal occipitofrontal fasciculus and other structures known
 from the literature.
 The input of AP was the negative distance matrix
\begin_inset Formula $-D$
\end_inset

 and preference was set to matrix 
\begin_inset Formula $\mathtt{median}(-D)$
\end_inset

 and hierarchical clustering parameter was set to 20mm.
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand cite
key "eades1984heuristic"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename last_figures/LSC_with_others.png
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Flo:LSC+HC+AP"

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
2 examples were LSC output is used to cluster an entire set of 10 tractographies
 together and then the result is given as input to hierarchical clustering
 (HC) using single linkage on the left and to affinity propagation (AP)
 on the right.
 Colours encode cluster labels and on the left we see 19 clusters and on
 the right 23.
 LSC fascilitates massively the operation of the other two algorithms which
 would not be able to cluster the entire datasets on current computers.
 Pay attention at the top left panel where LSC+HC have managed to cluster
 the entire CC as one bundle.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Exemplar tracks vs ROIs vs Masks
\end_layout

\begin_layout Standard
Medical practitioners and neuroanatomists often argue that when they use
 multiple spherical or rectangular masks to select some bundles many tracks
 are thrown away because they are smaller and the mask operations cannot
 catch them.
 Our method is a solution to this problem as it can identify broken or smaller
 bundles inside other bigger bundles which are very difficult or even sometimes
 impossible to identify visually or with the use of masks.
 Our method attacks this problem and suggests a very efficient and robust
 solution which sets the limit for unsupervised clustering of tractographies
 and facilitates incredibly tractography exploration and interpretation.
 The point here is now that someone can use exemplar tracks as access points
 and with a single click on that exemplar track obtain the entire bundle.
 Therefore a superbundle can be created just with with a few clicks.
 
\end_layout

\begin_layout Standard
In order to create this system we implemented a collision detection system
 in Python and OpenGL similar with what is used in commercial game engines.
 This project has got great interest from other researchers and it has now
 become a new independent project found at http://www.fos.me .
\end_layout

\begin_layout Subsection
Affinity Propagation
\begin_inset CommandInset label
LatexCommand label
name "sub:Affinity-Propagation"

\end_inset


\end_layout

\begin_layout Standard
Affinity propagation (AP) is a very recent 
\begin_inset CommandInset citation
LatexCommand cite
key "frey2007clustering"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "dueck2009affinity"

\end_inset

 
\begin_inset Formula $O(N^{2})$
\end_inset

 clustering method which is based in loopy belief propagation 
\begin_inset CommandInset citation
LatexCommand cite
key "pearl1988probabilistic"

\end_inset

 and other recent innovations in graphical models and more specifically
 is an instance of the max-sum algorithm in factor graphs.
 AP is an exemplar based clustering method where the center of a cluster
 is a real data point (exemplar) as in k-medoids, k-centers rather than
 an average-virtual point as in k-means.
 AP starts by simultaneously considering all data points as potential exemplars.
 Every data point is a node in a network and AP recursively transmits real-value
d messages along the edges of the network until a good set of exemplars
 and corresponding clusters emerges.
 AP takes as input a collection of similarities between data points, where
 the similarity 
\begin_inset Formula $S(i,k)$
\end_inset

 indicates how well the data point with index 
\begin_inset Formula $k$
\end_inset

 is suited to be the exemplar for data point 
\begin_inset Formula $i$
\end_inset

.
 In order to understand AP we can think just for the moment that we try
 to cluster 2d data points and each similarity is expressed as the negative
 Euclidean distance 
\begin_inset Formula $S(i,k)=-||x_{i}-x_{k}||^{2}$
\end_inset

 see Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "Fig:AP_2d"

\end_inset

 therefore 
\begin_inset Formula $S$
\end_inset

 for the moment is the negative complete squared distance matrix.
 AP rather than requiring the number of clusters to be prespecified adds
 a real number on the diagonal elements of 
\begin_inset Formula $S$
\end_inset

, one for each data point so that larger values of 
\begin_inset Formula $S(k,k)$
\end_inset

 are more likely to become exemplars.
 For, simplicity we can choose the 
\begin_inset Formula $median(S)$
\end_inset

 as the common preference value for all points but in that way we don't
 enforce any 
\emph on
a priori
\emph default
 information for a point to be an exemplar more than other points and for
 some applications this could be beneficial.
 There are two different messages exchanged between points i) responsibilities
 
\begin_inset Formula $R(i,k)=S(i,k)-{\displaystyle \max_{k':k'\neq k}}[S(i,k')+A(i,k')]$
\end_inset

 and ii) availablilities which are 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
initially 
\begin_inset Formula $A(i,k)=0$
\end_inset

 and then equal to:
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{equation}
\forall i,k:\: A(i,k)=\begin{cases}
{\displaystyle \sum_{i':i'\neq i}} & max[0,\: R(i',k)],\: for\:\: k=i\\
\min & \left[0,\: r(k,k)+{\displaystyle \sum\max_{i':i'\notin\{i,k\}}[0,r(i',k)]}\right],\: for\:\: k\neq i\end{cases}\end{equation}

\end_inset


\end_layout

\begin_layout Standard
A simple version of affinity propagation is shown in alg.
\begin_inset CommandInset ref
LatexCommand ref
reference "alg:AP"

\end_inset

.
 A very interesting fact is the way we get the final exemplars using AP.
 
\end_layout

\begin_layout Standard
After the messages have converged, there are two ways you can identify exemplars
: 
\end_layout

\begin_layout Standard
i) For data point 
\begin_inset Formula $i$
\end_inset

, 
\begin_inset Formula $if\:\: R(i,i)+A(i,i)>0$
\end_inset

, then data point 
\begin_inset Formula $i$
\end_inset

 is an exemplar 
\end_layout

\begin_layout Standard
ii) For data point 
\begin_inset Formula $i$
\end_inset

, 
\begin_inset Formula $if\:\: R(i,i)+A(i,i)>R(i,j)+A(i,j)$
\end_inset

, for all 
\begin_inset Formula $i$
\end_inset

 not equal to 
\begin_inset Formula $j$
\end_inset

, then data point 
\begin_inset Formula $i$
\end_inset

 is an exemplar.
 
\end_layout

\begin_layout Standard
Therefore, the availabilities and responsibilities are added to identify
 exemplars.
 For point i, the value of 
\begin_inset Formula $k$
\end_inset

 that maximizes 
\begin_inset Formula $A(i,k)+R(i,k)$
\end_inset

 either identifies 
\begin_inset Formula $i$
\end_inset

 as an exemplar if 
\begin_inset Formula $k=i$
\end_inset

, or identifies the data point that is the exemplar for point 
\begin_inset Formula $i$
\end_inset

.
 The message passing procedure is terminated after a fixed number of iterations,
 after changes in the messages stay low or local decisions stay constant
 and also the messages are damped - combine previous with current message
 - to avoid numerical oscillations.
 
\end_layout

\begin_layout Standard
-problems what if similarity matrix too big?-too many points
\end_layout

\begin_layout Standard
-sparce or leverage.
\end_layout

\begin_layout Standard
-Solution is start with LSC with small threshold.
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
lstparams "basicstyle={\footnotesize},mathescape=true"
inline false
status collapsed

\begin_layout Plain Layout

$
\backslash
forall i,k:
\backslash
: A(i,k)=R(i,k)=0$
\end_layout

\begin_layout Plain Layout

Remove degeneracies
\end_layout

\begin_layout Plain Layout

$S=S+n$ 
\end_layout

\begin_layout Plain Layout

Set damping factor and last iteration
\end_layout

\begin_layout Plain Layout

d=0.5
\end_layout

\begin_layout Plain Layout

last_iter=100
\end_layout

\begin_layout Plain Layout

For every iteration
\end_layout

\begin_layout Plain Layout

for iter from 1 to last_iter:	
\end_layout

\begin_layout Plain Layout

	$R_{old}=R$
\end_layout

\begin_layout Plain Layout

	Update responsibilities
\end_layout

\begin_layout Plain Layout

	$
\backslash
forall i,k:
\backslash
: R(i,k)=S(i,k)-max_{k':k'
\backslash
neq k}[S(i,k')+A(i,k')]$
\end_layout

\begin_layout Plain Layout

	Dampen responsibilities
\end_layout

\begin_layout Plain Layout

	$R=(1-d)R+d*R_{old}$ 	
\end_layout

\begin_layout Plain Layout

	$A_{old}=A$
\end_layout

\begin_layout Plain Layout

	Update availabilities
\end_layout

\begin_layout Plain Layout

	$
\backslash
forall i,k:
\backslash
: A(i,k)=
\backslash
begin{cases} 
\backslash
sum_{i':i'
\backslash
neq i} & max[0,
\backslash
: R(i',k)],
\backslash
: for
\backslash
:
\backslash
: k=i
\backslash

\backslash
 
\backslash
min & 
\backslash
left[0,
\backslash
: 	R(k,k)+{
\backslash
displaystyle 
\backslash
sum
\backslash
max_{i':i'
\backslash
notin
\backslash
{i,k
\backslash
}}[0,R(i',k)]}
\backslash
right],
\backslash
: for
\backslash
:
\backslash
: k
\backslash
neq i
\backslash
end{cases}$
\end_layout

\begin_layout Plain Layout

	Dampen availabilities
\end_layout

\begin_layout Plain Layout

	$A=(1-d)A+dA_{old}$
\end_layout

\begin_layout Plain Layout

Find positive pseudomarginals
\end_layout

\begin_layout Plain Layout

$I_{d}=where(diag(E)>0)$
\end_layout

\begin_layout Plain Layout

Find indices of exemplars
\end_layout

\begin_layout Plain Layout

$
\backslash
forall i, I_{e}=argmax
\backslash
: S(i,I_{d})$
\end_layout

\begin_layout Plain Layout

$I_{e}(I_{d})=1:size
\backslash
: (I_{d})$
\end_layout

\begin_layout Plain Layout

Assing labels
\end_layout

\begin_layout Plain Layout

$L=I_{d}(I_{e})$
\end_layout

\begin_layout Plain Layout

Using now the labels we can add an extra step 
\end_layout

\begin_layout Plain Layout

in AP where we create a tree structure
\end_layout

\begin_layout Plain Layout

$C_{AP}=
\backslash
{c_{0},...,c_{k},...,c_{|C_{AP}|-1}
\backslash
}$, where a cluster $c=
\backslash
{I,
\backslash
mathbf{e},N
\backslash
}$}
\end_layout

\begin_layout Plain Layout

holds the exemplars $
\backslash
mathbf{e}$, the indices $I$ of the cluster elements and $N$ the
\end_layout

\begin_layout Plain Layout

number of elements in a cluster so that it resembles with the output of
 LSC
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "alg:AP"

\end_inset

Affinity Propagation
\begin_inset Newline newline
\end_inset


\series bold
Input
\series default
: similarity/affinity matrix 
\begin_inset Formula $S$
\end_inset

 where the diagonal elements of 
\begin_inset Formula $S(k,k)$
\end_inset

 indicate the a priori preference for 
\begin_inset Formula $k$
\end_inset

 to be chosen as an exemplar 
\begin_inset Newline newline
\end_inset


\series bold
Output
\series default
: clustering 
\begin_inset Formula $CAP=\{c_{o},...,c_{k},...,c_{|CAP|-1}\}$
\end_inset

, where a cluster 
\begin_inset Formula $c=\{I,\mathbf{e},N\}$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename last_figures/affinity_propagation_ok2.png
	scale 40
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "Fig:AP_2d"

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Simple example of affinity propagation at work where it can precisely identify
 4 different normal distributions with means 
\begin_inset Formula $(1,1),\;(-1,-1),\:(1,-1),$
\end_inset


\begin_inset Formula $(-2,2)$
\end_inset

 and standard deviation 
\begin_inset Formula $.5$
\end_inset

.
 You can see the exemplars - most representative actual points - with thicker
 dots perfectly aligned with the means.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard

\end_layout

\begin_layout Subsection
Direct Tractography Registration
\end_layout

\begin_layout Standard
Direct tractography registration is a recent problem with a small amount
 of publications and to our knowledge with no publically available solutions.
 With direct registration we mean that no other information apart from the
 tractographies themselves is guiding the registration.
 This is in contrast to the previous sections where we used FA registration
 mappings applied on tractographies (see section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Atlases-made-easy"

\end_inset

) which is also most commonly used in the literature along with other tensor
 based methods 
\begin_inset CommandInset citation
LatexCommand cite
key "goh2006algebraic"

\end_inset

.
 The current known methodologies on this subject where Leemans et al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "leemans2006multiscale"

\end_inset

uses the invariance of curvature and tortion under rigid registration along
 with procrustes analysis to co-register together different tractographies
 ,Mayer et al.
 used iterative closest point applied to register pre-selected bundles (bundles
 of interest - BOI) 
\begin_inset CommandInset citation
LatexCommand cite
key "mayer2008bundles"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "mayerdirect"

\end_inset

 and extended it using probabistic boosting tree classifiers for bundle
 segmentation in
\begin_inset CommandInset citation
LatexCommand cite
key "mayer2011supervised"

\end_inset

.
 Durrleman et al.
\begin_inset CommandInset citation
LatexCommand cite
key "durrleman2010registration"

\end_inset

 reformulate the tracks as currents and implemented a currents based registratio
n, Zvitia et al.
\begin_inset CommandInset citation
LatexCommand cite
key "zvitia2008adaptive"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "Zvitia2010"

\end_inset

, used adaptive mean shift clustering to extract a number of representative
 ﬁber-modes.
 Each fibre mode was assigned to a multivariate Gaussian distribution according
 to its population thereby leading to a Gaussian Mixture model (GMM) representat
ion for the entire set of ﬁbers.
 The registration between two ﬁber sets was treated as the alignment of
 two GMMs and is performed by maximizing their correlation ratio.
 A further refinement was added using RANSAC
\begin_inset CommandInset citation
LatexCommand cite
key "fischler1981random"

\end_inset

 to obtain all 12 affine parameters.Ziyan et al.
\begin_inset CommandInset citation
LatexCommand cite
key "ZiyanMICCAI07"

\end_inset

 developed a nonlinear registration algorithm based on the log-Euclidean
 polyaffine framwork
\begin_inset CommandInset citation
LatexCommand cite
key "Arsigny2009"

\end_inset

 however this is not a direct tractography registration algorithm as they
 first create scalar volumes, therefore they don't try to register the tracks
 as they are in their space.
 
\end_layout

\begin_layout Standard
Our algorithm is extremely efficient and simple to use, completely automatic
 and provides an evidently robust rigid direct tractography registration
 algorithm available in seconds.
 This algorithm could be of great use when comparing healthy versus severely
 deseased brains e.g.
 stroke or vegetative state patients when non-rigid registration is not
 recommended because of severe asymmetries in the deseased brains.
 The algorithm is based on the robustness of LSC to find good skeletons.
\end_layout

\begin_layout Standard

\series bold
Algorithm
\series default
.
 Here we describe a simple algorithm where 2 tractographies 
\begin_inset Formula $T_{A}$
\end_inset

,
\begin_inset Formula $T_{B}$
\end_inset

 are aligned together in native space.
\end_layout

\begin_layout Enumerate
All tracks with length smaller than 
\begin_inset Formula $100$
\end_inset

mm and longer than 
\begin_inset Formula $300$
\end_inset

mm are removed from the datasets.
 This will reduce the size of tractography to about 
\begin_inset Formula $1/4$
\end_inset

 of its initial size (
\begin_inset Formula $~200,000$
\end_inset

 tracks).
\end_layout

\begin_layout Enumerate
Both tractographies are equidistantly downsampled so every track contains
 only 
\begin_inset Formula $12$
\end_inset

 points.
 
\end_layout

\begin_layout Enumerate
We run LSC with distance threshold at 
\begin_inset Formula $10$
\end_inset

mm for both tractographies.
\end_layout

\begin_layout Enumerate
Collect all exemplar tracks from clusters containing more than 
\begin_inset Formula $0.2\%$
\end_inset

 tracks.
 Lets assume we have these now in 
\begin_inset Formula $E_{A}$
\end_inset

 and 
\begin_inset Formula $E_{B}$
\end_inset

.
\end_layout

\begin_layout Enumerate
Calculate all pairwise distances 
\begin_inset Formula $D=\mathtt{MDF}(E_{A},E_{B})$
\end_inset

 and save them in rectangular matrix 
\begin_inset Formula $D$
\end_inset

.
 
\end_layout

\begin_layout Enumerate
Create a cost function (optimizer) which we wil try to minimize, that being
 
\begin_inset Formula $SMD=\sum_{i}\min_{j}D(i,j)+\sum_{j}\min_{i}D(i,j)$
\end_inset

 .
 We call this metric sum of minimum distances (SMD) and it is simply the
 sum of.
\end_layout

\begin_layout Enumerate
Use modified Powell's method 
\begin_inset CommandInset citation
LatexCommand cite
key "fletcher1987practical"

\end_inset

 to minimize SMD starting with zeroed initial conditions.
 In each iteration of the optimization 
\begin_inset Formula $E_{B}$
\end_inset

 will be transformed and SMD will be recalculated.
 To ensure smooth rotations we use Rodriguez formula.
\end_layout

\begin_layout Standard
In Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:direct_registration"

\end_inset

A we see the result of this algorithm applied to two tractographies - represente
d with their exemplar tracks - depicted with orange and purple.
 We can see in the upper planel that the orange tractography is way of the
 purple and after implementing our algorithm
\end_layout

\begin_layout Standard

\series bold
Metric
\series default
.
 SMD is proposed here for registration of trajectory datasets as someone
 would use mutual information
\begin_inset CommandInset citation
LatexCommand cite
key "maes1997multimodality"

\end_inset

 or the correlatio ration 
\begin_inset CommandInset citation
LatexCommand cite
key "roche1998correlation"

\end_inset

 for registration of volumetric datasets.
 Nonetheless, the advantage of SMD is that it comes from robust landmarks
 generated by LSC which bring together local and global components.
 Initially, it was not clear if we should use SMD or just the sum of all
 distances 
\begin_inset Formula $SD=\sum_{i,j}D(i,j)$
\end_inset

.
 Therefore, we made a small experiment to validate the smoothness and convexity
 of these two cost functions.
 We plotted both functions under a single-axis translation or a single-angle
 rotation of the same tractography as show in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:direct_registration"

\end_inset

 B and C.
 From, there it was clear that although for translations only the SD was
 entirely convex, with rotations the SD had stronger local minima which
 is not a good property for registration.
 Furthermore, the SMD had steeper derivatives towards the global minimum
 which is a positive indicator for faster convergence.
 
\end_layout

\begin_layout Standard

\series bold
Experiments
\series default
.
 The first large scale experiment took place using the same tractography
 of a single individual copied and transformed 1000 times with range of
 all three angles from -45 degrees to 45 and range of all x,y,z translations
 from -113 to 113mm.
 Then we registered all transformed tractographies to the static one and
 calculated all pairwise MDF distances stored square matrix 
\begin_inset Formula $D$
\end_inset

.
 Therefore, we would expect that if the registration was correct then the
 summary of all diagonals elements of 
\begin_inset Formula $D$
\end_inset

 would be close to 0.
 This was confirmed with both cost functions used SD and SMD getting close
 to zero 99.8% of the time however SMD was always closer to perfect alignment
 i.e.
 0 than SD, having precision of more 7 decimals.
 Consiquently SMD is as chosen as a better cost function for tractography
 registration.
\end_layout

\begin_layout Standard
We uses QA tractographies from 10 subjects and we registered all full combinatio
ns of pairs 
\begin_inset Formula $\binom{10}{2}=45$
\end_inset

.
 Comparing different tractographies is not a trivial problem however we
 can use the tightness comparison (TC) metric explained in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Tightness-comparisons"

\end_inset

.
 We are happy to report the mean initial TC was 
\begin_inset Formula $34.8\%\pm8.0\%$
\end_inset

 and the mean final TC after applying our direct registration method was
 
\begin_inset Formula $48.1\%\pm6.1\%$
\end_inset

.
 This was a statistically highly significant improvement (
\begin_inset Formula $t_{\text{\textrm{paired}}}(44)=11.2$
\end_inset

 ,
\begin_inset Formula $p\leq10^{-13}$
\end_inset

 ).
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset CommandInset label
LatexCommand label
name "Flo:direct_registration"

\end_inset


\begin_inset Graphics
	filename last_figures/LSC_registration2.png
	scale 80

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
In panel A we see two tractographies from different subjects before (up)
 and after rigid registration (down) using our method.
 In panel B we see the metric 
\begin_inset Formula $SMD$
\end_inset

 that we choosed to optimize of two copies of the same tractography with
 the second copy under translation (up) and rotation (down) This metric
 found to be smooth with a single global minimum and only slightly non-convex
 with small local minima.
 In panel C another possible candidate metric 
\begin_inset Formula $SD$
\end_inset

 is shown which although more convex on translations it was much more problemati
c with rotations.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Strategies with Small fibres
\end_layout

\begin_layout Standard
In many parts of this document we didn't consider short tracks.
 That is perfectly valid because a) the longer tracks are more likely to
 be used as useful landmarks when comparing or registering different subjects
 because it is more likely for them to exist in most subjects, b) removing
 short tracks fascilitates the usage of distance based clustering (no need
 for adaptive distance threshold) and interaction with the tractography,
 c) someone would first want to see the overall skeleton of the tractography
 and later go to the details.
 Nonetheless, after having clustered the longer tracks there are many ways
 to assign the smaller bundles to their closest longer bundles.
 For this purpose we recommend to use a different distance than 
\begin_inset Formula $d_{df}$
\end_inset

 (MDF) for example that could be the minimum version of MAM refered to as
 
\begin_inset Formula $m_{in}$
\end_inset

 in eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:min_average_distance"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset CommandInset label
LatexCommand label
name "Flo:arcuate_close"

\end_inset


\begin_inset Graphics
	filename last_figures/arcuate_small_fibers.png
	scale 70
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
A simple and vigorous strategy for handling short and long tracks together
 by picking a track of interest from one of our atlases.
 Colormap encodes track length.
 A: one picked selected atlantic track, B: 245 subject tracks closer than
 15mm (MDF distance), C: B tracks clustered in 23 skeletons, D: 3421 tracks
 closer than 6mm (MAM distance) from the skeletons of B are shown.
 We can see that a great number of small tracks have been brought together
 along with the tracks in B but also shorter.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Here are some simple strategies for clustering short fibres.
 The first is for unsupervised clustering and the second one is for supervised
 learning.
\end_layout

\begin_layout Standard

\series bold
Strategy1
\series default
.
 Cluster the long tracks using LSC with distance threshold at 10mm and then
 cluster the short tracks (<100mm) to a lower threshold and assign them
 to their closest long track bundle from the first clustering using the
 
\begin_inset Formula $m_{in}$
\end_inset

 distance.
\end_layout

\begin_layout Standard

\series bold
Strategy2
\series default
.
 Read the tractography of a single subject, a) use a tractographic atlas
 as the one created in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Atlases-made-easy"

\end_inset

 and pick one or more close skeletal tracks from that atlas and then find
 the closest tracks from the subject to that selected track using 
\begin_inset Formula $d_{df}$
\end_inset

, c) cluster the closest tracks found from the previous step and for each
 one of these new skeletons find the closest tracks using the 
\begin_inset Formula $m_{in}$
\end_inset

.
 You should now have an amalgamation of shorter and longer fibres in one
 cluster.
 
\end_layout

\begin_layout Standard
An example of this second strategy is shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:arcuate_close"

\end_inset

: (A) a track of interest from the arcuate fasciculus is selected from the
 tractographic atlas shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "Flo:CloseToSelected"

\end_inset

(top row-middle), (B) the tracks of the subject closer than 15mm (
\begin_inset Formula $d_{df}$
\end_inset

) from the selected cluster are shown and clustered with a distance threshold
 of 6.25mm in (C), (D) from every skeleton track in C we find the closest
 tracks using the (
\begin_inset Formula $m_{in}$
\end_inset

) distance from entire tractography.
\end_layout

\begin_layout Subsection
Discussion and Conclusion
\end_layout

\begin_layout Itemize
Worked mostly with long tracks but strategies for short tracks or bundles
 are straightforward.
\end_layout

\begin_layout Itemize
Providing an alternative way to ROIs using selected bundles of great agreement
 also known as BOIs (bundles of interest) or TOIs (tracks of interest).
\end_layout

\begin_layout Itemize
Book of correct bundles.
\end_layout

\begin_layout Itemize
Book of known erroneous bundles.
\end_layout

\begin_layout Itemize
Detecting structures.
\end_layout

\begin_layout Itemize
Registering datasets.
\end_layout

\begin_layout Itemize
Comparing results with standard or novel metrics
\end_layout

\begin_layout Itemize
Worked with simulated, single or multiple real datasets
\end_layout

\begin_layout Itemize
LSC is an extremely efficient with significant evidence for robustness
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Conclusions & Future Work
\end_layout

\begin_layout Itemize
summary of novelties
\end_layout

\begin_layout Itemize
visualizations 
\end_layout

\begin_layout Itemize
new scanner is built
\end_layout

\begin_layout Itemize
dti R package
\end_layout

\begin_layout Itemize
4D Wavelet signal correction
\end_layout

\begin_layout Itemize
Neighbourhood correction - discrete optimization
\end_layout

\begin_layout Itemize
Graph-theoretic and global tractography
\end_layout

\begin_layout Itemize
Comparison with spherical deconvolution
\end_layout

\begin_layout Itemize
Axonal thickness
\begin_inset CommandInset citation
LatexCommand cite
key "Assaf2008"

\end_inset

 and other methods e.g.
 qMT 
\begin_inset CommandInset citation
LatexCommand cite
key "Stikov2010"

\end_inset

,
\begin_inset CommandInset citation
LatexCommand cite
key "Cohen-Adad2011"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Appendix
\end_layout

\begin_layout Subsection
Sequences
\end_layout

\begin_layout Standard

\series bold
12 Channels 101 and 118 MRC-CBU
\end_layout

\begin_layout Standard
3T scanner (TIM Trio, Siemens), using Siemens advanced diffusion work-in-progres
s sequence, and STEAM 
\begin_inset CommandInset citation
LatexCommand cite
key "merboldt1992diffusion,MAB04"

\end_inset

 as the diffusion preparation method.
 The field of view was 
\begin_inset Formula $240x240mm^{2}$
\end_inset

, matrix size 
\begin_inset Formula $96x96$
\end_inset

, and slice thickness 
\begin_inset Formula $2.5mm$
\end_inset

 (no gap).
 55 slices were acquired to achieve full brain coverage, and the voxel resolutio
n was 
\begin_inset Formula $2.5x2.5x2.5mm{}^{3}$
\end_inset

.
 Two sampling schemes were considered: a 102-point half grid acquisition(TR=
\begin_inset Formula $8200ms$
\end_inset

, TE=
\begin_inset Formula $69ms$
\end_inset

) with a maximum b-value of 
\begin_inset Formula $4000\, s/mm^{2}$
\end_inset

, and a single shell acquisition using 118 non-collinear gradient directions
 (TR=
\begin_inset Formula $7000ms$
\end_inset

, TE=
\begin_inset Formula $47ms$
\end_inset

) and a b-value of 
\begin_inset Formula $1000\, s/mm^{2}$
\end_inset

.
 The two acquisition schemes were matched for total acquisition time (
\begin_inset Formula $14\, min\,37s$
\end_inset

), voxel resolution, and bandwidth.
\end_layout

\begin_layout Standard

\series bold
32 Channels 101 MRC-CBU
\end_layout

\begin_layout Standard
3T scanner (TIM Trio, Siemens), using Siemens advanced diffusion work-in-progres
s sequence, and STEAM 
\begin_inset CommandInset citation
LatexCommand cite
key "merboldt1992diffusion,MAB04"

\end_inset

 as the diffusion preparation method.
 The field of view was 
\begin_inset Formula $240x240mm^{2}$
\end_inset

, matrix size 
\begin_inset Formula $96x96$
\end_inset

, and slice thickness 
\begin_inset Formula $2.5mm$
\end_inset

 (no gap).
 55 slices were acquired to achieve full brain coverage, and the voxel resolutio
n was 
\begin_inset Formula $2.5x2.5x2.5mm{}^{3}$
\end_inset

.A 102-point half grid acquisition with a maximum b-value of 
\begin_inset Formula $4000\, s/mm^{2}$
\end_inset

 was used.
 The total acquisition time was
\begin_inset Formula $14\, min\,21s$
\end_inset

 with TR=
\begin_inset Formula $8200ms$
\end_inset

 and TE=
\begin_inset Formula $69ms$
\end_inset

.
\end_layout

\begin_layout Standard

\series bold
32 Channels EPFL MRC-CBU
\end_layout

\begin_layout Standard
3T scanner (TIM Trio, Siemens).
 The field of view was 
\begin_inset Formula $210x210mm^{2}$
\end_inset

, matrix size 
\begin_inset Formula $96x96$
\end_inset

, and slice thickness 
\begin_inset Formula $3mm$
\end_inset

.
 44 slices were acquired and the voxel resolution was 
\begin_inset Formula $2.2x2.2x3.0mm{}^{3}$
\end_inset

.A 258-point half grid acquisition scheme with a maximum b-value of 
\begin_inset Formula $8011\, s/mm^{2}$
\end_inset

 (DSI515) was used.
 The total acquisition time was 
\begin_inset Formula $34\, min$
\end_inset

 with TR=
\begin_inset Formula $8200ms$
\end_inset

 and TE=
\begin_inset Formula $165ms$
\end_inset

.
\end_layout

\begin_layout Subsection
The cosine transform
\end_layout

\begin_layout Standard
\begin_inset Formula $\int_{0}^{\infty}\cos(st)g(t)dt$
\end_inset

 where 
\begin_inset Formula $g(t)$
\end_inset

 defined on 
\begin_inset Formula $[t,\infty)$
\end_inset


\end_layout

\begin_layout Standard
Let 
\begin_inset Formula $f(t)$
\end_inset

 be an even function 
\begin_inset Formula $f(t)=f(-t)$
\end_inset

 defined for 
\begin_inset Formula $-\infty<t<\infty$
\end_inset

 
\end_layout

\begin_layout Standard
\begin_inset Formula \begin{eqnarray*}
F(s) & = & \int_{-\infty}^{\infty}f(t)e^{its}dt\\
 & = & \int_{0}^{\infty}f(t)e^{its}dt+\int_{-\infty}^{0}f(t)e^{its}dt\\
 & = & \int_{0}^{\infty}f(t)e^{its}dt-\int_{-\infty}^{0}f(-t)e^{-its}dt\\
 & = & \int_{0}^{\infty}f(t)e^{its}dt+\int_{0}^{\infty}f(t)e^{-its}dt\\
 & = & \int_{0}^{\infty}f(t)[e^{its}+e^{-its}]dt\\
 & = & \int_{0}^{\infty}f(t)[cos(its)+isin(its)+cos(its)-isin(its)]dt\\
 & = & 2\int_{0}^{\infty}f(t)cos(st)dt\end{eqnarray*}

\end_inset

 In the third row above we replace 
\begin_inset Formula $t\rightarrow-t$
\end_inset

 
\end_layout

\begin_layout Standard
If you want to compute the integral in the whole space because of symmetry
 you have 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none

\begin_inset Formula $F(s)=\int_{-\infty}^{\infty}f(t)cos(st)dt$
\end_inset


\end_layout

\begin_layout Subsection
\begin_inset Note Note
status collapsed

\begin_layout Subsection
Tractographic Group Analysis
\end_layout

\begin_layout Subsection
Overview
\end_layout

\begin_layout Plain Layout
Although the field of tractography has been around for over ten years there
 are not many studies which use tractography directly to compare between
 different subjects and the most common methods use calculate a connectivity
 matrix for each subject and then do statistics on the matrices of all subjects
 
\begin_inset CommandInset citation
LatexCommand cite
key "Hagmann2008PLoSBiol"

\end_inset

.
 In this chapter we describe a new method to do multi-subject statistics
 directly on standard space warped tractographies.
 This method assumes that all tractographies need to be registered using
 affine transformations or non-rigid displacements.
 In the following chapter we further show that the registration step can
 be droped but the statistics still be valid.
\end_layout

\begin_layout Subsection
Track Correspondence
\end_layout

\begin_layout Plain Layout
Identifying manually corresponding tracks in different brain tractogaphies
 is a very complicated task, typically requiring lots of expertise, and
 lots of time.
 Moreover different local diffusion models and different tractography algorithms
 generate tractographies with wide differences in numbers of tracks and
 in shape characteristics.
 We address these problems by introducing an automatic method for detecting
 corresponding tracks in different dMRI (diffusion weighted MRI) datasets.
 
\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename pbc_figures/white_brain.png
	scale 30
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Bundles from the PBC Dataset
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Methods 
\end_layout

\begin_layout Plain Layout
For two MNI registered brains, we generated two deterministic tractographies
 using DTK (Diffusion Toolkit) [1] with imaging model DTI and integration
 algorithms (a) FACT [5] and (b) second order Runge-Kutta (RK2).
 The output of DTK is a list of tracks i.e.
 curves composed of line segments.
 In our case each dataset contains ~200.000 tracks where each track in turn
 consists of up to several hundred segments.
 Manipulating this number of segments is computationally demanding.
 Therefore, we implemented a track approximation method based on the minimum
 description length principle as described by Lee 
\change_deleted 0 1314544480
et.
 al
\change_inserted 0 1314544480
et al.
\change_unchanged
.
 [2], with the addition of a smoothing parameter.
 Using this approximation method we can reduce considerably the number of
 segments per track while minimally reducing its resolution.
 Then we calculate distances between tracks using the mean average metric
 (MAM) as used by Corouge et.al [4] and Zhang et.al [3].
 With this metric we identify corresponding tracks from different datasets
 with high consistency even where the global shapes of the tracks differ
 markedly e.g.
 in length or curvature.
 We can extend this method to identify corresponding track bundles by finding
 each single corresponding track in the bundle.
 However this entails processing the full list of tracks each time we search
 for a match to a single track.
 For dMRI databases with high track density (e.g.
 DSI or Q-ball) this is too slow for practical applications.
 To overcome this we are developing a novel method that takes advantage
 of the local characteristics of the neighbourhood of the bundle.
 In order to do this we are implementing state-of-the-art discrete optimization
 methods e.g.
 alpha-expansion and primal-dual schemes [6] using the spring and reference
 track model described below.
 This model ensures that corresponding bundles (e.g.
 left and right corticospinal tracts) match in their local regions in the
 two brains but the underlying cost function is also rewarded for maintaining
 approximate symmetry.
 At the same time it takes advantage of using the local orientation profile
 from the nearby region.
 We believe that this is an efficient way to reduce the search time by adding
 some prior knowledge relating to locality and symmetry into our method.
 
\end_layout

\begin_layout Subsection
Results 
\end_layout

\begin_layout Plain Layout
We acquired dMRI datasets from two healthy adult brains using the MRC-CBU
 Siemens Trio scanner with voxel size 2x2x2mm, 64 directions, TR 9200 ms,
 TE 93 ms, FoV read 256 mm and b-value 1000s/mm2.
 An additional volume was acquired with b-value 0 s/mm2.
 Total duration of acquisition was 10' 27''.
 Brain volumes were normalized and eddy current corrections applied with
 standard registration procedures.
 The red and blue brains in the upper panel are based on the same dMRI acquisiti
on.
 The red tractography was generated using FACT and the blue was generated
 using RK2.
 The cyan brain was generated from a different subject using FACT.
 We randomly chose tracks labeled 0-8 in the red dataset.
 Our method finds the corresponding tracks in the other two datasets.
 The datasets are visualized simultaneously using our own specialized 3d
 engine Fos.
 The lower left picture shows the same brains from a different angle.
 Lower right picture shows the spring and reference track model designed
 to solve the bundle correspondence problem.
 This is an example to fit corticospinal bundles in normal brains.
 The spring indicates that the distance between left and right bundles is
 loosely constrained.
 The arrows represent the direction of the reference track of the bundle.
 The reference track is generated using the MAM metric.
 Conclusion We presented a novel method for identifying corresponding tracks
 in dMRI datasets of different modalities like DSI, Qball, HARDI, DTI and
 of different subjects.
 It requires that they are registered in the same space e.g.
 MNI.
 We also presented for first time the Fos 3d engine for multiple simultaneous
 visualization of many tractographic datasets.
 Fos will soon be released under a free software license.
 Finally we introduced a proposal to integrate local characteristics to
 reduce the search time when identifying corresponding bundles using state-of-th
e-art discrete optimization algorithms.
 
\end_layout

\begin_layout Plain Layout
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
References
\end_layout

\begin_layout Plain Layout
[1] R.
 Wang, V.J.
 Wedeen, Diffusion Toolkit and TrackVis.
 Berlin, ISMRM, 2007.
 [2] J.G.
 Lee, J.
 Han, K.Y.
 Whang, Trajectory clustering: a partition-and-group framework, Proceedings
 of the 2007 ACM SIGMOD, 2007.
 [3] S.
 Zhang, S.
 Correia, D.H.
 Laidlaw, Identifying White-Matter fibre Bundles in DTI Data Using an Automated
 Proximity-Based fibre Clustering Method, IEEE Trans.
 Visualization and Computer Graphics, 14 (5) 1044—1053, 2008.
 [4] I.
 Corouge, S.
 Gouttard, and G.
 Gerig.
 Towards a shape clustering model of white matter fibre bundles using diffusion
 tensor MRI.
 ISBI, 344—347, 2004.
 [5] S.
 Mori, B.J.
 Crain, V.P.
 Chacko, and P.C.M.
 Van Zijl, Three-dimensional tracking of axonal projections in the brain
 by magnetic resonance imaging, Annals of Neurology, 45 (2) 265—269, 1999.
 [6] N.
 Komodakis, Optimization Algorithms for Discrete Markov Random Fields, with
 Applications to Computer Vision, PhD Thesis, 2006.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/ISMRM2010_Final2.png
	scale 30
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Picking in red and corresponding in cyan and blue
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Subsection
Direct Intersubject Correspondence
\end_layout

\begin_layout Subsection
Overview
\end_layout

\begin_layout Plain Layout
As of today in brain imaging we are using co-registration to be able to
 do statistical analysis between datasets of different subjects.
 Co-registration can usually introduce some other problems especially when
 the brains are not similar or in case of diseased brains.
 We show that using statistical shape analysis we can detect corresponding
 tracks in different brains without using volume registration.
 With this technique we are able to work directly in native space of each
 dataset independently.
 In order to ensure smooth correspondance we constrain the transformations
 using a log polyaffine for more see 
\begin_inset CommandInset citation
LatexCommand cite
key "Arsigny2009,Commowick2008"

\end_inset

.
\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename pbc_figures/references_4_8_regions.png
	scale 30
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
One of our initial results with affine registered brains now extends to
 this chapter to even not registered brains
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Subsection
Natural Visual Interaction 
\end_layout

\begin_layout Subsection
Overview
\end_layout

\begin_layout Plain Layout
Through out this thesis you have seen many different pictures of tractographies
 and read about ways to interact with them.
 We present in this part a method where many different tractographies can
 be visualized simultaneously and interact with them even at the level of
 selecting an individual track through millions of tracks.
 In order to do this designed visualization software sharing more properties
 with a game engine than anything else that we hope will enable experts
 in neuroanatomy to label the fibre pathways and medical/psychology practicioner
s to learn about white matter anatomy.
\end_layout

\begin_layout Plain Layout
Picture from dandelion.
\end_layout

\begin_layout Plain Layout
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Newpage newpage
\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Bibliography
\end_layout

\begin_layout Standard

\lang british
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "diffusion"
options "plain"

\end_inset


\end_layout

\end_body
\end_document
